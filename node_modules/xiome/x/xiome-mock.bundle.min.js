!function(){"use strict";const e="undefined"!=typeof window&&null!=window.customElements&&void 0!==window.customElements.polyfillWrapFlushCallback,t=(e,t,i=null)=>{for(;t!==i;){const i=t.nextSibling;e.removeChild(t),t=i}},i=`{{lit-${String(Math.random()).slice(2)}}}`,o=`\x3c!--${i}--\x3e`,s=new RegExp(`${i}|${o}`),a="$lit$";class n{constructor(e,t){this.parts=[],this.element=t;const o=[],n=[],l=document.createTreeWalker(t.content,133,null,!1);let p=0,u=-1,h=0;const{strings:m,values:{length:f}}=e;for(;h<f;){const e=l.nextNode();if(null!==e){if(u++,1===e.nodeType){if(e.hasAttributes()){const t=e.attributes,{length:i}=t;let o=0;for(let e=0;e<i;e++)r(t[e].name,a)&&o++;for(;o-- >0;){const t=m[h],i=d.exec(t)[2],o=i.toLowerCase()+a,n=e.getAttribute(o);e.removeAttribute(o);const r=n.split(s);this.parts.push({type:"attribute",index:u,name:i,strings:r}),h+=r.length-1}}"TEMPLATE"===e.tagName&&(n.push(e),l.currentNode=e.content)}else if(3===e.nodeType){const t=e.data;if(t.indexOf(i)>=0){const i=e.parentNode,n=t.split(s),l=n.length-1;for(let t=0;t<l;t++){let o,s=n[t];if(""===s)o=c();else{const e=d.exec(s);null!==e&&r(e[2],a)&&(s=s.slice(0,e.index)+e[1]+e[2].slice(0,-a.length)+e[3]),o=document.createTextNode(s)}i.insertBefore(o,e),this.parts.push({type:"node",index:++u})}""===n[l]?(i.insertBefore(c(),e),o.push(e)):e.data=n[l],h+=l}}else if(8===e.nodeType)if(e.data===i){const t=e.parentNode;null!==e.previousSibling&&u!==p||(u++,t.insertBefore(c(),e)),p=u,this.parts.push({type:"node",index:u}),null===e.nextSibling?e.data="":(o.push(e),u--),h++}else{let t=-1;for(;-1!==(t=e.data.indexOf(i,t+1));)this.parts.push({type:"node",index:-1}),h++}}else l.currentNode=n.pop()}for(const e of o)e.parentNode.removeChild(e)}}const r=(e,t)=>{const i=e.length-t.length;return i>=0&&e.slice(i)===t},l=e=>-1!==e.index,c=()=>document.createComment(""),d=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;function p(e,t){const{element:{content:i},parts:o}=e,s=document.createTreeWalker(i,133,null,!1);let a=h(o),n=o[a],r=-1,l=0;const c=[];let d=null;for(;s.nextNode();){r++;const e=s.currentNode;for(e.previousSibling===d&&(d=null),t.has(e)&&(c.push(e),null===d&&(d=e)),null!==d&&l++;void 0!==n&&n.index===r;)n.index=null!==d?-1:n.index-l,a=h(o,a),n=o[a]}c.forEach((e=>e.parentNode.removeChild(e)))}const u=e=>{let t=11===e.nodeType?0:1;const i=document.createTreeWalker(e,133,null,!1);for(;i.nextNode();)t++;return t},h=(e,t=-1)=>{for(let i=t+1;i<e.length;i++){const t=e[i];if(l(t))return i}return-1};const m=new WeakMap,f=e=>"function"==typeof e&&m.has(e),g={},b={};class v{constructor(e,t,i){this.__parts=[],this.template=e,this.processor=t,this.options=i}update(e){let t=0;for(const i of this.__parts)void 0!==i&&i.setValue(e[t]),t++;for(const e of this.__parts)void 0!==e&&e.commit()}_clone(){const t=e?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),i=[],o=this.template.parts,s=document.createTreeWalker(t,133,null,!1);let a,n=0,r=0,c=s.nextNode();for(;n<o.length;)if(a=o[n],l(a)){for(;r<a.index;)r++,"TEMPLATE"===c.nodeName&&(i.push(c),s.currentNode=c.content),null===(c=s.nextNode())&&(s.currentNode=i.pop(),c=s.nextNode());if("node"===a.type){const e=this.processor.handleTextExpression(this.options);e.insertAfterNode(c.previousSibling),this.__parts.push(e)}else this.__parts.push(...this.processor.handleAttributeExpressions(c,a.name,a.strings,this.options));n++}else this.__parts.push(void 0),n++;return e&&(document.adoptNode(t),customElements.upgrade(t)),t}}const w=window.trustedTypes&&trustedTypes.createPolicy("lit-html",{createHTML:e=>e}),y=` ${i} `;class x{constructor(e,t,i,o){this.strings=e,this.values=t,this.type=i,this.processor=o}getHTML(){const e=this.strings.length-1;let t="",s=!1;for(let n=0;n<e;n++){const e=this.strings[n],r=e.lastIndexOf("\x3c!--");s=(r>-1||s)&&-1===e.indexOf("--\x3e",r+1);const l=d.exec(e);t+=null===l?e+(s?y:o):e.substr(0,l.index)+l[1]+l[2]+a+l[3]+i}return t+=this.strings[e],t}getTemplateElement(){const e=document.createElement("template");let t=this.getHTML();return void 0!==w&&(t=w.createHTML(t)),e.innerHTML=t,e}}const k=e=>null===e||!("object"==typeof e||"function"==typeof e),S=e=>Array.isArray(e)||!(!e||!e[Symbol.iterator]);class I{constructor(e,t,i){this.dirty=!0,this.element=e,this.name=t,this.strings=i,this.parts=[];for(let e=0;e<i.length-1;e++)this.parts[e]=this._createPart()}_createPart(){return new $(this)}_getValue(){const e=this.strings,t=e.length-1,i=this.parts;if(1===t&&""===e[0]&&""===e[1]){const e=i[0].value;if("symbol"==typeof e)return String(e);if("string"==typeof e||!S(e))return e}let o="";for(let s=0;s<t;s++){o+=e[s];const t=i[s];if(void 0!==t){const e=t.value;if(k(e)||!S(e))o+="string"==typeof e?e:String(e);else for(const t of e)o+="string"==typeof t?t:String(t)}}return o+=e[t],o}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}}class ${constructor(e){this.value=void 0,this.committer=e}setValue(e){e===g||k(e)&&e===this.value||(this.value=e,f(e)||(this.committer.dirty=!0))}commit(){for(;f(this.value);){const e=this.value;this.value=g,e(this)}this.value!==g&&this.committer.commit()}}class P{constructor(e){this.value=void 0,this.__pendingValue=void 0,this.options=e}appendInto(e){this.startNode=e.appendChild(c()),this.endNode=e.appendChild(c())}insertAfterNode(e){this.startNode=e,this.endNode=e.nextSibling}appendIntoPart(e){e.__insert(this.startNode=c()),e.__insert(this.endNode=c())}insertAfterPart(e){e.__insert(this.startNode=c()),this.endNode=e.endNode,e.endNode=this.startNode}setValue(e){this.__pendingValue=e}commit(){if(null===this.startNode.parentNode)return;for(;f(this.__pendingValue);){const e=this.__pendingValue;this.__pendingValue=g,e(this)}const e=this.__pendingValue;e!==g&&(k(e)?e!==this.value&&this.__commitText(e):e instanceof x?this.__commitTemplateResult(e):e instanceof Node?this.__commitNode(e):S(e)?this.__commitIterable(e):e===b?(this.value=b,this.clear()):this.__commitText(e))}__insert(e){this.endNode.parentNode.insertBefore(e,this.endNode)}__commitNode(e){this.value!==e&&(this.clear(),this.__insert(e),this.value=e)}__commitText(e){const t=this.startNode.nextSibling,i="string"==typeof(e=null==e?"":e)?e:String(e);t===this.endNode.previousSibling&&3===t.nodeType?t.data=i:this.__commitNode(document.createTextNode(i)),this.value=e}__commitTemplateResult(e){const t=this.options.templateFactory(e);if(this.value instanceof v&&this.value.template===t)this.value.update(e.values);else{const i=new v(t,e.processor,this.options),o=i._clone();i.update(e.values),this.__commitNode(o),this.value=i}}__commitIterable(e){Array.isArray(this.value)||(this.value=[],this.clear());const t=this.value;let i,o=0;for(const s of e)i=t[o],void 0===i&&(i=new P(this.options),t.push(i),0===o?i.appendIntoPart(this):i.insertAfterPart(t[o-1])),i.setValue(s),i.commit(),o++;o<t.length&&(t.length=o,this.clear(i&&i.endNode))}clear(e=this.startNode){t(this.startNode.parentNode,e.nextSibling,this.endNode)}}class A{constructor(e,t,i){if(this.value=void 0,this.__pendingValue=void 0,2!==i.length||""!==i[0]||""!==i[1])throw new Error("Boolean attributes can only contain a single expression");this.element=e,this.name=t,this.strings=i}setValue(e){this.__pendingValue=e}commit(){for(;f(this.__pendingValue);){const e=this.__pendingValue;this.__pendingValue=g,e(this)}if(this.__pendingValue===g)return;const e=!!this.__pendingValue;this.value!==e&&(e?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=e),this.__pendingValue=g}}class _ extends I{constructor(e,t,i){super(e,t,i),this.single=2===i.length&&""===i[0]&&""===i[1]}_createPart(){return new O(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}}class O extends ${}let C=!1;(()=>{try{const e={get capture(){return C=!0,!1}};window.addEventListener("test",e,e),window.removeEventListener("test",e,e)}catch(e){}})();class T{constructor(e,t,i){this.value=void 0,this.__pendingValue=void 0,this.element=e,this.eventName=t,this.eventContext=i,this.__boundHandleEvent=e=>this.handleEvent(e)}setValue(e){this.__pendingValue=e}commit(){for(;f(this.__pendingValue);){const e=this.__pendingValue;this.__pendingValue=g,e(this)}if(this.__pendingValue===g)return;const e=this.__pendingValue,t=this.value,i=null==e||null!=t&&(e.capture!==t.capture||e.once!==t.once||e.passive!==t.passive),o=null!=e&&(null==t||i);i&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),o&&(this.__options=M(e),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=e,this.__pendingValue=g}handleEvent(e){"function"==typeof this.value?this.value.call(this.eventContext||this.element,e):this.value.handleEvent(e)}}const M=e=>e&&(C?{capture:e.capture,passive:e.passive,once:e.once}:e.capture);function E(e){let t=R.get(e.type);void 0===t&&(t={stringsArray:new WeakMap,keyString:new Map},R.set(e.type,t));let o=t.stringsArray.get(e.strings);if(void 0!==o)return o;const s=e.strings.join(i);return o=t.keyString.get(s),void 0===o&&(o=new n(e,e.getTemplateElement()),t.keyString.set(s,o)),t.stringsArray.set(e.strings,o),o}const R=new Map,q=new WeakMap;const D=new class{handleAttributeExpressions(e,t,i,o){const s=t[0];if("."===s){return new _(e,t.slice(1),i).parts}if("@"===s)return[new T(e,t.slice(1),o.eventContext)];if("?"===s)return[new A(e,t.slice(1),i)];return new I(e,t,i).parts}handleTextExpression(e){return new P(e)}};"undefined"!=typeof window&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.4.1");const j=(e,...t)=>new x(e,t,"html",D),L=(e,t)=>`${e}--${t}`;let U=!0;void 0===window.ShadyCSS?U=!1:void 0===window.ShadyCSS.prepareTemplateDom&&(console.warn("Incompatible ShadyCSS version detected. Please update to at least @webcomponents/webcomponentsjs@2.0.2 and @webcomponents/shadycss@1.3.1."),U=!1);const N=e=>t=>{const o=L(t.type,e);let s=R.get(o);void 0===s&&(s={stringsArray:new WeakMap,keyString:new Map},R.set(o,s));let a=s.stringsArray.get(t.strings);if(void 0!==a)return a;const r=t.strings.join(i);if(a=s.keyString.get(r),void 0===a){const i=t.getTemplateElement();U&&window.ShadyCSS.prepareTemplateDom(i,e),a=new n(t,i),s.keyString.set(r,a)}return s.stringsArray.set(t.strings,a),a},z=["html","svg"],V=new Set,B=(e,t,i)=>{V.add(e);const o=i?i.element:document.createElement("template"),s=t.querySelectorAll("style"),{length:a}=s;if(0===a)return void window.ShadyCSS.prepareTemplateStyles(o,e);const n=document.createElement("style");for(let e=0;e<a;e++){const t=s[e];t.parentNode.removeChild(t),n.textContent+=t.textContent}(e=>{z.forEach((t=>{const i=R.get(L(t,e));void 0!==i&&i.keyString.forEach((e=>{const{element:{content:t}}=e,i=new Set;Array.from(t.querySelectorAll("style")).forEach((e=>{i.add(e)})),p(e,i)}))}))})(e);const r=o.content;i?function(e,t,i=null){const{element:{content:o},parts:s}=e;if(null==i)return void o.appendChild(t);const a=document.createTreeWalker(o,133,null,!1);let n=h(s),r=0,l=-1;for(;a.nextNode();)for(l++,a.currentNode===i&&(r=u(t),i.parentNode.insertBefore(t,i));-1!==n&&s[n].index===l;){if(r>0){for(;-1!==n;)s[n].index+=r,n=h(s,n);return}n=h(s,n)}}(i,n,r.firstChild):r.insertBefore(n,r.firstChild),window.ShadyCSS.prepareTemplateStyles(o,e);const l=r.querySelector("style");if(window.ShadyCSS.nativeShadow&&null!==l)t.insertBefore(l.cloneNode(!0),t.firstChild);else if(i){r.insertBefore(n,r.firstChild);const e=new Set;e.add(n),p(i,e)}};window.JSCompiler_renameProperty=(e,t)=>e;const H={toAttribute(e,t){switch(t){case Boolean:return e?"":null;case Object:case Array:return null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){switch(t){case Boolean:return null!==e;case Number:return null===e?null:Number(e);case Object:case Array:return JSON.parse(e)}return e}},F=(e,t)=>t!==e&&(t==t||e==e),W={attribute:!0,type:String,converter:H,reflect:!1,hasChanged:F},Q="finalized";class K extends HTMLElement{constructor(){super(),this.initialize()}static get observedAttributes(){this.finalize();const e=[];return this._classProperties.forEach(((t,i)=>{const o=this._attributeNameForProperty(i,t);void 0!==o&&(this._attributeToPropertyMap.set(o,i),e.push(o))})),e}static _ensureClassProperties(){if(!this.hasOwnProperty(JSCompiler_renameProperty("_classProperties",this))){this._classProperties=new Map;const e=Object.getPrototypeOf(this)._classProperties;void 0!==e&&e.forEach(((e,t)=>this._classProperties.set(t,e)))}}static createProperty(e,t=W){if(this._ensureClassProperties(),this._classProperties.set(e,t),t.noAccessor||this.prototype.hasOwnProperty(e))return;const i="symbol"==typeof e?Symbol():`__${e}`,o=this.getPropertyDescriptor(e,i,t);void 0!==o&&Object.defineProperty(this.prototype,e,o)}static getPropertyDescriptor(e,t,i){return{get(){return this[t]},set(o){const s=this[e];this[t]=o,this.requestUpdateInternal(e,s,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this._classProperties&&this._classProperties.get(e)||W}static finalize(){const e=Object.getPrototypeOf(this);if(e.hasOwnProperty(Q)||e.finalize(),this.finalized=!0,this._ensureClassProperties(),this._attributeToPropertyMap=new Map,this.hasOwnProperty(JSCompiler_renameProperty("properties",this))){const e=this.properties,t=[...Object.getOwnPropertyNames(e),..."function"==typeof Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e):[]];for(const i of t)this.createProperty(i,e[i])}}static _attributeNameForProperty(e,t){const i=t.attribute;return!1===i?void 0:"string"==typeof i?i:"string"==typeof e?e.toLowerCase():void 0}static _valueHasChanged(e,t,i=F){return i(e,t)}static _propertyValueFromAttribute(e,t){const i=t.type,o=t.converter||H,s="function"==typeof o?o:o.fromAttribute;return s?s(e,i):e}static _propertyValueToAttribute(e,t){if(void 0===t.reflect)return;const i=t.type,o=t.converter;return(o&&o.toAttribute||H.toAttribute)(e,i)}initialize(){this._updateState=0,this._updatePromise=new Promise((e=>this._enableUpdatingResolver=e)),this._changedProperties=new Map,this._saveInstanceProperties(),this.requestUpdateInternal()}_saveInstanceProperties(){this.constructor._classProperties.forEach(((e,t)=>{if(this.hasOwnProperty(t)){const e=this[t];delete this[t],this._instanceProperties||(this._instanceProperties=new Map),this._instanceProperties.set(t,e)}}))}_applyInstanceProperties(){this._instanceProperties.forEach(((e,t)=>this[t]=e)),this._instanceProperties=void 0}connectedCallback(){this.enableUpdating()}enableUpdating(){void 0!==this._enableUpdatingResolver&&(this._enableUpdatingResolver(),this._enableUpdatingResolver=void 0)}disconnectedCallback(){}attributeChangedCallback(e,t,i){t!==i&&this._attributeToProperty(e,i)}_propertyToAttribute(e,t,i=W){const o=this.constructor,s=o._attributeNameForProperty(e,i);if(void 0!==s){const e=o._propertyValueToAttribute(t,i);if(void 0===e)return;this._updateState=8|this._updateState,null==e?this.removeAttribute(s):this.setAttribute(s,e),this._updateState=-9&this._updateState}}_attributeToProperty(e,t){if(8&this._updateState)return;const i=this.constructor,o=i._attributeToPropertyMap.get(e);if(void 0!==o){const e=i.getPropertyOptions(o);this._updateState=16|this._updateState,this[o]=i._propertyValueFromAttribute(t,e),this._updateState=-17&this._updateState}}requestUpdateInternal(e,t,i){let o=!0;if(void 0!==e){const s=this.constructor;i=i||s.getPropertyOptions(e),s._valueHasChanged(this[e],t,i.hasChanged)?(this._changedProperties.has(e)||this._changedProperties.set(e,t),!0!==i.reflect||16&this._updateState||(void 0===this._reflectingProperties&&(this._reflectingProperties=new Map),this._reflectingProperties.set(e,i))):o=!1}!this._hasRequestedUpdate&&o&&(this._updatePromise=this._enqueueUpdate())}requestUpdate(e,t){return this.requestUpdateInternal(e,t),this.updateComplete}async _enqueueUpdate(){this._updateState=4|this._updateState;try{await this._updatePromise}catch(e){}const e=this.performUpdate();return null!=e&&await e,!this._hasRequestedUpdate}get _hasRequestedUpdate(){return 4&this._updateState}get hasUpdated(){return 1&this._updateState}performUpdate(){if(!this._hasRequestedUpdate)return;this._instanceProperties&&this._applyInstanceProperties();let e=!1;const t=this._changedProperties;try{e=this.shouldUpdate(t),e?this.update(t):this._markUpdated()}catch(t){throw e=!1,this._markUpdated(),t}e&&(1&this._updateState||(this._updateState=1|this._updateState,this.firstUpdated(t)),this.updated(t))}_markUpdated(){this._changedProperties=new Map,this._updateState=-5&this._updateState}get updateComplete(){return this._getUpdateComplete()}_getUpdateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._updatePromise}shouldUpdate(e){return!0}update(e){void 0!==this._reflectingProperties&&this._reflectingProperties.size>0&&(this._reflectingProperties.forEach(((e,t)=>this._propertyToAttribute(t,this[t],e))),this._reflectingProperties=void 0),this._markUpdated()}updated(e){}firstUpdated(e){}}K.finalized=!0;const X=window.ShadowRoot&&(void 0===window.ShadyCSS||window.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,J=Symbol();class G{constructor(e,t){if(t!==J)throw new Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e}get styleSheet(){return void 0===this._styleSheet&&(X?(this._styleSheet=new CSSStyleSheet,this._styleSheet.replaceSync(this.cssText)):this._styleSheet=null),this._styleSheet}toString(){return this.cssText}}const Y=(e,...t)=>{const i=t.reduce(((t,i,o)=>t+(e=>{if(e instanceof G)return e.cssText;if("number"==typeof e)return e;throw new Error(`Value passed to 'css' function must be a 'css' function result: ${e}. Use 'unsafeCSS' to pass non-literal values, but\n            take care to ensure page security.`)})(i)+e[o+1]),e[0]);return new G(i,J)};(window.litElementVersions||(window.litElementVersions=[])).push("2.5.1");const Z={};class ee extends K{static getStyles(){return this.styles}static _getUniqueStyles(){if(this.hasOwnProperty(JSCompiler_renameProperty("_styles",this)))return;const e=this.getStyles();if(Array.isArray(e)){const t=(e,i)=>e.reduceRight(((e,i)=>Array.isArray(i)?t(i,e):(e.add(i),e)),i),i=t(e,new Set),o=[];i.forEach((e=>o.unshift(e))),this._styles=o}else this._styles=void 0===e?[]:[e];this._styles=this._styles.map((e=>{if(e instanceof CSSStyleSheet&&!X){const t=Array.prototype.slice.call(e.cssRules).reduce(((e,t)=>e+t.cssText),"");return new G(String(t),J)}return e}))}initialize(){super.initialize(),this.constructor._getUniqueStyles(),this.renderRoot=this.createRenderRoot(),window.ShadowRoot&&this.renderRoot instanceof window.ShadowRoot&&this.adoptStyles()}createRenderRoot(){return this.attachShadow(this.constructor.shadowRootOptions)}adoptStyles(){const e=this.constructor._styles;0!==e.length&&(void 0===window.ShadyCSS||window.ShadyCSS.nativeShadow?X?this.renderRoot.adoptedStyleSheets=e.map((e=>e instanceof CSSStyleSheet?e:e.styleSheet)):this._needsShimAdoptedStyleSheets=!0:window.ShadyCSS.ScopingShim.prepareAdoptedCssText(e.map((e=>e.cssText)),this.localName))}connectedCallback(){super.connectedCallback(),this.hasUpdated&&void 0!==window.ShadyCSS&&window.ShadyCSS.styleElement(this)}update(e){const t=this.render();super.update(e),t!==Z&&this.constructor.render(t,this.renderRoot,{scopeName:this.localName,eventContext:this}),this._needsShimAdoptedStyleSheets&&(this._needsShimAdoptedStyleSheets=!1,this.constructor._styles.forEach((e=>{const t=document.createElement("style");t.textContent=e.cssText,this.renderRoot.appendChild(t)})))}render(){return Z}}ee.finalized=!0,ee.render=(e,i,o)=>{if(!o||"object"!=typeof o||!o.scopeName)throw new Error("The `scopeName` option is required.");const s=o.scopeName,a=q.has(i),n=U&&11===i.nodeType&&!!i.host,r=n&&!V.has(s),l=r?document.createDocumentFragment():i;if(((e,i,o)=>{let s=q.get(i);void 0===s&&(t(i,i.firstChild),q.set(i,s=new P(Object.assign({templateFactory:E},o))),s.appendInto(i)),s.setValue(e),s.commit()})(e,l,Object.assign({templateFactory:N(s)},o)),r){const e=q.get(l);q.delete(l);const o=e.value instanceof v?e.value.template:void 0;B(s,l,o),t(i,i.firstChild),i.appendChild(l),q.set(i,e)}!a&&n&&window.ShadyCSS.styleElement(i.host)},ee.shadowRootOptions={mode:"open"};class te extends ee{}const ie=Symbol("shadowRoot"),oe=Symbol("_handleButtonClick");class se extends te{static get styles(){return Y`
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			*:focus {
				outline: var(--focus-outline, 2px solid #0af);
			}

			:host([theme="concrete"]) button {
				position: relative;
				display: block;
				margin: var(--menu-gapsize, 0.15rem);
				padding: 0;
				border: none;
				background: transparent;
			}

			.panel {
				display: none;
			}

			:host([open]) .panel {
				display: block;
			}

			:host([theme="concrete"]) .panel {
				position: absolute;
				left: var(--menu-lanesize, 1rem);
				right: var(--menu-lanesize, 1rem);
				width: var(--menu-panel-width, 640px);
				max-width: calc(100% - calc(var(--menu-lanesize, 1rem) * 2));
				margin-top: var(--menu-gapsize, 0.15rem);
				margin-left: auto;
				padding: var(--menu-panel-padding, 1rem);
				background: var(--menu-panel-background, white);
				border-radius: var(--menu-panel-border-radius, 0);
				box-shadow: var(--menu-panel-box-shadow, none);
				backdrop-filter: var(--menu-panel-backdrop-filter, none);
				--webkit-backdrop-filter: var(--menu-panel-backdrop-filter, none);
			}

			:host([theme="concrete"][sticky]) .panel {
				top: 100%;
			}

			:host([theme="concrete"][lefty]) .panel {
				margin-left: unset;
				margin-right: auto;
			}
		`}static get properties(){return{toggle:{type:Function},open:{type:Boolean,reflect:!0},theme:{type:String,reflect:!0},lefty:{type:Boolean,reflect:!0},sticky:{type:Boolean,reflect:!0}}}constructor(){super(),this.theme="",this.open=!1,this.toggle=()=>{},this[oe]=()=>this.toggle()}createRenderRoot(){return this[ie]=this.attachShadow({mode:"closed"}),this[ie]}updated(e){e.has("open")&&this.open&&this[ie].querySelector("button").focus()}render(){return j`
			<div class="display">
				<button @click="${this[oe]}">
					<slot name="button"></slot>
				</button>
				<div class="panel">
					<slot></slot>
				</div>
			</div>
		`}}const ae=["scroll","resize"];const ne=Symbol("scrollTop"),re=Symbol("shadowRoot"),le=Symbol("activeIndex"),ce=Symbol("toggleIndex"),de=Symbol("scrollMarmot"),pe=Symbol("getMenuDisplays"),ue=Symbol("updateScrollPoint"),he=Symbol("handleBlanketClick"),me=(function(e=navigator.userAgent){const t=/(?:^|\s)Edge\/([\d\.]+)(?:\s|$)/i.exec(e);return!!t&&t[1]}()||"").startsWith("17.");function fe({mockStripeOperations:e}){return{triggerStripeConnectPopup:async({stripeAccountId:t})=>{await e.linkStripeAccount(t)},triggerCheckoutPopup:async({stripeAccountId:e})=>{console.log("")}}}!function(e){for(const t of Object.keys(e))customElements.define(t.replace(/([a-zA-Z])(?=[A-Z])/g,"$1-").toLowerCase(),e[t])}({MenuSystem:class extends te{static get properties(){return{"initially-hidden":{type:Boolean,reflect:!0},theme:{type:String,reflect:!0},lefty:{type:Boolean,reflect:!0},active:{type:Boolean,reflect:!0},sticky:{type:Boolean,reflect:!0},[ne]:{type:Number},[le]:{type:String}}}constructor(){super(),this.theme="concrete",this.active=!1,this.sticky=!1,this.lefty=!1,me&&this.setAttribute("data-edge-17","data-edge-17"),this[le]=void 0,this[ne]=0,this[de]=void 0,this[ue]=e=>{this.active||(this[ne]=e)},this[he]=()=>{this[ce](this[le])},this[ce]=e=>{this[le]=e===this[le]?void 0:e,this.active=void 0!==this[le]},this[pe]=()=>function(e){return Array.from(e.assignedNodes()).filter((e=>e instanceof HTMLElement))}(this[re].querySelector("slot")).filter((e=>e instanceof se))}createRenderRoot(){return this[re]=this.attachShadow({mode:"closed"}),this[re].addEventListener("slotchange",(()=>this.requestUpdate())),this[re]}_initScrollMarmot(){this.sticky&&!this[de]&&(this[de]=function({onScrollUpdate:e}){function t(){const t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;e(t)}for(const e of ae)window.addEventListener(e,t);return t(),{dispose(){for(const e of ae)window.removeEventListener(e,t,{passive:!0})}}}({onScrollUpdate:this[ue]}))}_disposeScrollMarmot(){this[de]&&(this[de].dispose(),this[de]=null)}connectedCallback(){super.connectedCallback(),this.isConnected&&this._initScrollMarmot()}disconnectedCallback(){super.disconnectedCallback(),this._disposeScrollMarmot()}updated(){this._initScrollMarmot(),this.sticky||this._disposeScrollMarmot(),this[pe]().forEach(((e,t)=>{e.theme=this.theme,e.lefty=this.lefty,e.toggle=()=>this[ce](t),e.open=t===this[le]}))}firstUpdated(){this["initially-hidden"]=!1}static get styles(){return Y`
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			*:focus {
				outline: var(--focus-outline, 2px solid cyan);
			}

			.system {
				position: static;
				margin: var(--menu-margin, auto);
			}

			:host([theme="concrete"]) .system {
				display: flex;
				align-items: flex-end;
				justify-content: flex-end;
			}

			:host([theme="concrete"][sticky]) .system {
				pointer-events: none;
				position: absolute;
				width: 100%;
				right: 0;
			}

			:host([theme="concrete"][sticky]) .system > * {
				pointer-events: all;
			}

			:host([theme="concrete"][lefty]) .system {
				right: auto;
				left: 0;
				align-items: flex-start;
				justify-content: flex-start;
			}

			:host([theme="concrete"]) .blanket {
				z-index: 99;
				display: none;
				position: fixed;
				background: var(--menu-blanket-background, rgba(0,0,0, 0.5));
				backdrop-filter: var(--menu-blanket-backdrop-filter, blur(5px));
				--webkit-backdrop-filter: var(--menu-blanket-backdrop-filter, blur(5px));
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
			}

			:host([theme="concrete"][active]) .blanket {
				display: block;
			}

			:host([theme="concrete"]) .list {
				z-index: 100;
				display: flex;
				align-items: flex-end;
				justify-content: flex-end;
				padding: var(--menu-gapsize, 0.15rem);
				background: var(--menu-background, rgba(240, 240, 240, 0.5));
			}

			:host([theme="concrete"][sticky]) .list {
				margin-right: var(--menu-lanesize, 1rem);
			}

			:host([theme="concrete"][sticky][lefty]) .list {
				margin-right: unset;
				margin-left: var(--menu-lanesize, 1rem);
			}

			:host([theme="concrete"]) .list slot::slotted(menu-display) {
				display: block;
				flex: 0 0 auto;
			}

			/* gross edge 17 stuff we all want to forget about */

			:host([data-edge-17][theme="concrete"]) .system {
				z-index: 100;
				position: absolute;
				width: 100%;
				right: 0;
			}

			:host([data-edge-17][theme="concrete"]) .blanket {
				z-index: 0;
			}
		`}render(){const e=this.sticky?this[ne]:0;return j`
			<div class="system" style="${`top: ${e}px`}">
				<div class="blanket" @click="${this[he]}"></div>
				<div class="list">
					<slot></slot>
				</div>
			</div>
		`}},MenuDisplay:se});class ge extends Error{name=this.constructor.name;code;constructor(e,t){super(t),this.code=e}}const be=Symbol("is_service"),ve=(e={})=>({forService:t=>we(t,[],e),forApi:t=>({withMetaMap(i,o=(async()=>{})){const s=ye(((t,i,s)=>we(t,s,e).withMeta(i,o)));return s(t,i)},withAuthMap(i){const o=ye(((t,i,o)=>we(t,o,e).withAuth(i)));return o(t,i)}})});function we(e,t,i){function o(o){const s={};return new Proxy({},{set:(e,t,i)=>(s[t]=i,!0),get:(a,n)=>s[n]??(async(...s)=>{const a=await o(),r=e.expose(a)[n];if(r)return i.spike?i.spike([...t,n].join("."),r,...s):r(...s);throw new ge(400,`renraku remote method "${n}" not found`)})})}return{withMeta:(t,i=(async()=>{}))=>o((async()=>e.policy(await t(),await i()))),withAuth:e=>o(e)}}function ye(e){return function t(i,o,s=[]){return function(e,t){const i={};for(const[o,s]of Object.entries(e))i[o]=t(s,o);return i}(i,((i,a)=>{const n=[...s,a];if(i[be]){return e(i,o[a],n)}{const e=i,s=o[a];return t(e,s,n)}}))}}const xe=()=>({policy:e=>({expose:t=>({[be]:be,expose:t,policy:e})})});function ke(){let e=[];return{publish:async(...t)=>{const i=e.map((e=>e(...t)));await Promise.all(i)},subscribe:t=>(e.push(t),()=>{e=e.filter((e=>e!==t))}),dispose:()=>{e=[]}}}const Se="function"==typeof atob;const Ie=Object.freeze({encode:e=>{const t=function(e){return Se?btoa(e):Buffer.from(e).toString("base64")}(e);return function(e){return e+Array((4-e.length%4)%4+1).join("=")}(t.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"))},decode:e=>function(e){return Se?atob(e):Buffer.from(e,"base64").toString("binary")}(e.replace(/-/g,"+").replace(/_/g,"/"))});const $e=function(e){const[t,i]=e.split(".");return{header:Pe(t),data:Pe(i)}};function Pe(e){return JSON.parse(decodeURIComponent(Ie.decode(e).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join("")))}function Ae(e){return!!e&&!function(e){const t=1e3*e;return Date.now()>t-6e4}($e(e).data.exp)}const _e=e=>$e(e).data.payload;function Oe({appId:e,storage:t}){let i;async function o(){return{accessToken:await i.getValidAccessToken()}}return{metaMap:{auth:{apps:{appService:o,appEditService:o},permissions:{permissionsService:o},users:{greenService:async()=>{},loginService:o,personalService:o,userService:o}},example:{exampleService:o},administrative:{roleAssignmentService:o},questions:{questionsModerationService:o,questionsPostingService:o,questionsReadingService:o,questionsAnsweringService:o},videos:{dacastService:o,contentService:o},notes:{notesService:o}},installAuthMediator:function({greenService:o}){return i=function({appId:e,storage:t,greenService:i}){const o=ke(),s=ke(),a=`auth-tokens-${e}`,n=async()=>await t.read(a)??{accessToken:void 0,refreshToken:void 0},r=async e=>t.write(a,e);async function l(e){const t=_e(e.accessToken);return await r(e),o.publish(),await s.publish(t),t}async function c(t){const o=await i.authorize({appId:e,refreshToken:t,scope:{core:!0}});return{access:await l({accessToken:o,refreshToken:t}),accessToken:o}}const d=async()=>{const{accessToken:e,refreshToken:t}=await n();return Ae(e)?{accessToken:e,access:_e(e)}:Ae(t)?c(t):c(void 0)};return{subscribeToAccessChange:s.subscribe,subscribeToTokenChange:o.subscribe,async initialize(){const{access:e}=await d();return await s.publish(e),e},getValidAccess:async()=>(await d()).access,getValidAccessToken:async()=>(await d()).accessToken,login:async e=>l(e),logout:async()=>(await r({accessToken:void 0,refreshToken:void 0}),(await d()).access),async reauthorize(){const e=await n();return await r({...e,accessToken:void 0}),(await d()).access}}}({appId:e,storage:t,greenService:o}),i}}}async function Ce(e){const t=Date.now(),i=await e;return[Date.now()-t,i]}function Te({api:e,appId:t,storage:i,headers:o,logging:s}){const{metaMap:a,installAuthMediator:n}=Oe({appId:t,storage:i});let r;const l=ve({spike:async(e,t,...i)=>{const[o]=await Ce(async function(e){if(e){const{min:t,max:i}=e;if(t>i)throw new Error("invalid mock latency (min cannot exceed max)");const o=i-t,s=t+Math.random()*o;return new Promise((e=>setTimeout(e,s)))}}(r)),[a,n]=await Ce(t(...i));return s&&console.log(`📡 ${e}() ${a}ms + mock ${o}ms`),n}}).forApi(e).withMetaMap(a,(async()=>o));return{remote:l,authMediator:n({greenService:l.auth.users.greenService}),setMockLatency:function(e){r=e}}}async function Me({appId:e,appOrigin:t,storage:i,backend:o}){const{remote:s,authMediator:a,setMockLatency:n}=Te({appId:e,storage:i,logging:!0,api:o.api,headers:{origin:t}});return function({appId:e,authMediator:t}){const i=new BroadcastChannel("tokenChangeEvent");t.subscribeToTokenChange((()=>i.postMessage({appId:e}))),i.onmessage=i=>{i.data.appId===e&&t.initialize()}}({appId:e,authMediator:a}),{remote:s,authMediator:a,setMockLatency:n}}!function(e){var t=[];function i(i){var o=this,s="$BroadcastChannel$"+(i=String(i))+"$";t[s]=t[s]||[],t[s].push(this),this._name=i,this._id=s,this._closed=!1,this._mc=new MessageChannel,this._mc.port1.start(),this._mc.port2.start(),e.addEventListener("storage",(function(t){if(t.storageArea===e.localStorage&&null!=t.newValue&&""!==t.newValue&&t.key.substring(0,s.length)===s){var i=JSON.parse(t.newValue);o._mc.port2.postMessage(i)}}))}i.prototype={get name(){return this._name},postMessage:function(i){var o=this;if(this._closed){var s=new Error;throw s.name="InvalidStateError",s}var a=JSON.stringify(i),n=this._id+String(Date.now())+"$"+String(Math.random());e.localStorage.setItem(n,a),setTimeout((function(){e.localStorage.removeItem(n)}),500),t[this._id].forEach((function(e){e!==o&&e._mc.port2.postMessage(JSON.parse(a))}))},close:function(){if(!this._closed){this._closed=!0,this._mc.port1.close(),this._mc.port2.close();var e=t[this._id].indexOf(this);t[this._id].splice(e,1)}},get onmessage(){return this._mc.port1.onmessage},set onmessage(e){this._mc.port1.onmessage=e},addEventListener:function(){return this._mc.port1.addEventListener.apply(this._mc.port1,arguments)},removeEventListener:function(){return this._mc.port1.removeEventListener.apply(this._mc.port1,arguments)},dispatchEvent:function(){return this._mc.port1.dispatchEvent.apply(this._mc.port1,arguments)}},e.BroadcastChannel=e.BroadcastChannel||i}(self);const Ee=6e4,Re=864e5,qe=({platformHome:e,platformOrigins:t})=>({server:{port:4999,detailedLogs:!0},platform:{legalLink:"https://xiome.io/legal",technician:{email:"chasemoskal@gmail.com"},appDetails:{appId:"27a9f4e61286d562c85df1862e88c50e6b5c0707cc84e3e1df4aeb9d9c236814",label:"Xiome Cloud",home:e,origins:t}},dacast:"mock-mode",email:"mock-console",database:"mock-storage",stripe:"mock-mode",chat:{port:8001},crypto:{keys:"mock-mode",tokenLifespans:{login:3e5,refresh:30*Re,access:3e5,external:3e5}}}),De="undefined"!=typeof process&&"node"===process?.release?.name;function je(e){for(const t of e)if(!"0123456789abcdef".includes(t))return!1;return!0}var Le,Ue,Ne,ze=function(e,t,i,o,s){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?s.call(e,i):s?s.value=i:t.set(e,i),i},Ve=function(e,t,i,o){if("a"===i&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?o:"a"===i?o.call(e):o?o.value:t.get(e)};class Be{constructor(e){Le.set(this,void 0),Ue.set(this,void 0),ze(this,Le,e,"f"),ze(this,Ue,function(e){let t="";for(const i of new Uint8Array(e))t+=("0"+(255&i).toString(16)).slice(-2);return t}(e),"f")}static fromBinary(e){return new Be(e)}static fromString(e){const t=function(e){const t=e.toLowerCase();if(!je(t))throw new Error("decodeHex: invalid hex");const i=[];for(let e=0;e<t.length;e+=2)i.push(parseInt(t.substr(e,2),16));return new Uint8Array(i).buffer}(e);return new Be(t)}static isId(e){return 64===e.length&&function(e){return je(e.toLowerCase())}(e)}get binary(){return Ve(this,Le,"f")}get string(){return Ve(this,Ue,"f")}toBinary(){return Ve(this,Le,"f")}toString(){return Ve(this,Ue,"f")}}async function He({isNode:e=De}={}){const t=e?await(async()=>{const e=await import("crypto");return t=>e.randomBytes(t).buffer})():e=>crypto.getRandomValues(new Uint8Array(e)).buffer,i=e?await(async()=>{const e=await import("crypto");return(t,i)=>e.timingSafeEqual(Buffer.from(t,"utf8"),Buffer.from(i,"utf8"))})():(e,t)=>(console.warn("insecure compare"),e===t);function o(){const e=t(8),i=new Int8Array(e);i[7]=63,i[6]|=240;return new DataView(e).getFloat64(0,!0)-1}function s(e){return e[Math.floor(o()*e.length)]}return{random:o,compare:i,randomId:function(){const e=t(32);return new Be(e)},randomBuffer:t,randomSample:s,randomSequence:function(e,t){const i=[];for(;i.length<e;){const e=s(t);i.push(e)}return i.join("")}}}function Fe(e){let t;return async function(...i){if(t)return t;{t=e(...i);const o=await t;return t=void 0,o}}}Le=new WeakMap,Ue=new WeakMap,function(e){var t;(t=e.Mode||(e.Mode={}))[t.None=0]="None",t[t.Loading=1]="Loading",t[t.Error=2]="Error",t[t.Ready=3]="Ready"}(Ne||(Ne={}));const We={none:()=>({mode:Ne.Mode.None}),loading:()=>({mode:Ne.Mode.Loading}),error:e=>({mode:Ne.Mode.Error,reason:e}),ready:e=>({mode:Ne.Mode.Ready,value:e}),replaceValue:(e,t)=>e.mode===Ne.Mode.Ready?{...e,value:t}:e,isNone:e=>e.mode===Ne.Mode.Ready,isLoading:e=>e.mode===Ne.Mode.Loading,isError:e=>e.mode===Ne.Mode.Error,isReady:e=>e.mode===Ne.Mode.Ready,value:e=>e.mode===Ne.Mode.Ready?e.value:void 0,select(e,t){switch(e.mode){case Ne.Mode.None:return t.none();case Ne.Mode.Loading:return t.loading();case Ne.Mode.Error:return t.error(e.reason);case Ne.Mode.Ready:return t.ready(e.value)}},async operation({promise:e,errorReason:t="an error occurred",setOp:i}){i(We.loading());try{const t=await e;return i(We.ready(t)),t}catch(e){throw i(We.error(t)),e}},mode:e=>We.select(e,{none:()=>"none",loading:()=>"loading",error:()=>"error",ready:()=>"ready"}),combine(...e){const t=!!e.find((e=>e.mode===Ne.Mode.Error)),i=!!e.find((e=>e.mode===Ne.Mode.Loading)),o=!!e.find((e=>e.mode!==Ne.Mode.Ready));return t?{mode:Ne.Mode.Error,reason:"error"}:i?{mode:Ne.Mode.Loading}:o?{mode:Ne.Mode.None}:{mode:Ne.Mode.Ready,value:void 0}},debug:e=>We.select(e,{none:()=>["<op {mode: None}>"],loading:()=>["<op {mode: Loading}>"],error:e=>[`<op {mode: Error, reason: "${e}"}>`],ready:e=>["<op {mode: Ready, value: ",e,"}>"]})};function Qe(){const e=new Map;return{subscribe(t){const i=Symbol();return e.set(i,t),()=>{e.delete(i)}},publish:t=>{for(const[,i]of e)i(t)},clear(){e.clear()}}}function Ke(e,t){let i,o,s,a,n;function r(){i=void 0,o&&clearTimeout(o),o=void 0,s=new Promise(((e,t)=>{a=e,n=t}))}return r(),(...l)=>(i=l,o&&clearTimeout(o),o=setTimeout((()=>{Promise.resolve(t(...i)).then((e=>a(e))).catch((e=>n(e))).finally((()=>r()))}),e),s)}class Xe extends Error{constructor(){super(...arguments),this.name=this.constructor.name}}class Je extends Xe{}class Ge extends Xe{}function Ye(){let e;const t=new Map;let i=Promise.resolve();return{get wait(){return i},track(i,o,s){const a=Symbol();return e={identifier:a,session:{observer:o,reaction:s}},o(i),e=void 0,()=>function(e){for(const[,i]of t)i.delete(e)}(a)},avoidCircular(t){if(e)throw new Ge(`cannot set any properties within a reaction, not even "${t}"`)},triggerReactions:(()=>{const e=new Set,o=Ke(1,(i=>{for(const o of e)for(const[,{observer:e,reaction:s}]of t.get(o)??[])s?s(e(i)):e(i);e.clear()}));return(t,s)=>{e.add(s);const a=o(t);i=i.then((()=>a))}})(),reactionRegistration(i){if(e){let o=t.get(i);o||(o=new Map,t.set(i,o)),o.set(e.identifier,e.session)}}}}function Ze(e){const t=Ye();function i(i,o){return t.reactionRegistration(o),e[o]}const o=new Proxy(e,{get:i,set(e,t){throw new Je(`readonly state property "${t}"`)}}),{publish:s,subscribe:a}=Qe(),n=Ke(1,(()=>s(o)));let r=Promise.resolve();const l=new Proxy(e,{get:i,set:(i,s,a)=>(t.avoidCircular(s),e[s]=a,t.triggerReactions(o,s),r=n(),!0)});return{readable:o,writable:l,subscribe:a,track:(e,i)=>t.track(o,e,i),async wait(){await Promise.all([r,t.wait])}}}const et={"view all chats":"985dc13378d1129e4dd6303fe9e52dff97d53568ce10814805f481159c788710","participate in all chats":"bd0c8dfdf3eef893a5d9f8b5d0a6cad19ad80e949ebd70428f0d7525099cdd10"},tt={"moderate all chats":"693d969777a3998de6f9a4a5583917f4e672bb96ed08c571fc7486593ca98993"},it={...et,...tt};function ot(e,t){const i={};for(const o of Object.keys(e))i[o]=t;return i}function st(e,t){return ot(t,{active:e,immutable:!0})}const at={"view all videos":"22f380eb0c5c7463b8a16fcdfc2f5e58257d38f94972924e70d27a08fabb5506","moderate videos":"1b19013344a59cb49bfd9bddc8dd817a9e4cfa29003437021df24bdc832ec246"},nt={...at},rt={"read questions":"5b19b929648cbbe26c052a5016892b370f048eead1e6a303a50b7f5234ec5161","post questions":"aeaae6139d05f77193ca7c272a65977c70cb188f3070359866237a5ade84ba15","like questions":"5490898c541d733956b28664e7536673842e73b289fc45ab9caf143138c14a3e","report questions":"f2f89d433f398b267e320e0e3b9929eb3934af5c02f7e3fb2e032fd19399ad21",...et},lt={"edit any profile":"4240ca0331e8679a444c6c4c6a803d8a12893f1554460af426064b980164c8ee","customize permissions":"f380d9b4d1001da8dc86a6e0b6a0721b92ed8060c52cd4ba433e76cbd9efe6b5","answer questions":"afaa00f7bc9ab09d3bbc61a26f6d9bc666cd9bb7ac270ebbdeba3cf4dd3ab9a9","moderate questions":"f6a3152a13f313a60f84d82ba8f7765afb19f70c04ef14688d802237a5d2ab5e","view stats":"092866ae6378833e43ec7001188aa1829d4cf2858e42da0ad3f44a2fedbcb07b","administrate user roles":"a072e9dd003a762e7d693658d8ac724be352b18da240843f691595c89020e350",...at,"control stripe account":"f236bd2175fbecf7925483884b8c2a2ffe0dd2f0a864cbd638046f6fc58944b5","manage store":"bea0ef0db58a0d8c9ab96bb9b14f889a19893064361b0877626b510b798c6fb8","give away freebies":"c2712efd490c67b44946bc6e1bbe82aee5b8ede384cff614ba7435d429993ec6",...tt},ct={"edit any app":"e5fadb4b03badd6699b355ec43e1d150d6f4df81ecc291b5b742f06ebe62a0f8","view platform stats":"eec7d2ddc20df6080c4166a3dea0b2643b483ce61326cbefad95e45824810692"},dt={},pt=!0,ut=!1,ht={privileges:{...rt,...lt,universal:"c1cb5ac1000af6081ff47e80804de7542b57a1425c3faac8153e708aaf79271a",banned:"ffff9ebcbe8f69f3520ec574f5a1489a70bf04521d7a85fcbd25c54cc22802f1"},roles:{everybody:{roleId:"aaaa777dc7d7e9b5e9e0386abf0cf2f059cda4f71779cc910b85e8f504452b23",public:!0,assignable:!1,hasPrivileges:{...st(ut,rt),...st(ut,lt),universal:{active:!0,immutable:!0},banned:{active:!1,immutable:!0},"read questions":{active:!0,immutable:!1},"view all chats":{active:!0,immutable:!1}}},authenticated:{roleId:"bbbb642d549d06113953a01fb52a8e010150edc502b929395bfb32d250d44b1c",public:!1,assignable:!1,hasPrivileges:{...function(e,t){return ot(t,{active:e,immutable:!1})}(pt,rt),...st(ut,lt),universal:{active:!1,immutable:!0},banned:{active:!1,immutable:!0}}},banned:{roleId:"dead633608412f8eefbb40f4678ef2bafaeb7883d09a6094dafe5f69dd6a8684",public:!0,assignable:!0,hasPrivileges:{...st(ut,rt),...st(ut,lt),universal:{active:!1,immutable:!0},banned:{active:!0,immutable:!0}}},technician:{roleId:"9999d97119a83ea3853273a93e24ae0a1f2a994eccb21dacacab6ff860d8d869",public:!0,assignable:!1,hasPrivileges:{...st(pt,rt),...st(pt,lt),universal:{active:!1,immutable:!0},banned:{active:!1,immutable:!0}}}}},mt={privileges:{...ht.privileges,...ct},roles:{...ht.roles,everybody:{...ht.roles.everybody,hasPrivileges:{...ht.roles.everybody.hasPrivileges,...st(ut,ct)}},authenticated:{...ht.roles.authenticated,hasPrivileges:{...ht.roles.authenticated.hasPrivileges,...st(ut,ct)}},banned:{...ht.roles.banned,hasPrivileges:{...ht.roles.banned.hasPrivileges,...st(ut,ct)}},technician:{...ht.roles.technician,hasPrivileges:{...ht.roles.technician.hasPrivileges,...st(pt,rt),...st(pt,ct)}}}},ft={privileges:{...ht.privileges,...dt},roles:{...ht.roles,everybody:{...ht.roles.everybody,hasPrivileges:{...ht.roles.everybody.hasPrivileges,...st(ut,dt)}},authenticated:{...ht.roles.authenticated,hasPrivileges:{...ht.roles.authenticated.hasPrivileges,...st(ut,dt)}},banned:{...ht.roles.banned,hasPrivileges:{...ht.roles.banned.hasPrivileges,...st(ut,dt)}},admin:{roleId:"d21e66058b95b3b2e80c1a00c82abd56b8ec7a4b20f0424c2a00cc6ba352efeb",public:!0,assignable:!1,hasPrivileges:{...st(pt,dt),...st(pt,rt),...st(pt,lt),universal:{active:!1,immutable:!0},banned:{active:!1,immutable:!0}}},technician:{...ht.roles.technician,hasPrivileges:{...ht.roles.technician.hasPrivileges,...st(pt,dt)}}}};function gt(e){return{moderateAllChats:e.includes(it["moderate all chats"]),participateInAllChats:e.includes(it["moderate all chats"])||e.includes(it["participate in all chats"]),viewAllChats:e.includes(it["moderate all chats"])||e.includes(it["participate in all chats"])||e.includes(it["view all chats"]),banned:e.includes(ft.privileges.banned)}}var bt;function vt({state:e,reconnect:t,disconnect:i}){async function o(){return We.isReady(e.readable.connectionOp)?We.value(e.readable.connectionOp):t()}const s=new Map,a=new Map;function n(t){let i=a.get(t);return i||(i=o().then((e=>e.serverside.chatServer.roomSubscribe(t).then((()=>e)))).then((i=>function({label:e,serverside:t,state:i}){const o=()=>i.readable.cache.rooms[e],s=()=>We.value(i.readable.accessOp);return{get posts(){return o()?.posts??[]},get status(){return o()?.status??bt.Offline},get muted(){return i.readable.cache.mutedUserIds},get weAreMuted(){const{user:{userId:e}}=s();return i.readable.cache.mutedUserIds.includes(e)},get weAreBanned(){const{permit:{privileges:e}}=s();return e.includes(ft.privileges.banned)},setRoomStatus(i){t.chatServer.setRoomStatus(e,i)},post(i){t.chatServer.post(e,i)},remove(i){t.chatServer.remove(e,i)},clear(){t.chatServer.clear(e)},mute(e){t.chatServer.mute([e])},unmute(e){t.chatServer.unmute([e])},unmuteAll(){t.chatServer.unmuteAll()}}}({label:t,state:e,serverside:i.serverside}))),a.set(t,i)),i}return{getRoomSession:async function(e){const t=function(e){let t=s.get(e);return t||(t=new Set,s.set(e,t)),t}(e),r=Symbol();return t.add(r),{dispose:function(){t.delete(r),0===t.size&&function(e){const t=a.get(e);o().then((i=>t.then((t=>{i.serverside.chatServer.roomUnsubscribe(e)})))).then((()=>{if(a.delete(e),0===a.size)return i()}))}(e)},room:await n(e)}},updateAuthSituation:async function(e){e?a.size>0&&await o():0===a.size&&await i()}}}!function(e){e[e.Offline=0]="Offline",e[e.Online=1]="Online"}(bt||(bt={}));function wt({chatConnect:e,getChatMeta:t}){const i=function(){const e=new Map;return{subscribe(...t){if(t.length){const i=Symbol();return e.set(i,t),()=>{e.delete(i)}}},async publish(...t){await Promise.all(Array.from(e.values()).flat().map((e=>e(...t))))},clear(){e.clear()}}}(),o=Ze({accessOp:We.none(),connectionOp:We.none(),cache:{mutedUserIds:[],rooms:{}}}),s=(({state:e,onChange:t})=>({chatClient:xe().policy((async()=>{})).expose((()=>{async function i(){await e.wait(),t()}return{async roomStatusChanged(t,o){e.writable.cache={...e.writable.cache,rooms:{...e.writable.cache.rooms,[t]:{...e.writable.cache.rooms[t],status:o}}},await i()},async postsAdded(t,o){e.writable.cache={...e.writable.cache,rooms:{...e.writable.cache.rooms,[t]:{...e.writable.cache.rooms[t],posts:[...e.writable.cache.rooms[t]?.posts??[],...o].slice(0,50)}}},await i()},async postsRemoved(t,o){e.writable.cache={...e.writable.cache,rooms:{...e.writable.cache.rooms,[t]:{...e.writable.cache.rooms[t],posts:(e.writable.cache.rooms[t]?.posts??[]).filter((e=>!o.includes(e.postId)))}}},await i()},async roomCleared(t){e.writable.cache={...e.writable.cache,rooms:{...e.writable.cache.rooms,[t]:{...e.writable.cache.rooms[t],posts:[]}}},await i()},async usersMuted(t){e.writable.cache={...e.writable.cache,mutedUserIds:[...e.writable.cache.mutedUserIds,...t]},await i()},async usersUnmuted(t){e.writable.cache={...e.writable.cache,mutedUserIds:e.writable.cache.mutedUserIds.filter((e=>!t.includes(e)))},await i()},async unmuteAll(){e.writable.cache={...e.writable.cache,mutedUserIds:[]},await i()}}}))}))({state:o,onChange:i.publish}),a=Fe((async function(){const i=We.value(o.readable.connectionOp)??await We.operation({setOp:e=>o.writable.connectionOp=e,promise:e({clientsideApi:s,handleDisconnect:()=>o.writable.connectionOp=We.none()})}),a=await t();return await i.serverside.chatServer.updateUserMeta(a),i}));async function n(){const e=We.value(o.readable.connectionOp);e&&(o.writable.connectionOp=We.none(),await e.disconnect())}const r=vt({state:o,reconnect:a,disconnect:n});return{state:o.readable,subscribe:o.subscribe,subscribeToChange:i.subscribe,get allowance(){return gt(We.value(o.readable.accessOp)?.permit.privileges??[])},async updateAccessOp(e){o.writable.accessOp=e;const i=We.value(e);await r.updateAuthSituation(!!i);const s=We.value(o.readable.connectionOp);if(s){const e=await t();await s.serverside.chatServer.updateUserMeta(e)}},session:r.getRoomSession,disconnect:n,reconnect:a}}function yt({notesService:e}){const t=Ze({accessOp:We.none(),statsOp:We.none()}),i=Qe(),o=Qe();function s(){return!!We.value(t.readable.accessOp)?.user}function a(){return We.value(t.readable.statsOp)??{newCount:0,oldCount:0}}const n=Fe((async function(){return We.operation({promise:e.getNotesStats(),setOp:e=>t.writable.statsOp=e})}));let r=!1;return{initialize:async function(){if(!r&&(r=!0,s()))return n()},state:t.readable,stateSubscribe:t.subscribe,async updateAccessOp(e){t.writable.accessOp=e,s()&&await async function(){if(r)return n()}(),i.publish(We.value(e))},get isLoggedIn(){return s()},get stats(){return a()},propagateChangeToOtherTabs:o,loadStats:n,overwriteStatsOp(e){t.writable.statsOp=e},createNotesCacheDetails:(()=>{const t=function({propagateChangeToOtherTabs:e,notesService:t,getStats:i,loadStats:o,getIsLoggedIn:s}){async function a(e){return t.getNewNotes(e)}async function n(e){return t.getOldNotes(e)}async function r(i,s){await t.markNotesNewOrOld({old:i,noteIds:s}),await o(),e.publish(void 0)}return function(){const l=Ze({old:!1,pageNumber:1,pageSize:10,notesOp:We.none()});function c(){l.writable.pageNumber=1,l.writable.pageSize=10}async function d(){if(!s())return l.writable.notesOp=We.ready([]),[];const{old:e,pageNumber:t,pageSize:i}=l.readable,o={offset:(t-1)*i,limit:i};await We.operation({setOp:e=>l.writable.notesOp=e,promise:e?n(o):a(o)})}function p(){const{old:e,pageSize:t}=l.readable,{oldCount:o,newCount:s}=i(),a=e?o:s;return Math.ceil(a/t)}const u=()=>l.writable.pageNumber<p(),h=()=>l.writable.pageNumber>1;return{subscribe:l.subscribe,cacheState:l.readable,async loginStatusChanged(){c(),await d()},get notes(){return We.value(l.readable.notesOp)},fetchAppropriateNotes:d,async switchTabNew(){l.writable.old=!1,c(),await d()},async switchTabOld(){l.writable.old=!0,c(),await d()},get isNextPageAvailable(){return u()},get isPreviousPageAvailable(){return h()},async nextPage(){if(!u())throw new Error("no next page");l.writable.pageNumber+=1,await d()},async previousPage(){if(!h())throw new Error("no previous page");l.writable.pageNumber-=1,await d()},async markAllNotesOld(){await t.markAllNotesOld(),await o(),e.publish(void 0),await d()},async markSpecificNoteOld(e){await r(!0,[e]),l.readable.pageNumber>p()&&l.readable.pageNumber>1&&(l.writable.pageNumber-=1),await d()},async markSpecificNoteNew(e){await r(!1,[e]),l.readable.pageNumber>p()&&l.readable.pageNumber>1&&(l.writable.pageNumber-=1),await d()},get totalPages(){return p()}}}}({notesService:e,propagateChangeToOtherTabs:o,getStats:a,loadStats:n,getIsLoggedIn:s});return()=>{const e=t();return{cache:e,setup:()=>i.subscribe((()=>e.loginStatusChanged()))}}})()}}function xt({dacastService:e}){const t=Qe(),i=Ze({accessOp:We.none(),linkedAccountOp:We.none()});let o=!1;async function s(){o&&(()=>{const e=We.value(i.readable.accessOp);return e&&e.permit.privileges.includes(nt["moderate videos"])})()&&await async function(){return We.operation({promise:e.getLink(),setOp:e=>i.writable.linkedAccountOp=e})}()}return{state:i.readable,subscribe:i.subscribe,onLinkChange:t.subscribe,async updateAccessOp(e){i.writable.accessOp=e,i.writable.linkedAccountOp=We.none(),await s()},async initialize(){o||(o=!0,await s())},get linkedAccount(){return We.value(i.readable.linkedAccountOp)},linkAccount:async({apiKey:o})=>We.operation({setOp:e=>i.writable.linkedAccountOp=e,promise:e.setLink({apiKey:o}).then((e=>(t.publish(e),e)))}),unlinkAccount:async()=>We.operation({setOp:e=>i.writable.linkedAccountOp=e,promise:e.clearLink().then((()=>t.publish(void 0)))})}}function kt(e){const t=xt(e),i=function({contentService:e}){const t=Ze({accessOp:We.none(),catalogOp:We.none(),viewsOp:We.none(),privilegesOp:We.none(),showsOp:We.none()}),i=new Set,o=new Set;function s(){return We.value(t.readable.accessOp)}let a=!1;async function n(){a=!0;const i=s();i&&i.permit.privileges.includes(nt["moderate videos"])&&await We.operation({promise:e.fetchModerationData(),setOp:e=>{const i=We.value(e);t.writable.catalogOp=We.replaceValue(e,i?.catalog??[]),t.writable.viewsOp=We.replaceValue(e,i?.views??[]),t.writable.privilegesOp=We.replaceValue(e,i?.privileges??[])}})}async function r(n){if(a=!0,!s()||o.has(n))return;o.add(n),i.add(n);const r=We.value(t.readable.showsOp)??[];let l;return await We.operation({setOp:e=>t.writable.showsOp=e,promise:e.getShows({labels:[n]}).then((e=>e[0])).then((e=>l=e)).then((e=>[...r.filter((e=>e.label!==n)),...e?[e]:[{label:n,details:void 0}]]))}),o.delete(n),l}async function l(){if(a=!0,!s())return;const n=Array.from(i).filter((e=>!o.has(e)));if(n.length){for(const e of n)o.add(e);await We.operation({setOp:e=>t.writable.showsOp=e,promise:e.getShows({labels:n}).then((e=>e.filter((e=>!!e))))});for(const e of n)o.delete(e)}}return{state:t.readable,subscribe:t.subscribe,async updateAccessOp(e){t.writable.accessOp=e,t.writable.catalogOp=We.none(),t.writable.viewsOp=We.none(),a&&(await n(),await l())},async onVideoHostingUpdate(){a&&(await n(),await l())},async initializeForModerationData(){a||await n()},async initializeForVideo(e){a?i.add(e):(await r(e),await n())},get allowance(){const e=We.value(t.readable.accessOp),i=t=>!!e&&e.permit.privileges.includes(nt[t]);return{canModerateVideos:i("moderate videos"),canViewAllVideos:i("moderate videos")||i("view all videos")}},get catalog(){return We.value(t.readable.catalogOp)??[]},get views(){return We.value(t.readable.viewsOp)??[]},get privileges(){return We.value(t.readable.privilegesOp)??[]},get shows(){return We.value(t.readable.showsOp)??[]},getView:e=>(We.value(t.readable.viewsOp)??[]).find((t=>t.label===e)),getPrivilege:e=>(We.value(t.readable.privilegesOp)??[]).find((t=>t.privilegeId===e)),getShow:e=>(We.value(t.readable.showsOp)??[]).find((t=>t.label===e)),async setView(i){const o=We.value(t.readable.viewsOp)??[];await We.operation({setOp:e=>t.writable.viewsOp=e,promise:e.writeView(i).then((()=>[...o.filter((e=>e.label!==i.label)),{...i.reference,label:i.label,privileges:i.privileges}]))}),await r(i.label)},async deleteView(i){const o=We.value(t.readable.viewsOp)??[];await We.operation({setOp:e=>t.writable.viewsOp=e,promise:e.deleteView({label:i}).then((()=>o.filter((e=>e.label!==i))))});const s=We.value(t.readable.showsOp)??[];t.writable.showsOp=We.replaceValue(t.readable.showsOp,s.filter((e=>e.label!==i)))}}}(e);return t.onLinkChange(i.onVideoHostingUpdate),{dacastModel:t,contentModel:i,updateAccessOp(e){t.updateAccessOp(e),i.updateAccessOp(e)}}}function St({appService:e,appEditService:t,getValidAccess:i}){const{readable:o,writable:s,subscribe:a}=Ze({active:!1,appRecords:We.none(),addingNewApp:We.none()}),n={setAppRecords(e){const t=We.value(e)??[];let i={};for(const e of t)i[e.appId]=We.ready(e);s.appRecords=We.replaceValue(e,i)},setIndividualAppRecord(e,t){if(We.isLoading(s.appRecords))throw new Error("cannot set individual app while apps are loading");const i=We.value(s.appRecords)??{};s.appRecords=We.ready({...i,[e]:t})},deleteIndividualAppRecord(e){if(!We.isReady(s.appRecords))throw new Error("cannot delete individual app while apps are loading");{const t=We.value(s.appRecords),i={};for(const[o,s]of Object.entries(t))o!==e&&(i[o]=s);s.appRecords=We.ready(i)}}};async function r(){return(await i())?.user?.userId}async function l(){s.active=!0;return We.operation({promise:(async()=>{const t=await r();return t?e.listApps({ownerUserId:t}):[]})(),setOp:e=>n.setAppRecords(e)})}return{state:o,subscribe:a,appEditService:t,getApp(e){const t=We.value(o.appRecords);return t?We.value(t[e]):void 0},loadApps:l,deleteApp:async function(e){await We.operation({promise:t.deleteApp({appId:e}),setOp:t=>{n.setIndividualAppRecord(e,We.replaceValue(t,function(e){const t=We.value(s.appRecords);return t?We.value(t[e]):void 0}(e)))}}),n.deleteIndividualAppRecord(e)},updateApp:async function(e,i){const o=We.value(s.appRecords);if(!o)throw new Error("cannot update app while loading records");const a=We.value(o[e]);if(!a)throw new Error("cannot update app not present in records");return We.operation({promise:t.updateApp({appId:e,appDraft:i}),setOp:t=>n.setIndividualAppRecord(e,We.replaceValue(t,{...a,...i}))})},registerApp:async function(i){const o=await r();return await We.operation({errorReason:"failed to register app",promise:(async()=>{const s=await e.registerApp({appDraft:i,ownerUserId:o});return await t.assignPlatformUserAsAdmin({appId:s.appId,platformUserId:o}),s})(),setOp:e=>{if(s.addingNewApp=We.replaceValue(e,null),We.isReady(e)){const t={...We.value(e),...i};n.setIndividualAppRecord(t.appId,We.ready(t))}}})},async updateAccessOp(e){o.active&&await l()}}}function It(e,t,i){const o=[...e];for(const e of t){!!o.find((t=>i(t,e)))||o.push(e)}return o}function $t(e){return JSON.parse(JSON.stringify(e))}function Pt(e){Object.freeze(e);for(const t of Object.values(e))t&&"object"==typeof t&&Pt(t);return e}const At=e=>null!=e;function _t(e,t){if(!At(e)||!At(t))return e===t;for(const[i,o]of Object.entries(e)){if(!t.hasOwnProperty(i))return!1;const e=t[i];switch(typeof o){case"object":if(!_t(o,e))return!1;break;case"function":if(!At(e)||o.toString()!==e.toString())return!1;break;default:if(o!==e)return!1}}for(const[i]of Object.entries(e))if(!t.hasOwnProperty(i))return!1;for(const[i]of Object.entries(t))if(!e.hasOwnProperty(i))return!1;return!0}function Ot({state:e,actions:t}){let i=Pt($t(e));const o=t(e),{publish:s,subscribe:a,dispose:n}=ke(),r=Ke(1,s),l={};for(const[t,s]of Object.entries(o))l[t]=(...t)=>{s(...t),i=Pt($t(e)),r()};return{actions:l,onStateChange:a,clearStateListeners:n,getState:()=>i}}function Ct({happy:e,questionsPostingService:t,questionsAnsweringService:i,questionsModerationService:o,getAccess:s,loadQuestionsForBoard:a}){const{actions:n,getState:r}=e;return e=>({getPermissions(){const{access:e}=r();return{"read questions":!!e&&e.permit.privileges.includes(ft.privileges["read questions"]),"post questions":!!e&&(e.permit.privileges.includes(ft.privileges["post questions"])&&!e.permit.privileges.includes(ft.privileges.banned)),"moderate questions":!!e&&e.permit.privileges.includes(ft.privileges["moderate questions"]),"answer questions":!!e&&e.permit.privileges.includes(ft.privileges["answer questions"]),"like questions":!!e&&e.permit.privileges.includes(ft.privileges["like questions"]),"report questions":!!e&&e.permit.privileges.includes(ft.privileges["report questions"])}},getBoardName:()=>e,getAccess:()=>r().access,getBoardOp:()=>r().boardOps[e],getPostingOp:()=>r().postingOp,getQuestions:()=>r().questions.filter((t=>t.board===e)).filter((e=>!1===e.archive)).map((e=>({...e,answers:e.answers.filter((e=>!1===e.archive))}))),getUser:e=>r().users.find((t=>t.userId===e)),async loadQuestions(){await a(e)},async postQuestion({content:i}){const o=await We.operation({promise:t.postQuestion({questionDraft:{board:e,content:i}}),setOp:e=>n.setPostingOp(We.replaceValue(e,void 0))});n.addQuestions([o]);const a=We.value(s());return n.addUsers([a.user]),o},async postAnswer(e,t){const o=await We.operation({promise:i.postAnswer({questionId:e,answerDraft:t}),setOp:e=>n.setPostingOp(We.replaceValue(e,void 0))});n.addAnswer(o);const a=We.value(s());return n.addUsers([a.user]),o},async likeQuestion(e,i){await t.likeQuestion({like:i,questionId:e}),n.setQuestionLike(e,i)},async likeAnswer(e,t,o){await i.likeAnswer({answerId:t,like:o}),n.setAnswerLike(e,t,o)},async reportQuestion(e,i){await t.reportQuestion({report:i,questionId:e}),n.setQuestionReport(e,i)},async reportAnswer(e,t,o){await i.reportAnswer({answerId:t,report:o}),n.setAnswerReport(e,t,o)},async archiveQuestion(e,i){await t.archiveQuestion({archive:i,questionId:e}),n.setQuestionArchive(e,i)},async archiveAnswer(e,t,o){await i.archiveAnswer({answerId:t,archive:o}),n.setAnswerArchive(e,t,o)},async archiveBoard(){await o.archiveBoard({board:e});for(const e of r().questions)n.setQuestionArchive(e.questionId,!0)}})}function Tt(e){const{questionsReadingService:t}=e,i=Ot({state:{access:void 0,users:[],questions:[],boardOps:{},postingOp:We.ready(void 0)},actions:e=>({setAccess(t){e.access=t},setBoardOp(t,i){e.boardOps={...e.boardOps,[t]:i}},setPostingOp(t){e.postingOp=t},addUsers(t){e.users=[...It(t.filter((e=>!!e)),e.users,((e,t)=>e.userId===t.userId))]},addQuestions(t){e.questions=[...It(t,e.questions,((e,t)=>e.questionId===t.questionId))]},addAnswer(t){const i=e.questions.find((e=>e.questionId===t.questionId));if(!i)throw new Error(`can't find question to add answer, question id: "${t.questionId}"`);const o={...i,answers:[...i.answers,t]};e.questions=[...It([o],e.questions,((e,t)=>e.questionId===t.questionId))]},setQuestionLike(t,i){e.questions=e.questions.map((e=>e.questionId===t?{...e,liked:i,likes:e.liked===i?e.likes:i?e.likes+1:e.likes-1}:{...e}))},setAnswerLike(t,i,o){e.questions=e.questions.map((e=>e.questionId===t?{...e,answers:e.answers.map((e=>e.answerId===i?{...e,liked:o,likes:e.liked===o?e.likes:o?e.likes+1:e.likes-1}:{...e}))}:{...e}))},setAnswerReport(t,i,o){e.questions=e.questions.map((e=>e.questionId===t?{...e,answers:e.answers.map((e=>e.answerId===i?{...e,reported:o,reports:e.reported===o?e.reports:o?e.reports+1:e.reports-1}:{...e}))}:{...e}))},setQuestionReport(t,i){e.questions=e.questions.map((e=>e.questionId===t?{...e,reported:i,reports:e.reported===i?e.reports:i?e.reports+1:e.reports-1}:{...e}))},setQuestionArchive(t,i){e.questions=e.questions.map((e=>e.questionId===t?{...e,archive:i}:{...e}))},setAnswerArchive(t,i,o){e.questions=e.questions.map((e=>e.questionId===t?{...e,answers:e.answers.map((e=>e.answerId===i?{...e,archive:o}:{...e}))}:{...e}))}})}),{actions:o,getState:s,onStateChange:a}=i;async function n(e){await We.operation({promise:(async()=>{const{users:i,questions:s}=await t.fetchQuestions({board:e});o.addUsers(i),o.addQuestions(s)})(),setOp:t=>o.setBoardOp(e,t)})}return{onStateChange:a,makeBoardModel:Ct({happy:i,loadQuestionsForBoard:n,...e}),accessChange:e=>{o.setAccess(e),e?.user&&o.addUsers([e.user]),async function(){const e=s();await Promise.all(Object.keys(e.boardOps).map(n))}()}}}class Mt extends Error{}class Et extends Mt{constructor(){super("login token has expired")}}function Rt({roleAssignmentService:e,reauthorize:t}){const i=Ze({accessOp:We.none(),permissionsOp:We.none()});function o(){return We.value(i.readable.accessOp)}let s=!1;function a(){return function(e,t){const i={};for(const[o,s]of Object.entries(t))i[o]=!!e&&e.permit.privileges.includes(s);return e=>i[e]}(o(),ft.privileges)}async function n(){s&&a()("administrate user roles")&&await We.operation({promise:e.fetchPermissions(),setOp:e=>i.writable.permissionsOp=e})}return{state:i.readable,subscribe:i.subscribe,getAccess:o,initialize:async function(){s=!0,await n()},get isAllowed(){return a()},reauthorize:t,searchUsers:e.searchUsers,assignRoleToUser:e.assignRoleToUser,revokeRoleFromUser:e.revokeRoleFromUser,async updateAccessOp(e){i.writable.accessOp=e,n()}}}async function qt({appId:e,remote:t,popups:i,storage:o,authMediator:s,chatConnect:a}){const n=function({authMediator:e,loginService:t}){const i=Ze({accessOp:We.none()});async function o(e){return We.operation({promise:e,setOp:e=>i.writable.accessOp=e})}e.subscribeToAccessChange((e=>{i.writable.accessOp=We.ready(e)}));const s={async useExistingLogin(){await o(e.initialize())},sendLoginLink:async e=>t.sendLoginLink({email:e}),async login(s){try{if(!Ae(s))throw new Et;await o(t.authenticateViaLoginToken({loginToken:s}).then((t=>e.login(t))))}catch(t){throw console.error(t),i.writable.accessOp=We.none(),await o(e.initialize()),t}},async logout(){await We.operation({promise:e.logout(),setOp:e=>i.writable.accessOp=e})},async reauthorize(){await o(e.reauthorize())}};return{readable:i.readable,track:i.track,subscribe:i.subscribe,...s,getAccessOp:()=>i.readable.accessOp,getAccess:()=>We.value(i.readable.accessOp),getValidAccess:()=>e.getValidAccess()}}({authMediator:s,loginService:t.auth.users.loginService}),{getAccessOp:r,getAccess:l,getValidAccess:c,reauthorize:d}=n,p=function({getAccessOp:e}){const t=Ze({accessOp:e()});return{state:t.readable,subscribe:t.subscribe,updateAccessOp:e=>{t.writable.accessOp=e}}}({getAccessOp:r}),u=function({personalService:e,getAccessOp:t,reauthorize:i}){const{readable:o,writable:s,track:a,subscribe:n}=Ze({accessOp:t(),submitDraftOp:We.ready(void 0)});return{track:a,subscribe:n,readable:o,async saveProfile(t){await We.operation({promise:(async()=>{const{user:{userId:s}}=We.value(o.accessOp);await e.setProfile({userId:s,profileDraft:t}),await i()})(),errorReason:"error saving profile",setOp(e){s.submitDraftOp=e}})},updateAccessOp(e){s.accessOp=e}}}({personalService:t.auth.users.personalService,getAccessOp:r,reauthorize:d}),h=St({appService:t.auth.apps.appService,appEditService:t.auth.apps.appEditService,getValidAccess:c}),m=function({permissionsService:e,reauthorize:t}){const{readable:i,writable:o,subscribe:s,track:a}=Ze({active:!1,accessOp:We.none(),permissionsDisplay:We.none()});function n(){return We.value(i.accessOp)}function r(e){const t=[],i=[];for(const o of e.privileges)o.hard?i.push(o):t.push(o);return t.sort(((e,t)=>t.time-e.time)),{...e,privileges:[...t,...i]}}async function l(){await We.operation({promise:Promise.resolve().then((async()=>c()?e.fetchPermissions().then(r):void 0)),setOp:e=>o.permissionsDisplay=e})}function c(){const e=n();return!!e?.user&&e.permit.privileges.includes(ft.privileges["customize permissions"])}function d(e){return async(...i)=>{const o=await e(...i);return await l(),await t(),o}}return{readable:i,subscribe:s,track:a,getAccess:n,initialize:async function(){o.active=!0,c()&&await l()},getUserCanCustomizePermissions:c,createRole:d(e.createRole),deleteRole:d(e.deleteRole),assignPrivilege:d(e.assignPrivilege),unassignPrivilege:d(e.unassignPrivilege),deletePrivilege:d(e.deletePrivilege),createPrivilege:d(e.createPrivilege),async updateAccessOp(e){o.accessOp=e,n()?.user&&o.active&&await l()}}}({permissionsService:t.auth.permissions.permissionsService,reauthorize:d}),f=kt({dacastService:t.videos.dacastService,contentService:t.videos.contentService}),g=wt({chatConnect:a,getChatMeta:async()=>({accessToken:await s.getValidAccessToken()})}),b=yt({notesService:t.notes.notesService}),v=Rt({roleAssignmentService:t.administrative.roleAssignmentService,reauthorize:()=>n.reauthorize()}),w=Tt({...t.questions,getAccess:r});return n.subscribe((async({accessOp:e})=>{const t=l();await Promise.all([p.updateAccessOp(e),u.updateAccessOp(e),h.updateAccessOp(e),m.updateAccessOp(e),w.accessChange(t),v.updateAccessOp(e),f.dacastModel.updateAccessOp(e),f.contentModel.updateAccessOp(e),g.updateAccessOp(e),b.updateAccessOp(e)])})),{exampleModel:p,appsModel:h,chatModel:g,accessModel:n,videoModels:f,notesModel:b,personalModel:u,questionsModel:w,permissionsModel:m,administrativeModel:v}}function Dt(){const e=new Map;return{read:async t=>e.get(t),async write(t,i){e.set(t,i)},async delete(t){e.delete(t)}}}function jt(...e){return t=>{let i=[];for(const o of e)if(i=o(t),i.length>0)break;return i}}function Lt(e){const t=Object.keys(e);return i=>Object.entries(i).flatMap((([i,o])=>t.includes(i)?e[i](o).map((e=>`"${i}": ${e}`)):[`"${i} not in schema"`]))}function Ut(...e){return t=>{const i=e.map((e=>e(t)));let o=!1;for(const e of i)0===e.length&&(o=!0);return o?[]:i.flat().map(((e,t)=>t>0?`or, ${e}`:e))}}function Nt(...e){return t=>{if(!Array.isArray(t))return["must be array"];const i=jt(...e),o=[];return t.forEach(((e,t)=>{for(const s of i(e))o.push(`(${t+1}) ${s}`)})),o}}const zt=e=>t=>t<e?["too small"]:[],Vt=e=>t=>t>e?["too big"]:[],Bt=()=>e=>Array.isArray(e)?[]:["must be an array"],Ht=e=>t=>t.length<e?["too small"]:[],Ft=e=>t=>t.length>e?["too big"]:[],Wt=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,Qt=()=>e=>Wt.test(e)?[]:["invalid email"],Kt=jt((e=>"string"!=typeof e?["must be a string"]:[]),(Xt=64,e=>e.length!==Xt?[`length must be ${Xt}`]:[]),((e,t="invalid string")=>i=>e.test(i)?[]:[t])(/^[0-9a-z]{64}$/));var Xt;const Jt=jt((e=>"string"!=typeof e?["must be a string"]:[]),Ht(1),Ft(32),(e=>/\s/.test(e)?["must not have any spaces"]:[])),Gt=jt((e=>"string"!=typeof e?["must be a string"]:[]),Ht(1),Ft(280),(e=>e.length>0&&0===e.trim().length?["can't be all whitespace"]:[])),Yt=Lt({content:Gt}),Zt=jt(Bt(),Nt(Kt)),ei=jt((e=>"number"!=typeof e?["must be a number"]:[]),zt(0),Vt(1)),ti=({rando:e,rateLimiter:t,clientRecord:i,persistence:o,policy:s})=>({chatServer:xe().policy((async(e,t)=>{const s=i.auth?.access.appId;return{persistenceActions:s?o.namespaceForApp(s):void 0,headers:t}})).expose((({persistenceActions:o,headers:a})=>{const{clientside:{chatClient:n}}=i,r=()=>gt(i.auth?.access.permit.privileges??[]);function l(e){if(0!==e.length)throw new Error("chat validation error")}return{async updateUserMeta(e){i.auth=await s(e,a)},async roomSubscribe(e){l(Jt(e)),r().viewAllChats&&(i.rooms.add(e),n.roomStatusChanged(e,await o.getRoomStatus(e)),n.postsAdded(e,await o.fetchRecentPosts(e)),n.usersMuted((await o.fetchMutes()).map((({userId:e})=>e))))},async roomUnsubscribe(e){l(Jt(e)),r().viewAllChats&&i.rooms.delete(e)},async post(s,a){if(!t.tooMany()&&(l(Lt({room:Jt,draft:Yt})({room:s,draft:a})),r().participateInAllChats&&!o.isMuted(i.auth?.access.user?.userId)&&!r().banned)){const t={...a,room:s,time:Date.now(),postId:e.randomId().toString(),userId:i.auth.access.user.userId,nickname:i.auth.access.user.profile.nickname};await o.addPosts(s,[t])}},async remove(e,t){l(Lt({room:Jt,postIds:Zt})({room:e,postIds:t})),r().moderateAllChats&&await o.removePosts(e,t)},async clear(e){l(Jt(e)),r().moderateAllChats&&await o.clearRoom(e)},async mute(e){l(Zt(e)),r().moderateAllChats&&await o.addMute(e)},async unmute(e){l(Zt(e)),r().moderateAllChats&&await o.removeMute(e)},async unmuteAll(){r().moderateAllChats&&await o.unmuteAll()},async setRoomStatus(e,t){l(Lt({room:Jt,status:ei})({room:e,status:t})),r().moderateAllChats&&await o.setRoomStatus(e,t)}}}))});var ii,oi,si=function(e,t,i,o,s){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?s.call(e,i):s?s.value=i:t.set(e,i),i},ai=function(e,t,i,o){if("a"===i&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?o:"a"===i?o.call(e):o?o.value:t.get(e)};class ni{constructor({maximum:e}){ii.set(this,void 0),oi.set(this,[]),si(this,ii,e,"f")}add(e){ai(this,oi,"f").push(e),ai(this,oi,"f").length>ai(this,ii,"f")&&si(this,oi,ai(this,oi,"f").slice(-ai(this,ii,"f")),"f")}read(){return[...ai(this,oi,"f")]}}ii=new WeakMap,oi=new WeakMap;var ri,li,ci,di=function(e,t,i,o,s){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?s.call(e,i):s?s.value=i:t.set(e,i),i},pi=function(e,t,i,o){if("a"===i&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?o:"a"===i?o.call(e):o?o.value:t.get(e)};class ui{constructor({timeframe:e,maximum:t}){ri.set(this,void 0),li.set(this,void 0),ci.set(this,void 0),di(this,ri,e,"f"),di(this,li,t,"f"),di(this,ci,new ni({maximum:t}),"f")}hit(){const e=Date.now(),t=e-pi(this,ri,"f");return pi(this,ci,"f").read().filter((e=>e>t)).length<pi(this,li,"f")&&(pi(this,ci,"f").add(e),!0)}tooMany(){return!this.hit()}}ri=new WeakMap,li=new WeakMap,ci=new WeakMap;const hi=e=>Ie.encode(JSON.stringify(e));const mi=()=>async e=>{const t=$e(e),i=1e3*t.data.exp;if(Date.now()>i)throw new Error("token expired");return t.data.payload},fi=mi();async function gi({accessToken:e}){return{access:await fi(e)}}function bi(e,t){const i={};for(const[o,s]of Object.entries(e))i[o]=t(s,o);return i}function vi(e,t){const i={};for(const[o,s]of Object.entries(e))i[o]=t(s,o);return i}var wi,yi=function(e,t,i,o,s){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?s.call(e,i):s?s.value=i:t.set(e,i),i},xi=function(e,t,i,o){if("a"===i&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?o:"a"===i?o.call(e):o?o.value:t.get(e)};class ki extends Map{constructor(e,t){super(t),wi.set(this,void 0),yi(this,wi,e,"f")}assert(e){if(this.has(e))return this.get(e);{const t=xi(this,wi,"f").call(this,e);return this.set(e,t),t}}}wi=new WeakMap;const Si=Symbol("dbbyTable");function Ii(...e){return["and",...e]}function $i(...e){return["or",...e]}function Pi(...e){return e.length?{conditions:$i(...e.map((e=>({equal:e}))))}:{conditions:!1}}function Ai(e,t){return{conditions:$i(...e.map((e=>({equal:t(e)}))))}}async function _i(e,t){const i=(()=>{const i="__serialized_type__";function o(e){if(void 0!==e)return JSON.parse(JSON.stringify(e))}const s=`dbby-${t}`;return{load:async function(){return(await e.read(s)??[]).map((e=>{const t={};for(const[o,s]of Object.entries(e))if(s&&"object"==typeof s&&s[i]){if("DamnId"!==s[i])throw new Error(`dbby-x unknown serialization type "${s[i]}"`);t[o]=Be.fromString(s.serializedValue)}else t[o]=s;return t}))},save:async function(t){await e.write(s,function(e){return e.map((e=>{const t={};for(const[s,a]of Object.entries(e))t[s]=a instanceof Be?{[i]:"DamnId",serializedValue:a.toString()}:o(a);return t}))}(t))}}})(),o={select:async function(e){return(await i.load()).filter((t=>Oi(t,e)))},selectOne:async function(e){return(await i.load()).find((t=>Oi(t,e)))},discriminate:async function(e){const t=[],o=[];for(const s of await i.load())Oi(s,e)?t.push(s):o.push(s);return{yep:t,nope:o}}},s={applyPatchToRows:async function(e,t){const{yep:s,nope:a}=await o.discriminate(e),n=s.map((e=>({...e,...t})));await i.save([...n,...a])},eliminateRow:async function(e){const t=await i.load();await i.save(t.filter((t=>!Oi(t,e))))},insert:async function(...e){const t=await i.load();await i.save([...t,...e])}},a=(()=>{let e=Promise.resolve();function t(t){return async(...i)=>{const o=e.then((()=>t(...i)));return e=o.catch((()=>{})),o}}return{groupOfFunctionsQueueInSequence:function(e){const i={};for(const[o,s]of Object.entries(e))i[o]=t(s);return i}}})();return{[Si]:!0,...a.groupOfFunctionsQueueInSequence({async create(...e){await s.insert(...e)},async read({order:e,offset:t=0,limit:i=1e3,...s}){const a=await o.select(s);if(e)for(const[t,i]of Object.entries(e))a.sort(((e,o)=>"ascend"===i?e[t]>o[t]?1:-1:e[t]>o[t]?-1:1));return a.slice(t,t+i)},one:async e=>o.selectOne(e),async assert({make:e,...t}){let i=await o.selectOne(t);if(!i){const t=await e();await s.insert(t),i=t}return i},async update({write:e,whole:t,upsert:i,...a}){const n=await o.select(a);if(e&&n.length)await s.applyPatchToRows(a,e);else if(i)n.length?await s.applyPatchToRows(a,i):await s.insert(i);else{if(!t)throw new Error("invalid update");await s.eliminateRow(a),await s.insert(t)}},async delete(e){await s.eliminateRow(e)},count:async e=>(await o.select(e)).length})}}function Oi(e,t){return function t(i){if(!1===i)return!0;const[o,...s]=i,a=s.filter((e=>!!e));if(0===a.length)throw new Error("empty and/or conditions are not allowed");const n="and"===o;let r=n;const l=e=>r=n?r&&e:r||e;for(const i of a)if(!1===i||Array.isArray(i))l(t(i));else{l(Ci(e,i))}return r}(t.conditions)}function Ci(e,t){if(!Object.keys(t).length)return!0;let i=0;const o=(t,o)=>{t&&!function(e,t,i){let o=0;for(const[s,a]of Object.entries(t))i(e[s],a)||(o+=1);return!o}(e,t,o)&&(i+=1)},s=e=>null!=e,a=(e,t)=>e instanceof Be?e.string===t.string:e===t,n=(e,t)=>e>t,r=(e,t)=>e>=t,l=(e,t)=>e<t,c=(e,t)=>e<=t,d=(e,t)=>e.includes(t),p=(e,t)=>"string"==typeof t?e.includes(t):t.test(e);function u(e){return(t,i)=>!e(t,i)}return o(t.set,s),o(t.equal,a),o(t.greater,n),o(t.greatery,r),o(t.less,l),o(t.lessy,c),o(t.listed,d),o(t.search,p),o(t.notSet,u(s)),o(t.notEqual,u(a)),o(t.notGreater,u(n)),o(t.notGreatery,u(r)),o(t.notLess,u(l)),o(t.notLessy,u(c)),o(t.notListed,u(d)),o(t.notSearch,u(p)),!i}async function Ti(e){const t=Object.keys(e),i=Object.values(e),o=await Promise.all(i),s={};return t.forEach(((e,t)=>s[e]=o[t])),s}function Mi({namespace:e,tables:t}){return bi(t,(t=>function(e){return e&&"object"==typeof e&&e[Si]}(t)?function({table:e,namespace:t}){const i=e=>e?Ii({equal:t},e):Ii({equal:t});return{[Si]:!0,create:async(...i)=>e.create(...i.map((e=>({...e,...t})))),read:async t=>e.read({...t,conditions:i(t.conditions)}),one:async t=>e.one({...t,conditions:i(t.conditions)}),assert:async o=>e.assert({...o,conditions:i(o.conditions),make:async()=>({...await o.make(),...t})}),async update(o){const s=o;return e.update({...o,conditions:i(o.conditions),upsert:s.upsert?{...s.upsert,...t}:void 0,whole:s.whole?{...s.whole,...t}:void 0,write:s.write?{...s.write,...t}:void 0})},delete:async t=>e.delete({...t,conditions:i(t.conditions)}),count:async t=>e.count({...t,conditions:i(t.conditions)})}}({namespace:e,table:t}):Mi({namespace:e,tables:t})))}class Ei{constructor(e){this.tables=e}get unconstrained(){return this.tables}namespaceForApp(e){return Mi({tables:this.tables,namespace:{"namespace-appId":e}})}}async function Ri(e){const t=new Ei(await async function(e,t){return await Ti(bi(t,(async(t,i)=>await _i(e,i))))}(e,{posts:!0,mutes:!0,roomStatuses:!0})),i={roomStatusChanged:Qe(),postsAdded:Qe(),postsRemoved:Qe(),roomCleared:Qe(),mutes:Qe(),unmutes:Qe(),unmuteAll:Qe()},o=bi(i,(e=>e.subscribe)),s=(()=>{const e=new ki((()=>({mutedUserIds:new Set})));return t=>e.assert(t)})();return o.mutes((({appId:e,userIds:t})=>{const i=s(e);for(const e of t)i.mutedUserIds.add(e)})),o.unmutes((({appId:e,userIds:t})=>{const i=s(e);for(const e of t)i.mutedUserIds.delete(e)})),o.unmuteAll((({appId:e})=>{s(e).mutedUserIds.clear()})),{events:o,namespaceForApp:function(e){const o=s(e),a=t.namespaceForApp(Be.fromString(e));return{isMuted:e=>o.mutedUserIds.has(e),async addPosts(t,o){await a.posts.create(...o.map((e=>({room:e.room,time:e.time,content:e.content,nickname:e.nickname,userId:Be.fromString(e.userId),postId:Be.fromString(e.postId)})))),i.postsAdded.publish({appId:e,room:t,posts:o})},async removePosts(t,o){o.length&&(await a.posts.delete(Ai(o,(e=>({room:t,postId:Be.fromString(e)})))),i.postsRemoved.publish({appId:e,room:t,postIds:o}))},async fetchRecentPosts(e){const t=(await a.posts.read({...Pi({room:e}),limit:50,order:{time:"descend"}})).map((e=>({room:e.room,time:e.time,content:e.content,nickname:e.nickname,postId:e.postId.toString(),userId:e.userId.toString()}))).sort(((e,t)=>e.time-t.time));return t},fetchMutes:async()=>(await a.mutes.read({conditions:!1})).map((e=>({userId:e.userId.toString()}))),async clearRoom(t){await a.posts.delete(Pi({room:t})),i.roomCleared.publish({appId:e,room:t})},async addMute(t){if(t.length){const o=(await a.mutes.read(Ai(t,(e=>({userId:Be.fromString(e)}))))).map((e=>e.userId.toString())),s=t.filter((e=>!o.includes(e))),n=s.map((e=>({userId:Be.fromString(e)})));await a.mutes.create(...n),i.mutes.publish({appId:e,userIds:s})}},async removeMute(t){t.length&&(await a.mutes.delete(Ai(t,(e=>({userId:Be.fromString(e)})))),i.unmutes.publish({appId:e,userIds:t}))},async unmuteAll(){await a.mutes.delete({conditions:!1}),i.unmuteAll.publish({appId:e})},async setRoomStatus(t,o){await a.roomStatuses.update({...Pi({room:t}),upsert:{room:t,status:o}}),i.roomStatusChanged.publish({appId:e,room:t,status:o})},async getRoomStatus(e){const t=await a.roomStatuses.one(Pi({room:e}));return t?t.status:bt.Offline}}}}}async function qi(e){const t=function({rando:e,persistence:t,policy:i}){const o=new Set;async function s(e,t){for(const i of o.values())i.auth&&i.auth.access.appId===e&&t(i,gt(i.auth.access.permit.privileges))}async function a(e,t,i){for(const s of o.values())s.auth&&s.auth.access.appId===e&&s.rooms.has(t)&&i(s,gt(s.auth.access.permit.privileges))}return t.events.roomStatusChanged((({appId:e,room:t,status:i})=>{a(e,t,(e=>e.clientside.chatClient.roomStatusChanged(t,i)))})),t.events.postsAdded((({appId:e,room:t,posts:i})=>{a(e,t,((e,o)=>{o.viewAllChats&&e.clientside.chatClient.postsAdded(t,i)}))})),t.events.postsRemoved((({appId:e,room:t,postIds:i})=>{a(e,t,((e,o)=>{o.viewAllChats&&e.clientside.chatClient.postsRemoved(t,i)}))})),t.events.mutes((({appId:e,userIds:t})=>{s(e,((e,i)=>{i.viewAllChats&&e.clientside.chatClient.usersMuted(t)}))})),t.events.unmutes((({appId:e,userIds:t})=>{s(e,((e,i)=>{i.viewAllChats&&e.clientside.chatClient.usersUnmuted(t)}))})),t.events.unmuteAll((({appId:e})=>{s(e,((e,t)=>{t.viewAllChats&&e.clientside.chatClient.unmuteAll()}))})),t.events.roomCleared((({appId:e,room:t})=>{a(e,t,((e,i)=>{i.viewAllChats&&e.clientside.chatClient.roomCleared(t)}))})),{acceptNewClient:function({controls:s,clientside:a,handleDisconnect:n}){const r={auth:void 0,rooms:new Set,clientside:a,controls:s};o.add(r);const l=new ui({timeframe:6e4,maximum:20}),c=setInterval(s.ping,1e4);return{api:ti({rando:e,rateLimiter:l,persistence:t,clientRecord:r,policy:i}),disconnect(){clearInterval(c),n(),o.delete(r)}}},get clientCount(){return o.size}}}({rando:await He(),persistence:await Ri(e),policy:gi});return function(e){return async function({clientsideApi:t,handleDisconnect:i}){const o=ve().forApi(t).withMetaMap({chatClient:async()=>{}}),{api:s,disconnect:a}=e.acceptNewClient({controls:{ping(){},close(){}},clientside:o,handleDisconnect:()=>{}});return{serverside:ve().forApi(s).withMetaMap({chatServer:async()=>{}}),disconnect(){a(),i()}}}}(t)}function Di(e,t){return t.platform.appDetails.appId===e}const ji=jt((e=>"string"!=typeof e?["must be a string"]:[]),Ft(1e3),(e=>/^https?:\/\/[a-zA-Z\.\d-]+(?:|:\d+)$/i.test(e)?[]:["invalid origin"]),Ut((e=>/^https:\/\//i.test(e)?[]:["must be secure, starting with 'https'"]),(e=>/^https?:\/\/(127\.0\.0\.1|localhost)(|:\d{1,5})(|\/\S*)$/i.test(e)?[]:["must be a localhost address"]))),Li=Object.freeze({home:jt((e=>"string"!=typeof e?["must be a string"]:[]),Ht(1),Ft(2e3),Ut(jt((e=>{try{return new URL(e),[]}catch(e){return["invalid url"]}}),(e=>/^https:\/\//i.test(e)?[]:["must be secure, starting with 'https'"])),(e=>/^https?:\/\/(127\.0\.0\.1|localhost)(|:\d{1,5})(|\/\S*)$/i.test(e)?[]:["must be a localhost address"]))),label:jt((e=>"string"!=typeof e?["must be a string"]:[]),Ht(1),Ft(50),(e=>e.length>0&&0===e.trim().length?["can't be all whitespace"]:[])),origins:jt(Ht(1),Ft(100),Nt(ji)),additionalOrigins:jt(Bt(),Ht(0),Ft(99),Nt(ji))}),Ui=Lt({home:Li.home,label:Li.label,origins:Li.origins});function Ni(e){return Ui(e)}function zi(e){return e.join(";")}function Vi(e){return e.split(";")}function Bi(e){if(e.length>0)throw new ge(400,e.join("; "))}const Hi=({rando:e,config:t,authPolicies:i})=>xe().policy(i.platformUserPolicy).expose((({appTables:i,statsHub:o})=>({async listApps({ownerUserId:e}){const s=Be.fromString(e),a=await i.owners.read(Pi({userId:s})),n=a.length?await i.registrations.read({conditions:Ii($i(...a.map((e=>({equal:{appId:e.appId}})))),{equal:{archived:!1}})}):[];return Promise.all(n.map((async e=>({appId:e.appId.toString(),label:e.label,home:e.home,origins:Vi(e.origins),platform:Di(e.appId.toString(),t),stats:await Ti({users:o.countUsers(e.appId),usersActiveDaily:o.countUsersActiveDaily(e.appId),usersActiveMonthly:o.countUsersActiveMonthly(e.appId)})}))))},async registerApp({appDraft:t,ownerUserId:o}){Bi(Ni(t));const s=Be.fromString(o),a=e.randomId();return await Promise.all([i.registrations.create({appId:a,label:t.label,home:t.home,origins:zi(t.origins),archived:!1}),i.owners.create({appId:a,userId:s})]),{...t,appId:a.toString(),stats:{users:1,usersActiveDaily:0,usersActiveMonthly:0}}}}))),Fi=({avatar:e,tagline:t,nickname:i})=>({tagline:t,nickname:i,avatar:JSON.parse(e)});async function Wi({userIds:e,authTables:t,permissionsEngine:i}){if(!e.length)throw new Error("invalid: userIds cannot be empty");const o=$i(...e.map((e=>({equal:{userId:e}})))),s=await t.users.accounts.read({conditions:o}),a=await t.users.profiles.read({conditions:o}),n=await i.getPublicRolesForUsers(e.map((e=>e.toString())));return e.map((function(e){const t=s.find((t=>t.userId.toString()===e.toString())),i=a.find((t=>t.userId.toString()===e.toString()));if(!t)throw new ge(404,`account not found for user id ${e}`);if(!i)throw new ge(404,`profile not found for user id ${e}`);const o=n.find((t=>t.userId.toString()===e.toString())).publicUserRoles,r={joined:t.created};return{userId:e.toString(),profile:Fi(i),roles:o,stats:r}}))}async function Qi({userId:e,...t}){return(await Wi({...t,userIds:[e]})).find((e=>e.userId))}function Ki(e){return null!=e}function Xi({timeframeStart:e,timeframeEnd:t}){const i=Date.now(),o=!!Ki(e)&&i>e,s=!!Ki(t)&&i<t;return!o&&!s}function Ji({isPlatform:e,permissionsTables:t}){const{hardPermissions:i,mergeRoleHasPrivileges:o,getActivePrivilegeIds:s,getHardPrivilegeDetails:a}=function({isPlatform:e}){const t=e?mt:ft;return{hardPermissions:t,mergeRoleHasPrivileges:function({hard:e,soft:t}){const i=[];function o(e,t){return e.roleId===t.roleId.toString()&&e.privilegeId===t.privilegeId.toString()}function s(e){return{roleId:Be.fromString(e.roleId),privilegeId:Be.fromString(e.privilegeId),active:e.active,immutable:e.immutable,time:0}}for(const a of t){const t=e.find((e=>o(e,a)));i.push(t&&t.immutable?s(t):a)}for(const t of e)i.find((e=>o(t,e)))||i.push(s(t));return i},getActivePrivilegeIds:function(e){return e.filter((e=>e.active)).map((e=>e.privilegeId))},getHardPrivilegeDetails:function(...e){const i=[];for(const o of e){const e=Object.entries(t.roles).find((([,e])=>e.roleId===o));if(e){const[,s]=e;for(const[e,a]of Object.entries(s.hasPrivileges)){const s=t.privileges[e];i.find((e=>e.roleId===o&&e.privilegeId===s))||i.push({privilegeId:s,roleId:o,active:a.active,immutable:a.immutable})}}}return i}}}({isPlatform:e});async function n({userIds:e,onlyGetPublicRoles:o}){const s=e=>e.public,a=e=>e,n=await(async()=>{if(0===e.length)throw new Error("invalid: user ids cannot be empty");const o=await t.userHasRole.read({conditions:$i(...e.map((e=>({equal:{userId:Be.fromString(e)}}))))}),s=o.map((e=>e.roleId)),a=[...(s.length?await t.role.read({conditions:$i(...s.map((e=>({equal:{roleId:e}}))))}):[]).map((e=>e.roleId.toString())),...Object.entries(i.roles).map((([,e])=>e.roleId))];return o.filter((e=>a.includes(e.roleId.toString())))})();return e.map((e=>{const t=n.filter((t=>t.userId.toString()===e)),i=t.filter(Xi).filter(o?s:a);return{userId:e,userHasRoles:i}}))}async function r(e){const i=await n({userIds:e,onlyGetPublicRoles:!1}),r=i.flatMap((e=>e.userHasRoles.map((e=>e.roleId)))),l=r.length?await t.roleHasPrivilege.read({conditions:$i(...r.map((e=>({equal:{roleId:e}}))))}):[];return e.map((function(e){const t=i.find((t=>t.userId===e)).userHasRoles.map((e=>e.roleId.toString())),n=a(...t),r=t.flatMap((e=>l.filter((t=>t.roleId.toString()===e)))),c=s(o({hard:n,soft:r})).map((e=>e.toString()));return{userId:e,privileges:c}}))}const{getPrivileges:l,getAllPrivileges:c}=(()=>{function e(){return Object.entries(i.privileges).map((([e,t])=>({privilegeId:Be.fromString(t),label:e,hard:!0,time:0})))}function o(e,t){return It(e,t,((e,t)=>e.privilegeId===t.privilegeId)).map((({hard:e,label:t,time:i,privilegeId:o})=>({hard:e,label:t,time:i??0,privilegeId:o.toString()})))}return{async getPrivileges(i){const s=i.length?await t.privilege.read(Ai(i,(e=>({privilegeId:Be.fromString(e)})))):[],a=e().filter((e=>i.includes(e.privilegeId.toString())));return o(s,a)},getAllPrivileges:async()=>o(await t.privilege.read({conditions:!1}),e())}})();return{getUsersHaveRoles:n,getAnonymousPrivileges:async function(){const e=i.roles.everybody.roleId,n=a(e),r=await t.roleHasPrivilege.read(Pi({roleId:Be.fromString(e)}));return s(o({hard:n,soft:r})).map((e=>e.toString()))},getPrivilegesForUsers:r,getPublicRolesForUsers:async function(e){const o=await n({userIds:e,onlyGetPublicRoles:!0}),s=o.flatMap((e=>e.userHasRoles.filter((e=>e.public)).map((e=>e.roleId.toString())))),a=s.map((e=>{const t=Object.entries(i.roles).find((([,t])=>t.roleId===e));if(t){const[i,o]=t;return{roleId:Be.fromString(e),label:i,hard:!0,public:o.public,assignable:o.assignable,time:0}}})).filter((e=>!!e)),r=s.length?await t.role.read({conditions:$i(...s.map((e=>({equal:{roleId:Be.fromString(e)}}))))}):[],l=[...a];for(const e of r){const t=l.find((t=>t.roleId===e.roleId));t||l.push(e)}return e.map((function(e){const t=o.find((t=>t.userId===e)).userHasRoles,i=t.map((e=>{const t=l.find((t=>t.roleId.toString()===e.roleId.toString()));return t||console.warn(`missing role "${e.roleId.toString()}"`),t?{...e,...t}:void 0})).filter((e=>!!e)).filter(Xi).map((e=>({label:e.label,roleId:e.roleId.toString(),timeframeEnd:e.timeframeEnd,timeframeStart:e.timeframeStart})));return{userId:e,publicUserRoles:i}}))},getPermissionsDisplay:async function(){const e={conditions:!1};return Ti({roles:(async()=>{const o=await t.role.read(e),s=Object.entries(i.roles).map((([e,t])=>({label:e,hard:!0,roleId:Be.fromString(t.roleId),public:t.public,assignable:t.assignable,time:0})));return It(o,s,((e,t)=>e.roleId===t.roleId)).map((e=>({roleId:e.roleId.toString(),assignable:e.assignable,label:e.label,hard:e.hard,public:e.public,time:e.time??0})))})(),privileges:c(),rolesHavePrivileges:(async()=>{const s=Object.values(i.roles).map((e=>e.roleId)),n=a(...s),r=await t.roleHasPrivilege.read(e);return o({hard:n,soft:r}).map((({active:e,privilegeId:t,immutable:i,roleId:o,time:s})=>({active:e,immutable:i,time:s??0,roleId:o.toString(),privilegeId:t.toString()})))})()})},getPrivileges:l,getAllPrivileges:c,getUserPrivileges:async function(e){return(await r([e])).find((t=>t.userId===e)).privileges}}}const Gi=e=>xe().policy(e.authPolicies.anonPolicy).expose((({authTables:t,access:i})=>({async getUser({userId:o}){const s=Ji({permissionsTables:t.permissions,isPlatform:i.appId===e.config.platform.appDetails.appId});return await Qi({authTables:t,permissionsEngine:s,userId:Be.fromString(o)})}}))),Yi=e=>xe().policy(e.authPolicies.greenPolicy).expose((({appTables:t,authTables:i})=>({async authorize({scope:o,refreshToken:s,appId:a}){const n=Be.fromString(a),r=i.namespaceForApp(n),l=Ji({permissionsTables:r.permissions,isPlatform:n.toString()===e.config.platform.appDetails.appId}),c=await t.registrations.one(Pi({appId:n}));if(!c)throw new ge(400,"incorrect app id");if(c.archived)throw new ge(403,"app has been archived");if(s){const{userId:t}=await e.verifyToken(s),i=Be.fromString(t),a=await Qi({userId:i,authTables:r,permissionsEngine:l});await r.users.latestLogins.update({...Pi({userId:i}),upsert:{userId:i,time:Date.now()}});const d=await l.getUserPrivileges(i.toString());return e.signToken({lifespan:e.config.crypto.tokenLifespans.access,payload:{user:a,scope:o,permit:{privileges:d},appId:n.toString(),origins:Vi(c.origins)}})}{const t=await l.getAnonymousPrivileges();return e.signToken({lifespan:e.config.crypto.tokenLifespans.access,payload:{user:void 0,appId:n.toString(),scope:o,origins:Vi(c.origins),permit:{privileges:t}}})}}})));async function Zi({userId:e,authTables:t,email:i,generateNickname:o}){const s=JSON.stringify({type:"simple",value:Math.random()});await t.users.profiles.create((({userId:e,avatar:t,generateNickname:i})=>({userId:e,avatar:t,tagline:"",nickname:i()}))({userId:e,avatar:s,generateNickname:o}))}const eo={everybody:ht.roles.everybody.roleId,authenticated:ht.roles.authenticated.roleId,technician:ht.roles.technician.roleId};async function to({rando:e,email:t,authTables:i,config:o,generateNickname:s}){t=t.toLowerCase();const a=await i.users.emails.assert({...Pi({email:t}),make:async function(){const a=t===o.platform.technician.email,n=function({rando:e}){return{userId:e.randomId(),created:Date.now()}}({rando:e}),{userId:r}=n,l=i.users.accounts.create(n),c=Zi({userId:r,email:t,authTables:i,generateNickname:s}),d=i.permissions.userHasRole.create({userId:r,hard:!0,public:!1,roleId:Be.fromString(eo.everybody),timeframeEnd:void 0,timeframeStart:void 0,time:Date.now()}),p=i.permissions.userHasRole.create({userId:r,hard:!0,public:!1,roleId:Be.fromString(eo.authenticated),timeframeEnd:void 0,timeframeStart:void 0,time:Date.now()}),u=a?i.permissions.userHasRole.create({userId:r,hard:!0,public:!0,timeframeEnd:void 0,roleId:Be.fromString(eo.technician),timeframeStart:void 0,time:Date.now()}):Promise.resolve();return await Promise.all([l,c,d,p,u]),{email:t,userId:r}}});return{userId:a.userId}}function io(e,t){const i=t(e);if(i.length>0)throw new ge(400,i.join("; "));return e}const oo=({rando:e,config:t,authPolicies:i,signToken:o,verifyToken:s,sendLoginEmail:a,generateNickname:n})=>xe().policy(i.anonPolicy).expose((({access:i,authTables:r,appTables:l})=>({async sendLoginLink(s){const{email:c}=io(s,Lt({email:Qt()})),d=c.toLowerCase(),p=Be.fromString(i.appId),u=await l.registrations.one(Pi({appId:p})),{userId:h}=await to({rando:e,email:d,config:t,authTables:r,generateNickname:n}),m={userId:h.toString()};await a({appHome:u.home,appLabel:u.label,to:d,legalLink:t.platform.legalLink,platformLink:t.platform.appDetails.home,lifespan:t.crypto.tokenLifespans.login,loginToken:await o({payload:m,lifespan:t.crypto.tokenLifespans.login})})},async authenticateViaLoginToken({loginToken:e}){const a=await s(e),n=Be.fromString(a.userId),l=await async function({scope:e,appId:t,userId:i,origins:o,lifespans:s,authTables:a,permissionsEngine:n,signToken:r}){const{user:l,permit:c}=await Ti({user:Qi({userId:i,authTables:a,permissionsEngine:n}),permit:(async()=>({privileges:await n.getUserPrivileges(i.toString())}))()});return Ti({accessToken:r({payload:{appId:t,origins:o,user:l,permit:c,scope:e},lifespan:s.access}),refreshToken:r({payload:{userId:l.userId},lifespan:s.refresh})})}({userId:n,authTables:r,scope:{core:!0},appId:i.appId,origins:i.origins,lifespans:t.crypto.tokenLifespans,permissionsEngine:Ji({isPlatform:i.appId===t.platform.appDetails.appId,permissionsTables:r.permissions}),signToken:o});return await r.users.latestLogins.update({...Pi({userId:n}),upsert:{userId:n,time:Date.now()}}),l}}))),so=Be.fromString(ft.roles.admin.roleId);async function ao({email:e,authTables:t,rando:i,config:o,generateNickname:s}){const{userId:a}=await to({rando:i,email:e,config:o,authTables:t,generateNickname:s});await t.permissions.userHasRole.assert({...Pi({userId:a,roleId:so}),make:async()=>({userId:a,roleId:so,hard:!1,public:!0,timeframeEnd:void 0,timeframeStart:void 0,time:Date.now()})})}const no=jt((e=>"string"!=typeof e?["must be a string"]:[]),Ft(256),Qt()),ro=Be.fromString(ft.roles.admin.roleId),lo=({rando:e,config:t,authPolicies:i,generateNickname:o})=>xe().policy(i.appOwnerPolicy).expose((({appTables:i,authTablesForPlatform:s,authorizeAppOwner:a})=>({async updateApp({appId:e,appDraft:t}){Bi(Ni(t));const o=Be.fromString(e);await a(o),await i.registrations.update({...Pi({appId:o}),whole:{appId:o,home:t.home,label:t.label,origins:zi(t.origins),archived:!1}})},async deleteApp({appId:e}){const t=Be.fromString(e);await a(t),await i.registrations.update({...Pi({appId:t}),write:{archived:!0}})},async listAdmins({appId:e}){const t=Be.fromString(e),{authTables:i}=await a(t),o=await i.permissions.userHasRole.read(Pi({roleId:ro}));return(await i.users.emails.read(Pi(...o.map((({userId:e})=>({userId:e})))))).map((({userId:e,email:t})=>({userId:e.toString(),email:t})))},async assignPlatformUserAsAdmin({appId:i,platformUserId:n}){const r=Be.fromString(i),{authTables:l}=await a(r),c=Be.fromString(n),d=await s.users.emails.one(Pi({userId:c}));if(!d)throw new ge(404,"platform email account not found");const{email:p}=d;await ao({rando:e,config:t,email:p,authTables:l,generateNickname:o})},async assignAdmin({appId:i,email:s}){const n=Be.fromString(i),{authTables:r}=await a(n),l=no(s);if(l.length)throw new ge(400,"email failed validation: "+l.join(";"));await ao({rando:e,config:t,email:s.toLowerCase(),authTables:r,generateNickname:o})},async revokeAdmin({appId:e,userId:t}){const i=Be.fromString(e),o=Be.fromString(t),{authTables:s}=await a(i);await s.permissions.userHasRole.delete(Pi({userId:o,roleId:ro}))}}))),co={nickname:jt((e=>"string"!=typeof e?["must be a string"]:[]),Ht(1),Ft(24),(e=>e.length>0&&0===e.trim().length?["can't be all whitespace"]:[])),tagline:jt((e=>"string"!=typeof e?["must be a string"]:[]),Ht(0),Ft(32),(e=>e.length>0&&0===e.trim().length?["can't be all whitespace"]:[]))},po=Lt({...co}),uo=e=>xe().policy(e.authPolicies.userPolicy).expose((({access:e,authTables:t,checker:i})=>({async setProfile({userId:o,profileDraft:s}){const a=Be.fromString(o),n=e.user.userId===o,r=i.hasPrivilege("edit any profile");if(!(n||r))throw new ge(403,"forbidden: you are not allowed to edit this profile");Bi(po(s)),await t.users.profiles.update({...Pi({userId:a}),write:{nickname:s.nickname,tagline:s.tagline}})}}))),ho=jt((e=>"string"!=typeof e?["must be a string"]:[]),Ht(1),Ft(16),(e=>e.length>0&&0===e.trim().length?["can't be all whitespace"]:[])),mo=({rando:e,config:t,authPolicies:i})=>xe().policy((async(e,o)=>{const s=await i.userPolicy(e,o);s.checker.requirePrivilege("customize permissions");const a=Ji({permissionsTables:s.authTables.permissions,isPlatform:s.access.appId===t.platform.appDetails.appId});return{...s,engine:a}})).expose((({authTables:t,engine:i})=>({fetchPermissions:async()=>i.getPermissionsDisplay(),async createRole({label:i}){const o=ho(i);if(o.length)throw new ge(400,`validation error on label: ${o.join("; ")}`);await t.permissions.role.create({label:i,hard:!1,public:!0,assignable:!0,roleId:e.randomId(),time:Date.now()})},async deleteRole({roleId:e}){const i=Be.fromString(e),o=await t.permissions.role.one(Pi({roleId:i}));if(!o)throw new ge(404,"role not found");if(o.hard)throw new ge(400,"cannot delete hard role");await Promise.all([t.permissions.userHasRole.delete(Pi({roleId:i})),t.permissions.role.delete(Pi({roleId:i}))])},async assignPrivilege({roleId:e,privilegeId:i}){const o=Be.fromString(e),s=Be.fromString(i);await t.permissions.roleHasPrivilege.update({...Pi({roleId:o,privilegeId:s}),upsert:{roleId:o,privilegeId:s,active:!0,immutable:!1,time:Date.now()}})},async unassignPrivilege({roleId:e,privilegeId:i}){const o=Be.fromString(e),s=Be.fromString(i);await t.permissions.roleHasPrivilege.update({...Pi({roleId:o,privilegeId:s}),upsert:{roleId:o,privilegeId:s,active:!1,immutable:!1,time:Date.now()}})},async createPrivilege({label:i}){const o={label:i,hard:!1,privilegeId:e.randomId(),time:Date.now()};return await t.permissions.privilege.create(o),{hard:o.hard,label:o.label,privilegeId:o.privilegeId.toString(),time:Date.now()}},async deletePrivilege({privilegeId:e}){const o=Be.fromString(e),[s]=await i.getPrivileges([o.toString()]);if(!s)throw new ge(400,`cannot delete missing privilege "${s.privilegeId.toString()}"`);if(s.hard)throw new ge(400,`cannot delete hard privilege "${s.privilegeId.toString()}"`);await Promise.all([t.permissions.roleHasPrivilege.delete(Pi({privilegeId:o})),t.permissions.privilege.delete(Pi({privilegeId:o}))])}})));const fo=Lt({offset:jt((e=>"number"!=typeof e?["must be a number"]:[]),zt(0)),limit:jt((e=>"number"!=typeof e?["must be a number"]:[]),zt(0),Vt(100))}),go=({config:e,basePolicy:t,notesTables:i})=>xe().policy((async(e,o)=>{const s=await t(e,o),a=Be.fromString(s.access.appId);return{...s,notesTables:i.namespaceForApp(a)}})).expose((({notesTables:e,access:t})=>({async getNotesStats(){const{userId:i}=t.user;return{newCount:await e.notes.count(Pi({to:Be.fromString(i),old:!1})),oldCount:await e.notes.count(Pi({to:Be.fromString(i),old:!0}))}},async getNewNotes(i){const{offset:o,limit:s}=io(i,fo),{userId:a}=t.user;return(await e.notes.read({...Pi({to:Be.fromString(a),old:!1}),offset:o,limit:s,order:{time:"descend"}})).map((e=>({type:"message",noteId:e.noteId.toString(),time:e.time,old:e.old,from:void 0,to:e.to.toString(),text:e.text,title:e.title,details:{}})))},async getOldNotes(i){const{offset:o,limit:s}=io(i,fo),{userId:a}=t.user;return(await e.notes.read({...Pi({to:Be.fromString(a),old:!0}),offset:o,limit:s,order:{time:"descend"}})).map((e=>({type:"message",noteId:e.noteId.toString(),time:e.time,old:e.old,from:void 0,to:e.to.toString(),text:e.text,title:e.title,details:{}})))},async markAllNotesOld(){const{userId:i}=t.user;await e.notes.update({...Pi({to:Be.fromString(i),old:!1}),write:{old:!0}})},async markNotesNewOrOld(i){const{userId:o}=t.user,{old:s,noteIds:a}=io(i,Lt({old:e=>"boolean"!=typeof e?["must be a boolean"]:[],noteIds:jt(Bt(),Ft(1e3),Nt(Kt))})),n=a.map((e=>Be.fromString(e))),r=await e.notes.read(Ai(n,(e=>({noteId:e}))));for(const e of r)if(o!==e.to.toString())throw new ge(403,`user is not privileged for note ${e.to.toString()}`);await e.notes.update({...Ai(n,(e=>({noteId:e}))),write:{old:s}})}})));function bo({config:e,notesTables:t,authPolicies:i}){return{notesService:go({config:e,notesTables:t,basePolicy:i.userPolicy})}}const vo="good",wo=jt(jt((e=>"string"!=typeof e?["must be a string"]:[]),Ht(16),Ft(64),(e=>/\s/.test(e)?["must not have any spaces"]:[]))),yo=e=>e===vo?[]:wo(e);function xo(e,t){function i(i){return e.privileges.includes(t[i])}return{hasPrivilege:i,requirePrivilege:function(e){if(!i(e))throw new ge(403,`forbidden; privilege required "${e}"`)},requireNotHavePrivilege:function(e){if(i(e))throw new ge(403,`forbidden: must not have privilege "${e}"`)}}}function ko(e){return e?{time:e.time}:void 0}const So=({config:e,dacastSdk:t,videoTables:i,basePolicy:o})=>xe().policy((async(t,s)=>{const a=await o(t,s),n=Be.fromString(a.access.appId),r=xo(a.access.permit,nt);r.requirePrivilege("moderate videos");const l=Ji({isPlatform:a.access.appId===e.platform.appDetails.appId,permissionsTables:a.authTables.permissions});return{...a,checker:r,engine:l,videoTables:i.namespaceForApp(n)}})).expose((({videoTables:e})=>({getLink:async()=>ko(await e.dacastAccountLinks.one({conditions:!1})),async setLink(i){const{apiKey:o}=io(i,Lt({apiKey:yo}));let s;return await t.verifyApiKey(o)&&(s={apiKey:o,time:Date.now()},await e.dacastAccountLinks.update({conditions:!1,upsert:s})),ko(s)},async clearLink(){await e.dacastAccountLinks.delete({conditions:!1})}})));function Io({type:e,data:t}){const i=(t.pictures??[])[0];return{type:e,thumb:i?(i.thumbnail??[])[0]:void 0,id:t.id,title:t.title,provider:"dacast"}}async function $o({videoTables:e}){const t=await e.viewDacast.read({conditions:!1}),i=await e.viewPrivileges.read({conditions:!1});return t.map((e=>{const t=i.filter((t=>t.label===e.label)).map((e=>e.privilegeId.toString()));return{id:e.dacastId,label:e.label,privileges:t,provider:"dacast",type:e.type}}))}const Po="iframe";async function Ao({dacast:e,reference:{id:t,type:i}}){switch(i){case"vod":return e.vods.id(t).embed(Po).get();case"channel":return e.channels.id(t).embed(Po).get();case"playlist":return e.playlists.id(t).embed(Po).get();default:throw new Error(`unknown dacast type "${i}"`)}}async function _o(e){const t=await e.dacastAccountLinks.one({conditions:!1});return t?t.apiKey:void 0}async function Oo({access:e,platformAppId:t,permissionsTables:i}){const o=Ji({permissionsTables:i,isPlatform:e.appId===t});return(await o.getPermissionsDisplay()).privileges}async function Co({dacast:e,reference:{provider:t,type:i,id:o}}){if("dacast"!==t)throw new ge(500,`video content provider mismatch (expected "dacast", got "${t}")`);switch(i){case"vod":return e.vods.id(o).get();case"channel":return e.channels.id(o).get();case"playlist":return e.playlists.id(o).get();default:throw new ge(500,`unknown dacast type "${i}"`)}}const To=({config:e,dacastSdk:t,videoTables:i,basePolicy:o})=>xe().policy((async(t,s)=>{const a=await o(t,s),n=Be.fromString(a.access.appId),r=xo(a.access.permit,nt),l=Ji({isPlatform:a.access.appId===e.platform.appDetails.appId,permissionsTables:a.authTables.permissions});return{...a,engine:l,checker:r,videoTables:i.namespaceForApp(n)}})).expose((({access:i,authTables:o,videoTables:s,checker:a,engine:n})=>({fetchModerationData:async()=>(a.requirePrivilege("moderate videos"),Ti({views:$o({videoTables:s}),privileges:Oo({access:i,permissionsTables:o.permissions,platformAppId:e.platform.appDetails.appId}),catalog:_o(s).then((async e=>e?async function({dacast:e}){const t=await Ti({vods:e.vods.get(),channels:e.channels.get(),playlists:e.playlists.get()});function i(e,t){return(t?.data??[]).map((t=>Io({type:e,data:t})))}return[...i("vod",t.vods),...i("channel",t.channels),...i("playlist",t.playlists)]}({dacast:t.getClient(e)}):[]))})),async writeView({label:e,privileges:t,reference:i}){a.requirePrivilege("moderate videos"),await s.viewDacast.update({...Pi({label:e}),whole:{label:e,type:i.type,dacastId:i.id}}),await async function({label:e,engine:t,videoTables:i,privileges:o}){await i.viewPrivileges.delete(Pi({label:e}));const s=await t.getPrivileges(o).then((e=>e.filter((e=>!!e)).map((e=>e.privilegeId.toString()))));await i.viewPrivileges.create(...s.map((t=>({label:e,privilegeId:Be.fromString(t)}))))}({label:e,engine:n,privileges:t,videoTables:s})},async deleteView({label:e}){a.requirePrivilege("moderate videos"),await s.viewDacast.delete(Pi({label:e})),await s.viewPrivileges.delete(Pi({label:e}))},async getShows({labels:e}){const o=await _o(s);if(!o)return[];const n=await async function({labels:e,videoTables:t,checker:i,userPrivileges:o}){if(0===e.length)return[];const s=await t.viewDacast.read(Ai(e,(e=>({label:e})))),a=await t.viewPrivileges.read(Ai(e,(e=>({label:e}))));return s.map((({label:e,type:t,dacastId:s})=>{const n=a.filter((t=>t.label===e)).map((e=>e.privilegeId.toString())),r=function({viewPrivileges:e,userPrivileges:t}){for(const i of e){const e=t.find((e=>e===i));if(e)return!0}return!1}({viewPrivileges:n,userPrivileges:o});return r||i.hasPrivilege("view all videos")||i.hasPrivilege("moderate videos")?{type:t,label:e,privileges:n,id:s,provider:"dacast"}:void 0}))}({labels:e,checker:a,videoTables:s,userPrivileges:i.permit.privileges}),r=t.getClient(o);return Promise.all(n.map((async(t,i)=>{const o=e[i];if(!t)return{label:o,details:void 0};const[s,a]=await Promise.all([Co({dacast:r,reference:t}),Ao({dacast:r,reference:t})]);return{label:o,details:s?{...Io({type:t.type,data:s}),embed:a?.code}:null}})))}})));function Mo({config:e,videoTables:t,authPolicies:i,dacastSdk:o}){const s={config:e,videoTables:t,basePolicy:i.anonPolicy};return{dacastService:So({...s,dacastSdk:o}),contentService:To({...s,dacastSdk:o})}}const Eo=({rando:e,config:t,authPolicies:i,exampleTables:o})=>xe().policy((async(e,t)=>{const s=await i.userPolicy(e,t),a=Be.fromString(s.access.appId);return{...s,exampleTables:o.namespaceForApp(a)}})).expose((({access:t,exampleTables:i})=>({async exampleFunction({something:t}){await i.examplePosts.create({exampleId:e.randomId(),something:t})}})));function Ro(e){return{exampleService:Eo(e)}}async function qo({userId:e,itemIds:t,likesTable:i,reportsTable:o}){const s=await Do({itemIds:t,voteTable:i}),a=await Do({itemIds:t,voteTable:o});return{getVotingDetails:t=>({likes:s.countVotes(t),reports:a.countVotes(t),liked:!!e&&s.voteStatus({userId:e,itemId:t}),reported:!!e&&a.voteStatus({userId:e,itemId:t})})}}async function Do({itemIds:e,voteTable:t}){const i=e.length?await t.read(Ai(e,(e=>({itemId:e})))):[];return{countVotes:e=>i.filter((t=>t.itemId.toString()===e.toString())).length,voteStatus({userId:e,itemId:t}){const o=i.filter((t=>t.userId.toString()===e.toString())),s=!!o.find((e=>e.itemId.toString()===t.toString()));return s}}}async function jo(e,t,i,o){const s=await o(e,t),a=Be.fromString(s.access.appId);return{...s,questionsTables:i.namespaceForApp(a)}}const Lo=e=>xe().policy((async(t,i)=>{const o=await function({authPolicies:e,questionsTables:t}){return async function(i,o){return jo(i,o,t,e.anonPolicy)}}(e)(t,i);return o.checker.requirePrivilege("read questions"),o})).expose((({access:t,authTables:i,questionsTables:o})=>({async fetchQuestions({board:s}){const a=await o.questionPosts.read({...Pi({board:s,archive:!1}),limit:100,offset:0,order:{timePosted:"descend"}});if(!a.length)return{users:[],questions:[]};const n=await async function({userId:e,questionPosts:t,questionsTables:i}){const o=t.map((e=>e.questionId)),s=o.length?await i.answerPosts.read(Ai(o,(e=>({questionId:e,archive:!1})))):[],a=s.map((e=>e.answerId)),n={userId:e,likesTable:i.likes,reportsTable:i.reports},r=await qo({...n,itemIds:o}),l=await qo({...n,itemIds:a});return o.map((e=>{const i=t.find((t=>t.questionId===e));return{archive:i.archive,authorUserId:i.authorUserId.toString(),questionId:i.questionId.toString(),board:i.board,content:i.content,timePosted:i.timePosted,...r.getVotingDetails(e),answers:s.filter((t=>t.questionId.toString()===e.toString())).map((e=>({answerId:e.answerId.toString(),questionId:e.questionId.toString(),authorUserId:e.authorUserId.toString(),content:e.content,archive:e.archive,timePosted:e.timePosted,...l.getVotingDetails(e.answerId)})))}}))}({questionsTables:o,questionPosts:a,userId:t?.user?.userId?Be.fromString(t.user.userId):void 0}),r=(()=>{const e=[],t=t=>{e.includes(t)||e.push(t)};for(const e of n){t(e.authorUserId);for(const i of e.answers)t(i.authorUserId)}return e})(),l=Ji({permissionsTables:i.permissions,isPlatform:t.appId===e.config.platform.appDetails.appId}),c=(await l.getPrivilegesForUsers(r)).filter((e=>e.privileges.includes(ft.privileges.banned))).map((e=>e.userId)),d=(await Wi({authTables:i,permissionsEngine:l,userIds:r.map((e=>Be.fromString(e)))})).filter((e=>!c.includes(e.userId))),p=n.filter((e=>!c.includes(e.authorUserId.toString()))).map((e=>({...e,answers:e.answers.filter((e=>!c.includes(e.authorUserId)))})));return{users:d,questions:p}}})));async function Uo({status:e,userId:t,itemId:i,voteTable:o}){const s=await o.count(Pi({userId:t,itemId:i}))>0;!s&&e?await o.create({userId:t,itemId:i}):s&&!e&&await o.delete(Pi({userId:t,itemId:i}))}const No=1*Re;const zo=jt((e=>"string"!=typeof e?["must be a string"]:[]),Ht(10),Ft(280),(e=>e.length>0&&0===e.trim().length?["can't be all whitespace"]:[])),Vo=Lt({board:jt((e=>"string"!=typeof e?["must be a string"]:[]),Ht(1),Ft(32),(e=>e.length>0&&0===e.trim().length?["can't be all whitespace"]:[])),content:zo}),Bo=Lt({content:zo});function Ho({authPolicies:e,questionsTables:t}){return async function(i,o){return jo(i,o,t,e.userPolicy)}}const Fo=e=>xe().policy((async(t,i)=>{const o=await Ho(e)(t,i);o.checker.requireNotHavePrivilege("banned");const s=o.checker.hasPrivilege("post questions"),a=o.checker.hasPrivilege("moderate questions");if(!(s||a))throw new ge(403,"not allowed to post questions");return o})).expose((({access:t,questionsTables:i,checker:o})=>({async postQuestion(o){const{questionDraft:s}=io(o,Lt({questionDraft:Vo}));await async function({userId:e,questionsTables:t}){if(await t.questionPosts.count({conditions:Ii({equal:{authorUserId:e,archive:!1}},{greater:{timePosted:Date.now()-No}})})>10)throw new ge(429,"too many posts")}({questionsTables:i,userId:Be.fromString(t.user.userId)});const a={questionId:e.rando.randomId(),authorUserId:Be.fromString(t.user.userId),archive:!1,timePosted:Date.now(),...s};return await i.questionPosts.create(a),{archive:a.archive,authorUserId:a.authorUserId.toString(),questionId:a.questionId.toString(),content:a.content,timePosted:a.timePosted,board:a.board,likes:0,reports:0,liked:!1,reported:!1,answers:[]}},async archiveQuestion(e){const{archive:s,questionId:a}=io(e,Lt({archive:e=>"boolean"!=typeof e?["must be a boolean"]:[],questionId:Kt})),n=Be.fromString(a),r=await i.questionPosts.one(Pi({questionId:n}));!function({userId:e,questionPost:t,checker:i}){const o=i.hasPrivilege("moderate questions"),s=t.authorUserId.toString()===e;if(!o&&!s)throw new Error("user is not authorized to edit question")}({userId:t.user.userId,checker:o,questionPost:r}),await i.questionPosts.update({...Pi({questionId:n}),write:{archive:!!s}})},async likeQuestion(e){const{like:s,questionId:a}=io(e,Lt({like:e=>"boolean"!=typeof e?["must be a boolean"]:[],questionId:Kt}));o.requirePrivilege("like questions"),await Uo({status:s,voteTable:i.likes,userId:Be.fromString(t.user.userId),itemId:Be.fromString(a)})},async reportQuestion(e){const{report:s,questionId:a}=io(e,Lt({report:e=>"boolean"!=typeof e?["must be a boolean"]:[],questionId:Kt}));o.requirePrivilege("report questions"),await Uo({status:s,voteTable:i.reports,userId:Be.fromString(t.user.userId),itemId:Be.fromString(a)})}})));const Wo=e=>xe().policy((async(t,i)=>{const o=await Ho(e)(t,i);o.checker.requireNotHavePrivilege("banned");const s=o.checker.hasPrivilege("answer questions"),a=o.checker.hasPrivilege("moderate questions");if(!(s||a))throw new ge(403,"not allowed to post questions");return o})).expose((({access:t,questionsTables:i,checker:o})=>({async postAnswer(o){const{questionId:s,answerDraft:a}=io(o,Lt({questionId:Kt,answerDraft:Bo})),n=Be.fromString(s),r=await i.questionPosts.one(Pi({questionId:n}));if(!r)throw new ge(400,"unknown questionId");const l=Be.fromString(t.user.userId);await async function({userId:e,questionId:t,questionsTables:i}){if(await i.answerPosts.count({conditions:Ii({equal:{authorUserId:e,questionId:t,archive:!1}},{greater:{timePosted:Date.now()-No}})})>10)throw new ge(429,"too many posts")}({userId:l,questionId:n,questionsTables:i});const c={questionId:n,answerId:e.rando.randomId(),authorUserId:l,archive:!1,timePosted:Date.now(),board:r.board,...a};await i.answerPosts.create(c);return{answerId:c.answerId.toString(),questionId:c.questionId.toString(),authorUserId:c.authorUserId.toString(),content:c.content,timePosted:c.timePosted,liked:!1,likes:0,archive:!1,reported:!1,reports:0}},async archiveAnswer(e){const{archive:s,answerId:a}=io(e,Lt({archive:e=>"boolean"!=typeof e?["must be a boolean"]:[],answerId:Kt})),n=Be.fromString(a),r=await i.answerPosts.one(Pi({answerId:n}));!function({userId:e,answerPost:t,checker:i}){const o=i.hasPrivilege("moderate questions"),s=t.authorUserId.toString()===e;if(!o&&!s)throw new Error("user is not authorized to edit answer")}({userId:t.user.userId,checker:o,answerPost:r}),await i.answerPosts.update({...Pi({answerId:n}),write:{archive:s}})},async likeAnswer(e){const{like:s,answerId:a}=io(e,Lt({like:e=>"boolean"!=typeof e?["must be a boolean"]:[],answerId:Kt}));o.requirePrivilege("like questions"),await Uo({status:s,voteTable:i.likes,userId:Be.fromString(t.user.userId),itemId:Be.fromString(a)})},async reportAnswer(e){const{report:s,answerId:a}=io(e,Lt({report:e=>"boolean"!=typeof e?["must be a boolean"]:[],answerId:Kt}));o.requirePrivilege("report questions"),await Uo({status:s,voteTable:i.reports,userId:Be.fromString(t.user.userId),itemId:Be.fromString(a)})}}))),Qo=e=>xe().policy((async(t,i)=>{const o=await Ho(e)(t,i);return o.checker.requirePrivilege("moderate questions"),o.checker.requireNotHavePrivilege("banned"),o})).expose((({questionsTables:e})=>({async archiveBoard({board:t}){await e.questionPosts.update({...Pi({board:t}),write:{archive:!0}})},async fetchReportedQuestions(){}})));function Ko(e){return{questionsReadingService:Lo(e),questionsPostingService:Fo(e),questionsAnsweringService:Wo(e),questionsModerationService:Qo(e)}}function Xo({config:e,appTables:t,authTables:i,verifyToken:o}){const s=function({appTables:e,authTables:t}){return async function(i){async function o(t){if((await e.owners.one(Pi({appId:t}))).userId.toString()!==i.toString())throw new ge(403,"forbidden")}return{countUsers:async e=>(await o(e),await t.namespaceForApp(e).users.accounts.count({conditions:!1})),countUsersActiveDaily:async e=>{await o(e);const i=Date.now()-Re;return t.namespaceForApp(e).users.latestLogins.count({conditions:Ii({greater:{time:i}})})},countUsersActiveMonthly:async e=>{await o(e);const i=Date.now()-2628e6;return t.namespaceForApp(e).users.latestLogins.count({conditions:Ii({greater:{time:i}})})}}}}({appTables:t,authTables:i}),a=async({accessToken:e},s)=>{const a=await o(e);if(a.origins.some((e=>e===s.origin)))return{access:a,appTables:t,authTables:i.namespaceForApp(Be.fromString(a.appId)),checker:xo(a.permit,ft.privileges)};throw new ge(403,"request origin not allowed")},n=async(e,t)=>{const i=await a(e,t);if(i.access.user)return i;throw new ge(403,"not logged in")},r=async(o,a)=>{const r=await n(o,a);if(r.access.appId===e.platform.appDetails.appId)return{...r,appTables:t,authTables:i,checker:xo(r.access.permit,mt.privileges),statsHub:await s(Be.fromString(r.access.user.userId))};throw new ge(403,"not platform app")};return{greenPolicy:async e=>({appTables:t,authTables:i}),anonPolicy:a,userPolicy:n,platformUserPolicy:r,appOwnerPolicy:async(i,o)=>{const s=await r(i,o);return{access:s.access,checker:s.checker,statsHub:s.statsHub,appTables:s.appTables,authTablesForPlatform:s.authTables.namespaceForApp(Be.fromString(e.platform.appDetails.appId)),authorizeAppOwner:async function(e){const i=s.checker.hasPrivilege("edit any app"),o=async function({appId:e,access:t,appTables:i}){const{userId:o}=t.user,s=Be.fromString(o);return!!await i.owners.one(Pi({userId:s,appId:e}))}({appId:e,appTables:t,access:s.access});if(o||i)return{authTables:s.authTables.namespaceForApp(e)};throw new ge(403,"forbidden: lacking privileges to edit app")}}}}}const Jo=Ut((e=>null!=e?["must be undefined or null"]:[]),(e=>"number"!=typeof e?["must be a number"]:[])),Go=jt((e=>"string"!=typeof e?["must be a string"]:[]),Ht(1),Ft(64)),Yo=({config:e,authPolicies:t})=>xe().policy((async(i,o)=>{const s=await t.userPolicy(i,o);s.checker.requirePrivilege("administrate user roles");const a=Ji({permissionsTables:s.authTables.permissions,isPlatform:s.access.appId===e.platform.appDetails.appId});return{...s,engine:a}})).expose((({engine:e,authTables:t})=>({fetchPermissions:async()=>e.getPermissionsDisplay(),async searchUsers(i){const{term:o}=io(i,Lt({term:Go})),s=new RegExp(o.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"i");const a=(await t.users.profiles.read({limit:100,conditions:Be.isId(o)?$i({equal:{userId:Be.fromString(o)}}):$i({search:{nickname:s}},{search:{tagline:s}})})).map((e=>e.userId));if(!a.length)return[];const n=await Wi({userIds:a,authTables:t,permissionsEngine:e}),r=await e.getUsersHaveRoles({userIds:n.map((e=>e.userId)),onlyGetPublicRoles:!1});return n.map((e=>({user:e,roleIds:r.find((t=>t.userId===e.userId)).userHasRoles.map((e=>e.roleId.toString()))})))},async assignRoleToUser(e){const{roleId:i,userId:o,isPublic:s,timeframeEnd:a,timeframeStart:n}=io(e,Lt({roleId:Kt,userId:Kt,isPublic:e=>"boolean"!=typeof e?["must be a boolean"]:[],timeframeEnd:Jo,timeframeStart:Jo})),r=Be.fromString(i),l=Be.fromString(o);if((await t.permissions.userHasRole.one(Pi({userId:l,roleId:r})))?.hard)throw new ge(400,"hard role assignment cannot be overwritten");await t.permissions.userHasRole.assert({conditions:$i({equal:{roleId:r,userId:l}}),make:async()=>({hard:!1,public:s,roleId:r,userId:l,timeframeEnd:a,timeframeStart:n,time:Date.now()})})},async revokeRoleFromUser(e){const{roleId:i,userId:o}=io(e,Lt({roleId:Kt,userId:Kt})),s=Be.fromString(i),a=Be.fromString(o);if((await t.permissions.userHasRole.one(Pi({userId:a,roleId:s})))?.hard)throw new ge(400,"hard role assignment cannot be overwritten");await t.permissions.userHasRole.delete({conditions:$i({equal:{roleId:s,userId:a}})})}})));function Zo(e){return{roleAssignmentService:Yo(e)}}const es={colors:["Red","Yellow","Green","Cyan","Blue","Magenta","Dark","Grey","Silver","Bright","Light","Gold","Golden","Aqua","Minty"],animals:["Aardvark","Mongoose","Alligator","Robin","Monkey","Seahorse","Shark","Leopard","Eagle","Raven","Owl","Hawk","Duck","Wolf","Coyote","Dingo","Ostrich","Llama","Alpaca","Zebra","Bear","Kiwi","Penguin","Otter","Dolphin","Starfish","Sunfish","Salmon","Swordfish","Sparrow","Turtle","Puppy","Kitten"],adjectives:["Funny","Charming","Wonderful","Fancy","Whimsical","Gregarious","Curious","Fabulous","Saavy","Groovy","Happy","Snappy","Quick","Super","Fast","Fuzzy","Clever","Genius","Marvelous","Eccentric","Fantastic","Quaint","Young","Wise","Creative","Helpful","Nice","Sincere","Loyal","Honest","Truthful","Thoughtful","Clean","Friendly","Gentle","Pleasant","Brilliant","Polite","Original","Ambitious","Lively","Wholesome","Cordial","Eager","Relaxed","Skilled","Tidy","Calm","Hopeful","Positive","Social","Quick","Fearless","Daring","Bold","Quiet"]};async function ts({config:e,rando:t,database:i,dacastSdk:o,sendLoginEmail:s,signToken:a,verifyToken:n}){const r=function({rando:e}){return function({rando:e,delimiter:t,dictionary:i,nicknameStructure:o}){const s=o.map((e=>e.reduce(((e,t)=>[...e,...i[t]]),[])));return()=>s.map((t=>e.randomSample(t))).join(t)}({rando:e,delimiter:" ",dictionary:es,nicknameStructure:[["adjectives","colors"],["animals"]]})}({rando:t}),l=Xo({config:e,verifyToken:n,appTables:i.apps,authTables:i.auth});return{auth:(c={rando:t,config:e,authPolicies:l,signToken:a,verifyToken:n,sendLoginEmail:s,generateNickname:r},{apps:{appService:Hi(c),appEditService:lo(c)},users:{greenService:Yi(c),loginService:oo(c),userService:Gi(c),personalService:uo(c)},permissions:{permissionsService:mo(c)}}),administrative:Zo({config:e,authPolicies:l}),questions:Ko({rando:t,config:e,authPolicies:l,questionsTables:i.questions}),example:Ro({rando:t,config:e,authPolicies:l,exampleTables:i.example}),videos:Mo({config:e,dacastSdk:o,authPolicies:l,videoTables:i.videos}),notes:bo({config:e,authPolicies:l,notesTables:i.notes})};var c}const is=async e=>console.log(`\n\n====== EMAIL ======\nfrom: ${e.fromLabel}\nto: ${e.to}\nsubject: ${e.subject}\ntime: ${(new Date).toLocaleString()}\n\n${e.text}\n\n===================\n\n`);function os(e,...t){const i=e.length-1;return e.slice(0,i).reduce(((e,i,o)=>e+i+t[o]),"")+e[i]}function ss({sendEmail:e}){return async function({to:t,appHome:i,appLabel:o,lifespan:s,legalLink:a,loginToken:n,platformLink:r}){const l=function({home:e,loginToken:t}){const i=new URL(e);return i.hash=`#login=${t}`,i}({loginToken:n,home:i}),c=Math.round(s/Ee).toFixed(0),d=o.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");const p=new URL(r).host;return e({to:t,fromLabel:o,subject:"Login link",html:os`
<h1>Login link for ${d}</h1>
<p style="font-size: 1.2em; padding-left: 0.5rem;">
	<a href="${l.toString()}">» Login to ${d} «</a>
</p>
<div style="opacity: 0.7; font-size: 0.8em; margin-top: 2rem;">
	<p>Expires in ${c} minutes.</p>
	<p>If you didn't request this login link, just ignore it.</p>
	<p>You can contact support by replying to this email.</p>
	<ul style="padding-left: 0.5rem;">
		<li>Logins powered by <a href="${r}">${p}</a></li>
		<li><a href="${a}">Policies and terms of service</a></li>
	</ul>
	<p style="opacity: 0.3; font-size: 0.4em;">
		${Date.now()}
	</p>
</div>
`,text:`\nLogin link for ${o}\n\n  » ${l.toString()}\n\n\nExpires in ${c} minutes\n\nIf you didn't request this login link, just ignore it.\n\nYou can contact support by replying to this email.\n\n  * Logins powered by ${r}\n\n  * Policies and terms of service ${a}\n\n${Date.now()}\n`})}}function as({rando:e,tables:t,webhooks:i}){const o=()=>e.randomId();function s(e){return{headers:{},lastResponse:void 0,...e}}const a=t;return{accounts:{async create(e){const i={id:o().toString(),type:e.type,email:e.email};return await t.accounts.create(i),s(i)},retrieve:async e=>s(await t.accounts.one(Pi({id:e}))),createLoginLink:async e=>s({created:Date.now(),url:"https://fake.xiome.io/stripe-account-login-link"})},accountLinks:{create:async e=>s({url:"https://fake.xiome.io/stripe-account-setup"})},account(e){async function t(e,t){return i[e]({type:e,data:{object:t}})}const n=Mi({tables:a,namespace:{_connectedAccount:e}});function r(e){const t={};for(const[i,o]of Object.entries(e))void 0!==o&&(t[i]=o);return t}function l({table:e,createData:t,updateData:i,createHook:a,updateHook:n}){const l=function(e){return{create:({makeData:t,hook:i=(async()=>{})})=>async function(a){const n={id:o(),...t(a)};return await e.create(n),await i(n),s(n)},retrieve:()=>async function(t){return s(await e.one(Pi({id:t})))},update:({makeData:t,hook:i=(async()=>{})})=>async function(o,a){await e.update({...Pi({id:o}),write:r(t(a))});const n=await e.one(Pi({id:o}));return await i(n),s(n)},delete:()=>async function(t){await e.delete(Pi({id:t}))}}}(e);return{create:l.create({makeData:t,hook:a}),retrieve:l.retrieve(),update:l.update({makeData:i,hook:n}),delete:l.delete()}}return{customers:l({table:n.customers,createData:e=>({email:e.email,invoice_settings:e.invoice_settings??{default_payment_method:void 0}}),updateData:e=>({email:e.email,invoice_settings:e.invoice_settings})}),products:l({table:n.products,createData:e=>({name:e.name,description:e.description}),updateData:e=>({name:e.name,description:e.description})}),prices:l({table:n.prices,createData:e=>({product:e.product,currency:e.currency,unit_amount:e.unit_amount,recurring:e.recurring}),updateData:e=>({active:e.active})}),checkout:{sessions:l({table:n.checkoutSessions,createData:e=>({customer:e.customer}),updateData:e=>({}),createHook:async e=>{await t("checkout.session.completed",e)},updateHook:async e=>{await t("checkout.session.completed",e)}})},paymentMethods:l({table:n.paymentMethods,createData:e=>({type:e.type,customer:e.customer}),updateData:e=>({})}),setupIntents:l({table:n.setupIntents,createData:e=>({customer:e.customer,payment_method:e.payment_method,usage:e.usage}),updateData:e=>({payment_method:e.payment_method})}),subscriptions:l({table:n.subscriptions,createData:e=>({customer:e.customer,default_payment_method:e.default_payment_method,cancel_at_period_end:e.cancel_at_period_end,items:{url:"",object:"list",has_more:!1,data:e.items.map((e=>({id:o(),billing_thresholds:e.billing_thresholds,price:e.price,price_data:e.price_data,quantity:e.quantity,tax_rates:e.tax_rates})))}}),updateData:e=>({cancel_at_period_end:e.cancel_at_period_end,default_payment_method:e.default_payment_method}),updateHook:async e=>{await t("customer.subscription.updated",e)}})}}}}async function ns({rando:e,tableStorage:t,authTables:i,storeTables:o}){const{publishers:s,subscribers:a}=function(e){const t={},i={};for(const[o,s]of Object.entries(e))t[o]=s.publish,i[o]=s.subscribe;return{publishers:t,subscribers:i}}({"checkout.session.completed":ke(),"invoice.paid":ke(),"invoice.payment_failed":ke(),"customer.subscription.updated":ke()}),n=await async function({tableStorage:e}){const t={prices:void 0,accounts:void 0,products:void 0,customers:void 0,setupIntents:void 0,subscriptions:void 0,paymentMethods:void 0,checkoutSessions:void 0};return await Ti(vi(t,((t,i)=>_i(e,`mock-stripe-${i}`))))}({tableStorage:t}),r=as({rando:e,tables:n,webhooks:s}),l=function({logger:e}){return{async"checkout.session.completed"(t){e.info("stripe-webhook checkout.session.completed:",t.data.object)},async"invoice.paid"(t){e.info("stripe-webhook invoice.paid:",t.data.object)},async"invoice.payment_failed"(t){e.info("stripe-webhook invoice.payment_failed:",t.data.object)},async"customer.subscription.updated"(t){e.info("stripe-webhook customer.subscription.updated:",t.data.object)}}}({authTables:i,storeTables:o,stripeLiaison:r,logger:console});for(const[e,t]of Object.entries(a))t(l[e].bind(l));return{stripeLiaison:r,mockStripeOperations:{async linkStripeAccount(e){await n.accounts.update({...Pi({id:e}),write:{email:"fake-stripe-account-email@xiome.io",charges_enabled:!0,payouts_enabled:!0,details_submitted:!0}})},async linkStripeAccountThatIsIncomplete(e){await n.accounts.update({...Pi({id:e}),write:{charges_enabled:!1,payouts_enabled:!1,details_submitted:!1}})}}}}function rs({goodApiKey:e}){return async t=>t===e}function ls({goodApiKey:e}){return{getClient:t=>function({goodApiKey:e}){let t=1;function i(e){const i=t++;return{online:!0,id:`${e}-${i.toString()}`,title:`content ${i}`,creation_date:"1999-12-25"}}const o={vods:[0,0].map((()=>i("vod"))),channels:[0,0].map((()=>i("channel"))),playlists:[0,0].map((()=>i("playlist")))};return({apiKey:t})=>{function i(i){function o(i){return(...o)=>{if(t!==e)throw new Error("mock dacast invalid api key");return i(...o)}}return{get:o((async()=>function(e){return{totalCount:e.length.toString(),data:e,paging:{last:"",next:"",previous:"",self:""}}}(i))),id:e=>({get:o((async()=>i.find((t=>t.id===e)))),embed:e=>({get:o((async()=>{return{code:(t=e,"iframe"===t?'<iframe src="https://iframe.dacast.com/vod/0ffd60be-91b7-22b0-1353-7dba7af43261/e9cc39f7-83ea-19db-2c0e-672beeec1547" width="100%" height="100%" frameborder="0" scrolling="no" allow="autoplay" allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen></iframe>':'<script id="0ffd60be-91b7-22b0-1353-7dba7af43261-vod-e9cc39f7-83ea-19db-2c0e-672beeec1547" width="100%" height="100%" src="https://player.dacast.com/js/player.js?contentId=0ffd60be-91b7-22b0-1353-7dba7af43261-vod-e9cc39f7-83ea-19db-2c0e-672beeec1547"  class="dacast-video"><\/script>')};var t}))})})}}return{vods:i(o.vods),channels:i(o.channels),playlists:i(o.playlists)}}}({goodApiKey:e})({apiKey:t}),verifyApiKey:rs({goodApiKey:e})}}function cs(e){return!("object"!=typeof e||null===e||Array.isArray(e)||e instanceof Promise)}function ds(e,t=[]){let i=[];for(const[o,s]of Object.entries(e))cs(s)?i=[...i,...ds(s,[...t,o])]:i.push([[...t,o],s]);return i}function ps(e){return ds(e)}function us(e,t,i){let o=e;for(let e=0;e<t.length;e++){const s=e===t.length-1,a=t[e],n=o[a];if(s)o[a]=i;else{if(cs(n))o=n;else{const e={};o[a]=e,o=e}}}}async function hs(e){const t=ps(e);return function(e){const t={};for(const[i,o]of e)us(t,i,o);return t}(await async function(e){const t=[],i=[];for(const[o,s]of e)t.push(o),i.push(s);const o=await Promise.all(i);return t.map(((e,t)=>[e,o[t]]))}(t))}function ms({blueprint:e,path:t=[],process:i}){return vi(e,((e,o)=>!0===e?i([...t,o]):ms({blueprint:e,path:[...t,o],process:i})))}function fs({blueprint:e,process:t}){return ms({blueprint:e,process:t})}async function gs(e){const t=await _i(Dt(),"");return e&&await t.create(...e),t}function bs({frontTable:e,backTable:t}){async function i(i){return await t.one(i)??await e.one(i)}return{[Si]:!0,one:i,create:e.create,update:e.update,delete:e.delete,async read(i){const[o,s]=await Promise.all([t.read(i),await e.read(i)]);return[...o,...s]},assert:async t=>await i(t)||await(async()=>{const i=await t.make();return await e.create(i),i})(),async count(i){const[o,s]=await Promise.all([t.count(i),e.count(i)]);return o+s}}}function vs(e){return async function(t){const i=await He(),o={...e,config:t,rando:i},s=function({config:e,configureMailgun:t}){let i;i="mock-console"===e.email?is:t(e.email).sendEmail;const o=function(e){let t=!0;return{sendEmail:async i=>{if(t)return e(i)},enableEmails(){t=!0},disableEmails(){t=!1}}}(i);i=o.sendEmail;const{disableEmails:s,enableEmails:a}=o,{sendLoginEmail:n,recallLatestLoginEmail:r}=function(e){let t;return{sendLoginEmail:async i=>{t=i,await e(i)},recallLatestLoginEmail:()=>t}}(ss({sendEmail:i}));return{sendEmail:i,enableEmails:a,disableEmails:s,sendLoginEmail:n,recallLatestLoginEmail:r}}(o),{database:a,mockStorage:n}=await async function({config:e,configureMongo:t,configureMockStorage:i}){const o={apps:{registrations:!0,owners:!0}},s={auth:{users:{accounts:!0,emails:!0,latestLogins:!0,profiles:!0},permissions:{privilege:!0,role:!0,roleHasPrivilege:!0,userHasRole:!0}},example:{examplePosts:!0},questions:{likes:!0,reports:!0,answerPosts:!0,questionPosts:!0},store:{merchant:{stripeAccounts:!0},subscription:{plans:!0,tiers:!0}},videos:{dacastAccountLinks:!0,viewDacast:!0,viewPrivileges:!0},notes:{notes:!0,questionDetails:!0}},a="mock-storage"===e.database?await async function(e){const t=await hs(fs({blueprint:o,process:t=>_i(e,t.join("-"))})),i=await(async()=>bi(await hs(fs({blueprint:s,process:t=>_i(e,t.join("-"))})),(e=>new Ei(e))))();return{mockStorage:e,database:{...t,...i}}}(i()):await t({blueprintForRawDatabase:o,blueprintForNamespacedDatabase:s,config:{...e,database:e.database}}),n=await(async()=>{const t=e.platform.appDetails,{apps:i}=a.database;return{...i,registrations:bs({frontTable:i.registrations,backTable:await gs([{appId:Be.fromString(t.appId),home:t.home,label:t.label,origins:zi(t.origins),archived:!1}])})}})();return{database:{...a.database,apps:n},mockStorage:a.mockStorage}}(o),{signToken:r,verifyToken:l}=function({config:e,configureTokenFunctions:t}){return"mock-mode"===e.crypto.keys?{signToken:async({payload:e,lifespan:t})=>{const i={payload:e,iat:Date.now()/1e3,exp:(Date.now()+t)/1e3};return[hi({alg:null,typ:"JWT"}),hi(i),hi("fake-mock-token-signature")].join(".")},verifyToken:mi()}:t(e.crypto.keys)}(o),{stripeLiaison:c,mockStripeOperations:d}=await async function({database:e,mockStorage:t,config:i,rando:o}){if("mock-mode"===i.stripe)return ns({rando:o,tableStorage:t,authTables:e.auth,storeTables:e.store});throw new Error("real stripe not implemented")}({...o,database:a,mockStorage:n}),p=function({config:e,configureDacast:t}){if("mock-mode"===e.dacast)return ls({goodApiKey:vo});if(!0===e.dacast)return t();throw new Error("unknown dacast config")}(o),u=await ts({...o,database:a,dacastSdk:p,signToken:r,verifyToken:l,sendLoginEmail:s.sendLoginEmail});return{rando:i,api:u,config:t,emails:s,database:a,stripeLiaison:c,mockStripeOperations:d,platformAppId:t.platform.appDetails.appId,prepareNotesDepositBox:e=>function({rando:e,notesTables:t}){async function i(i){const o=i.map((t=>{const i=e.randomId();return{noteBase:{...t,noteId:i,to:Be.fromString(t.to),from:void 0===t.from?void 0:Be.fromString(t.from),old:!1,time:Date.now()},noteDetails:t.details}}));return await t.notes.create(...o.map((e=>e.noteBase))),o.map((({noteBase:{noteId:e}})=>({noteId:e.toString()})))}return{sendNotes:i,sendNote:async function(e){const[t]=await i([e]);return t}}}({rando:i,notesTables:a.notes.namespaceForApp(e)}),mockBrowser:async()=>async function({api:e,appOrigin:t,mockStripeOperations:i}){return{mockAppWindow:async function({appId:o}){const s=Dt(),{remote:a,authMediator:n}=Te({api:e,appId:o,storage:s,logging:!1,headers:{origin:t}}),{nextModalResults:r}=function(){const e={confirm:!0,prompt:void 0};return{modals:{popup:()=>({controls:{close(){},rerender(){}},modal:{}}),async alert(){},confirm:async()=>e.confirm,prompt:async()=>e.prompt},nextModalResults:e}}();return{models:await qt({appId:o,remote:a,storage:s,authMediator:n,popups:fe({mockStripeOperations:i}),chatConnect:await qi(s)}),remote:a,nextModalResults:r}}}}({api:u,mockStripeOperations:d,appOrigin:"http://localhost:5000"})}}}class ws extends Error{constructor(e){super(e)}}function ys(e){return function(){throw new ws(e)}}const xs=e=>vs({configureMongo:ys("config.database.mongo not supported in browser"),configureMailgun:ys("config.email.mailgun not supported in browser"),configureTokenFunctions:ys("config.crypto.keys must be 'mock-mode' in browser"),configureMockStorage:()=>e,configureDacast:ys("config.dacast must be in 'mock-mode' in browser")});async function ks({appOrigin:e,origins:t,storage:i,appWindowLink:o}){const s=await xs(i)(qe({platformHome:o,platformOrigins:t}));s.emails.disableEmails();const a="creative@xiome.io";let n=await i.read("mock-app");n||(n=await async function({ownerEmail:e,adminEmail:t,appOrigins:i,backend:o}){const s=await o.mockBrowser(),a=await s.mockAppWindow({appId:o.platformAppId}),{accessModel:n,appsModel:r}=a.models;await n.sendLoginLink(e),await n.login(o.emails.recallLatestLoginEmail().loginToken);const{appId:l}=await r.registerApp({label:"Mock App",home:window.location.href,origins:i});return console.log("mock: register app",l),await r.appEditService.assignAdmin({appId:l,email:t}),l}({backend:s,ownerEmail:a,adminEmail:"admin@xiome.io",appOrigins:t}),await i.write("mock-app",n)),console.log(`mock: app owner email "${a}"`),s.emails.enableEmails();const{remote:r,authMediator:l,setMockLatency:c}=await Me({appId:n,backend:s,storage:i,appOrigin:e});return{appId:n,remote:r,storage:i,authMediator:l,backend:s,popups:fe({mockStripeOperations:s.mockStripeOperations}),setMockLatency:c,chatConnect:await qi(i)}}function Ss(e){const t=function(e){return{read(t){let i;const o=e.getItem(t);if(o)try{i=JSON.parse(o)}catch(i){e.removeItem(t)}return i},write(t,i){const o=JSON.stringify(i);e.setItem(t,o)},delete(t){e.removeItem(t)}}}(e);return{read:async e=>t.read(e),write:async(e,i)=>t.write(e,i),delete:async e=>t.delete(e)}}async function Is(e){const t={origins:[window.location.origin],appOrigin:window.location.origin,storage:Ss(window.localStorage),platformHome:window.location.href,appWindowLink:window.location.href};return"platform"===e.mode?await async function({platformHome:e,storage:t}){const i=new URL(e).origin,o=await xs(t)(qe({platformHome:e,platformOrigins:[i]})),s=o.platformAppId,{remote:a,authMediator:n,setMockLatency:r}=await Me({appId:s,backend:o,storage:t,appOrigin:i});return{appId:s,remote:a,storage:t,authMediator:n,backend:o,popups:fe({mockStripeOperations:o.mockStripeOperations}),setMockLatency:r,chatConnect:await qi(t)}}(t):await ks(t)}function $s(e,t){return(...i)=>t(e,...i)}function Ps({connection:e,frontend:t}){const{loginService:i}=e.remote.auth.users;i.sendLoginLink=$s(i.sendLoginLink,(async(i,...o)=>{await i(...o);const s=e.backend.emails.recallLatestLoginEmail();console.log("mock: logging in..."),await((e=0)=>new Promise((t=>setTimeout(t,e))))(1e3),await t.models.accessModel.login(s.loginToken),console.log(`mock: logged in as ${s.to}`)})),e.popups.triggerStripeConnectPopup=$s(e.popups.triggerStripeConnectPopup,(async(...e)=>{console.log("mock: bank popup",e)}));const o=e.backend.prepareNotesDepositBox(Be.fromString(t.appId));window.fakeNote=async i=>{const s=t.models.accessModel.getAccess()?.user?.userId,a={from:void 0,details:{},text:"this is a message note "+e.backend.rando.randomId().toString().slice(0,8),title:"this is a message title "+e.backend.rando.randomId().toString().slice(0,8),type:"message",to:s,...i};if(a.to){const{noteId:e}=await o.sendNote(a);console.log(`note sent! ${e}`)}else console.warn("who do you want to send this note to?\n('to' user id was not provided)")}}const As=window.ShadowRoot&&(void 0===window.ShadyCSS||window.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,_s=Symbol(),Os=new Map;class Cs{constructor(e,t){if(this._$cssResult$=!0,t!==_s)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e}get styleSheet(){let e=Os.get(this.cssText);return As&&void 0===e&&(Os.set(this.cssText,e=new CSSStyleSheet),e.replaceSync(this.cssText)),e}toString(){return this.cssText}}const Ts=(e,...t)=>{const i=1===e.length?e[0]:t.reduce(((t,i,o)=>t+(e=>{if(!0===e._$cssResult$)return e.cssText;if("number"==typeof e)return e;throw Error("Value passed to 'css' function must be a 'css' function result: "+e+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+e[o+1]),e[0]);return new Cs(i,_s)},Ms=As?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t="";for(const i of e.cssRules)t+=i.cssText;return(e=>new Cs("string"==typeof e?e:e+"",_s))(t)})(e):e;var Es;const Rs=window.trustedTypes,qs=Rs?Rs.emptyScript:"",Ds=window.reactiveElementPolyfillSupport,js={toAttribute(e,t){switch(t){case Boolean:e=e?qs:null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let i=e;switch(t){case Boolean:i=null!==e;break;case Number:i=null===e?null:Number(e);break;case Object:case Array:try{i=JSON.parse(e)}catch(e){i=null}}return i}},Ls=(e,t)=>t!==e&&(t==t||e==e),Us={attribute:!0,type:String,converter:js,reflect:!1,hasChanged:Ls};class Ns extends HTMLElement{constructor(){super(),this._$Et=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Ei=null,this.o()}static addInitializer(e){var t;null!==(t=this.l)&&void 0!==t||(this.l=[]),this.l.push(e)}static get observedAttributes(){this.finalize();const e=[];return this.elementProperties.forEach(((t,i)=>{const o=this._$Eh(i,t);void 0!==o&&(this._$Eu.set(o,i),e.push(o))})),e}static createProperty(e,t=Us){if(t.state&&(t.attribute=!1),this.finalize(),this.elementProperties.set(e,t),!t.noAccessor&&!this.prototype.hasOwnProperty(e)){const i="symbol"==typeof e?Symbol():"__"+e,o=this.getPropertyDescriptor(e,i,t);void 0!==o&&Object.defineProperty(this.prototype,e,o)}}static getPropertyDescriptor(e,t,i){return{get(){return this[t]},set(o){const s=this[e];this[t]=o,this.requestUpdate(e,s,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)||Us}static finalize(){if(this.hasOwnProperty("finalized"))return!1;this.finalized=!0;const e=Object.getPrototypeOf(this);if(e.finalize(),this.elementProperties=new Map(e.elementProperties),this._$Eu=new Map,this.hasOwnProperty("properties")){const e=this.properties,t=[...Object.getOwnPropertyNames(e),...Object.getOwnPropertySymbols(e)];for(const i of t)this.createProperty(i,e[i])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const i=new Set(e.flat(1/0).reverse());for(const e of i)t.unshift(Ms(e))}else void 0!==e&&t.push(Ms(e));return t}static _$Eh(e,t){const i=t.attribute;return!1===i?void 0:"string"==typeof i?i:"string"==typeof e?e.toLowerCase():void 0}o(){var e;this._$Ep=new Promise((e=>this.enableUpdating=e)),this._$AL=new Map,this._$Em(),this.requestUpdate(),null===(e=this.constructor.l)||void 0===e||e.forEach((e=>e(this)))}addController(e){var t,i;(null!==(t=this._$Eg)&&void 0!==t?t:this._$Eg=[]).push(e),void 0!==this.renderRoot&&this.isConnected&&(null===(i=e.hostConnected)||void 0===i||i.call(e))}removeController(e){var t;null===(t=this._$Eg)||void 0===t||t.splice(this._$Eg.indexOf(e)>>>0,1)}_$Em(){this.constructor.elementProperties.forEach(((e,t)=>{this.hasOwnProperty(t)&&(this._$Et.set(t,this[t]),delete this[t])}))}createRenderRoot(){var e;const t=null!==(e=this.shadowRoot)&&void 0!==e?e:this.attachShadow(this.constructor.shadowRootOptions);return((e,t)=>{As?e.adoptedStyleSheets=t.map((e=>e instanceof CSSStyleSheet?e:e.styleSheet)):t.forEach((t=>{const i=document.createElement("style"),o=window.litNonce;void 0!==o&&i.setAttribute("nonce",o),i.textContent=t.cssText,e.appendChild(i)}))})(t,this.constructor.elementStyles),t}connectedCallback(){var e;void 0===this.renderRoot&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),null===(e=this._$Eg)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostConnected)||void 0===t?void 0:t.call(e)}))}enableUpdating(e){}disconnectedCallback(){var e;null===(e=this._$Eg)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostDisconnected)||void 0===t?void 0:t.call(e)}))}attributeChangedCallback(e,t,i){this._$AK(e,i)}_$ES(e,t,i=Us){var o,s;const a=this.constructor._$Eh(e,i);if(void 0!==a&&!0===i.reflect){const n=(null!==(s=null===(o=i.converter)||void 0===o?void 0:o.toAttribute)&&void 0!==s?s:js.toAttribute)(t,i.type);this._$Ei=e,null==n?this.removeAttribute(a):this.setAttribute(a,n),this._$Ei=null}}_$AK(e,t){var i,o,s;const a=this.constructor,n=a._$Eu.get(e);if(void 0!==n&&this._$Ei!==n){const e=a.getPropertyOptions(n),r=e.converter,l=null!==(s=null!==(o=null===(i=r)||void 0===i?void 0:i.fromAttribute)&&void 0!==o?o:"function"==typeof r?r:null)&&void 0!==s?s:js.fromAttribute;this._$Ei=n,this[n]=l(t,e.type),this._$Ei=null}}requestUpdate(e,t,i){let o=!0;void 0!==e&&(((i=i||this.constructor.getPropertyOptions(e)).hasChanged||Ls)(this[e],t)?(this._$AL.has(e)||this._$AL.set(e,t),!0===i.reflect&&this._$Ei!==e&&(void 0===this._$E_&&(this._$E_=new Map),this._$E_.set(e,i))):o=!1),!this.isUpdatePending&&o&&(this._$Ep=this._$EC())}async _$EC(){this.isUpdatePending=!0;try{await this._$Ep}catch(e){Promise.reject(e)}const e=this.scheduleUpdate();return null!=e&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var e;if(!this.isUpdatePending)return;this.hasUpdated,this._$Et&&(this._$Et.forEach(((e,t)=>this[t]=e)),this._$Et=void 0);let t=!1;const i=this._$AL;try{t=this.shouldUpdate(i),t?(this.willUpdate(i),null===(e=this._$Eg)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostUpdate)||void 0===t?void 0:t.call(e)})),this.update(i)):this._$EU()}catch(e){throw t=!1,this._$EU(),e}t&&this._$AE(i)}willUpdate(e){}_$AE(e){var t;null===(t=this._$Eg)||void 0===t||t.forEach((e=>{var t;return null===(t=e.hostUpdated)||void 0===t?void 0:t.call(e)})),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EU(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$Ep}shouldUpdate(e){return!0}update(e){void 0!==this._$E_&&(this._$E_.forEach(((e,t)=>this._$ES(t,this[t],e))),this._$E_=void 0),this._$EU()}updated(e){}firstUpdated(e){}}var zs;Ns.finalized=!0,Ns.elementProperties=new Map,Ns.elementStyles=[],Ns.shadowRootOptions={mode:"open"},null==Ds||Ds({ReactiveElement:Ns}),(null!==(Es=globalThis.reactiveElementVersions)&&void 0!==Es?Es:globalThis.reactiveElementVersions=[]).push("1.1.1");const Vs=globalThis.trustedTypes,Bs=Vs?Vs.createPolicy("lit-html",{createHTML:e=>e}):void 0,Hs=`lit$${(Math.random()+"").slice(9)}$`,Fs="?"+Hs,Ws=`<${Fs}>`,Qs=document,Ks=(e="")=>Qs.createComment(e),Xs=e=>null===e||"object"!=typeof e&&"function"!=typeof e,Js=Array.isArray,Gs=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Ys=/-->/g,Zs=/>/g,ea=/>|[ 	\n\r](?:([^\s"'>=/]+)([ 	\n\r]*=[ 	\n\r]*(?:[^ 	\n\r"'`<>=]|("|')|))|$)/g,ta=/'/g,ia=/"/g,oa=/^(?:script|style|textarea)$/i,sa=e=>(t,...i)=>({_$litType$:e,strings:t,values:i}),aa=sa(1),na=sa(2),ra=Symbol.for("lit-noChange"),la=Symbol.for("lit-nothing"),ca=new WeakMap,da=(e,t,i)=>{var o,s;const a=null!==(o=null==i?void 0:i.renderBefore)&&void 0!==o?o:t;let n=a._$litPart$;if(void 0===n){const e=null!==(s=null==i?void 0:i.renderBefore)&&void 0!==s?s:null;a._$litPart$=n=new ga(t.insertBefore(Ks(),e),e,void 0,null!=i?i:{})}return n._$AI(e),n},pa=Qs.createTreeWalker(Qs,129,null,!1),ua=(e,t)=>{const i=e.length-1,o=[];let s,a=2===t?"<svg>":"",n=Gs;for(let t=0;t<i;t++){const i=e[t];let r,l,c=-1,d=0;for(;d<i.length&&(n.lastIndex=d,l=n.exec(i),null!==l);)d=n.lastIndex,n===Gs?"!--"===l[1]?n=Ys:void 0!==l[1]?n=Zs:void 0!==l[2]?(oa.test(l[2])&&(s=RegExp("</"+l[2],"g")),n=ea):void 0!==l[3]&&(n=ea):n===ea?">"===l[0]?(n=null!=s?s:Gs,c=-1):void 0===l[1]?c=-2:(c=n.lastIndex-l[2].length,r=l[1],n=void 0===l[3]?ea:'"'===l[3]?ia:ta):n===ia||n===ta?n=ea:n===Ys||n===Zs?n=Gs:(n=ea,s=void 0);const p=n===ea&&e[t+1].startsWith("/>")?" ":"";a+=n===Gs?i+Ws:c>=0?(o.push(r),i.slice(0,c)+"$lit$"+i.slice(c)+Hs+p):i+Hs+(-2===c?(o.push(void 0),t):p)}const r=a+(e[i]||"<?>")+(2===t?"</svg>":"");if(!Array.isArray(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return[void 0!==Bs?Bs.createHTML(r):r,o]};class ha{constructor({strings:e,_$litType$:t},i){let o;this.parts=[];let s=0,a=0;const n=e.length-1,r=this.parts,[l,c]=ua(e,t);if(this.el=ha.createElement(l,i),pa.currentNode=this.el.content,2===t){const e=this.el.content,t=e.firstChild;t.remove(),e.append(...t.childNodes)}for(;null!==(o=pa.nextNode())&&r.length<n;){if(1===o.nodeType){if(o.hasAttributes()){const e=[];for(const t of o.getAttributeNames())if(t.endsWith("$lit$")||t.startsWith(Hs)){const i=c[a++];if(e.push(t),void 0!==i){const e=o.getAttribute(i.toLowerCase()+"$lit$").split(Hs),t=/([.?@])?(.*)/.exec(i);r.push({type:1,index:s,name:t[2],strings:e,ctor:"."===t[1]?va:"?"===t[1]?ya:"@"===t[1]?xa:ba})}else r.push({type:6,index:s})}for(const t of e)o.removeAttribute(t)}if(oa.test(o.tagName)){const e=o.textContent.split(Hs),t=e.length-1;if(t>0){o.textContent=Vs?Vs.emptyScript:"";for(let i=0;i<t;i++)o.append(e[i],Ks()),pa.nextNode(),r.push({type:2,index:++s});o.append(e[t],Ks())}}}else if(8===o.nodeType)if(o.data===Fs)r.push({type:2,index:s});else{let e=-1;for(;-1!==(e=o.data.indexOf(Hs,e+1));)r.push({type:7,index:s}),e+=Hs.length-1}s++}}static createElement(e,t){const i=Qs.createElement("template");return i.innerHTML=e,i}}function ma(e,t,i=e,o){var s,a,n,r;if(t===ra)return t;let l=void 0!==o?null===(s=i._$Cl)||void 0===s?void 0:s[o]:i._$Cu;const c=Xs(t)?void 0:t._$litDirective$;return(null==l?void 0:l.constructor)!==c&&(null===(a=null==l?void 0:l._$AO)||void 0===a||a.call(l,!1),void 0===c?l=void 0:(l=new c(e),l._$AT(e,i,o)),void 0!==o?(null!==(n=(r=i)._$Cl)&&void 0!==n?n:r._$Cl=[])[o]=l:i._$Cu=l),void 0!==l&&(t=ma(e,l._$AS(e,t.values),l,o)),t}class fa{constructor(e,t){this.v=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}p(e){var t;const{el:{content:i},parts:o}=this._$AD,s=(null!==(t=null==e?void 0:e.creationScope)&&void 0!==t?t:Qs).importNode(i,!0);pa.currentNode=s;let a=pa.nextNode(),n=0,r=0,l=o[0];for(;void 0!==l;){if(n===l.index){let t;2===l.type?t=new ga(a,a.nextSibling,this,e):1===l.type?t=new l.ctor(a,l.name,l.strings,this,e):6===l.type&&(t=new ka(a,this,e)),this.v.push(t),l=o[++r]}n!==(null==l?void 0:l.index)&&(a=pa.nextNode(),n++)}return s}m(e){let t=0;for(const i of this.v)void 0!==i&&(void 0!==i.strings?(i._$AI(e,i,t),t+=i.strings.length-2):i._$AI(e[t])),t++}}class ga{constructor(e,t,i,o){var s;this.type=2,this._$AH=la,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=i,this.options=o,this._$Cg=null===(s=null==o?void 0:o.isConnected)||void 0===s||s}get _$AU(){var e,t;return null!==(t=null===(e=this._$AM)||void 0===e?void 0:e._$AU)&&void 0!==t?t:this._$Cg}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return void 0!==t&&11===e.nodeType&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=ma(this,e,t),Xs(e)?e===la||null==e||""===e?(this._$AH!==la&&this._$AR(),this._$AH=la):e!==this._$AH&&e!==ra&&this.$(e):void 0!==e._$litType$?this.T(e):void 0!==e.nodeType?this.S(e):(e=>{var t;return Js(e)||"function"==typeof(null===(t=e)||void 0===t?void 0:t[Symbol.iterator])})(e)?this.A(e):this.$(e)}M(e,t=this._$AB){return this._$AA.parentNode.insertBefore(e,t)}S(e){this._$AH!==e&&(this._$AR(),this._$AH=this.M(e))}$(e){this._$AH!==la&&Xs(this._$AH)?this._$AA.nextSibling.data=e:this.S(Qs.createTextNode(e)),this._$AH=e}T(e){var t;const{values:i,_$litType$:o}=e,s="number"==typeof o?this._$AC(e):(void 0===o.el&&(o.el=ha.createElement(o.h,this.options)),o);if((null===(t=this._$AH)||void 0===t?void 0:t._$AD)===s)this._$AH.m(i);else{const e=new fa(s,this),t=e.p(this.options);e.m(i),this.S(t),this._$AH=e}}_$AC(e){let t=ca.get(e.strings);return void 0===t&&ca.set(e.strings,t=new ha(e)),t}A(e){Js(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let i,o=0;for(const s of e)o===t.length?t.push(i=new ga(this.M(Ks()),this.M(Ks()),this,this.options)):i=t[o],i._$AI(s),o++;o<t.length&&(this._$AR(i&&i._$AB.nextSibling,o),t.length=o)}_$AR(e=this._$AA.nextSibling,t){var i;for(null===(i=this._$AP)||void 0===i||i.call(this,!1,!0,t);e&&e!==this._$AB;){const t=e.nextSibling;e.remove(),e=t}}setConnected(e){var t;void 0===this._$AM&&(this._$Cg=e,null===(t=this._$AP)||void 0===t||t.call(this,e))}}class ba{constructor(e,t,i,o,s){this.type=1,this._$AH=la,this._$AN=void 0,this.element=e,this.name=t,this._$AM=o,this.options=s,i.length>2||""!==i[0]||""!==i[1]?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=la}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(e,t=this,i,o){const s=this.strings;let a=!1;if(void 0===s)e=ma(this,e,t,0),a=!Xs(e)||e!==this._$AH&&e!==ra,a&&(this._$AH=e);else{const o=e;let n,r;for(e=s[0],n=0;n<s.length-1;n++)r=ma(this,o[i+n],t,n),r===ra&&(r=this._$AH[n]),a||(a=!Xs(r)||r!==this._$AH[n]),r===la?e=la:e!==la&&(e+=(null!=r?r:"")+s[n+1]),this._$AH[n]=r}a&&!o&&this.k(e)}k(e){e===la?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,null!=e?e:"")}}class va extends ba{constructor(){super(...arguments),this.type=3}k(e){this.element[this.name]=e===la?void 0:e}}const wa=Vs?Vs.emptyScript:"";class ya extends ba{constructor(){super(...arguments),this.type=4}k(e){e&&e!==la?this.element.setAttribute(this.name,wa):this.element.removeAttribute(this.name)}}class xa extends ba{constructor(e,t,i,o,s){super(e,t,i,o,s),this.type=5}_$AI(e,t=this){var i;if((e=null!==(i=ma(this,e,t,0))&&void 0!==i?i:la)===ra)return;const o=this._$AH,s=e===la&&o!==la||e.capture!==o.capture||e.once!==o.once||e.passive!==o.passive,a=e!==la&&(o===la||s);s&&this.element.removeEventListener(this.name,this,o),a&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t,i;"function"==typeof this._$AH?this._$AH.call(null!==(i=null===(t=this.options)||void 0===t?void 0:t.host)&&void 0!==i?i:this.element,e):this._$AH.handleEvent(e)}}class ka{constructor(e,t,i){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(e){ma(this,e)}}const Sa=window.litHtmlPolyfillSupport;var Ia,$a;null==Sa||Sa(ha,ga),(null!==(zs=globalThis.litHtmlVersions)&&void 0!==zs?zs:globalThis.litHtmlVersions=[]).push("2.1.1");class Pa extends Ns{constructor(){super(...arguments),this.renderOptions={host:this},this._$Dt=void 0}createRenderRoot(){var e,t;const i=super.createRenderRoot();return null!==(e=(t=this.renderOptions).renderBefore)&&void 0!==e||(t.renderBefore=i.firstChild),i}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Dt=da(t,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),null===(e=this._$Dt)||void 0===e||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),null===(e=this._$Dt)||void 0===e||e.setConnected(!1)}render(){return ra}}Pa.finalized=!0,Pa._$litElement$=!0,null===(Ia=globalThis.litElementHydrateSupport)||void 0===Ia||Ia.call(globalThis,{LitElement:Pa});const Aa=globalThis.litElementPolyfillSupport;null==Aa||Aa({LitElement:Pa}),(null!==($a=globalThis.litElementVersions)&&void 0!==$a?$a:globalThis.litElementVersions=[]).push("3.1.1");class _a extends Error{constructor(e){super(`an effect changes an observable, named "${e.key}", that triggers that same effect, causing an infinite circle`)}}class Oa extends Error{constructor(e){super(`cannot set observable, named "${e}", outside a formalized action`)}}function Ca(){const e={observableRecords:new Map,newObservablesSchedule:[],activeAction:void 0,activeStakeout:void 0};function t(t){if(e.observableRecords.has(t))return e.observableRecords.get(t);{const i={};return e.observableRecords.set(t,i),i}}return{context:e,subscribe:function(e){const{object:i,key:o,stakeout:s}=e,a=t(i),n=a[o]??[];return a[o]=[...n,s],{subscription:e,record:a}},triggerObservation:function(i,o){!function(t,i){const o=e.newObservablesSchedule.find((e=>e.object===t&&e.key===i));if(o)throw new _a(o)}(i,o);const s=t(i)[o]??[];for(const{watcher:e,effect:t}of s)t?t(e()):e()}}}function Ta(){const{context:e,subscribe:t,triggerObservation:i}=Ca();function o(t){return new Proxy(t,{get:(i,o)=>(e.activeStakeout&&e.newObservablesSchedule.push({object:t,key:o,stakeout:e.activeStakeout}),t[o]),set(o,s,a){const n=t[s];t[s]=a;const r=a!==n;if(!e.activeAction)throw new Oa(s);return r&&i(t,s),!0}})}function s(i){let o=()=>{},s=()=>{};e.activeStakeout=i,e.newObservablesSchedule=[];try{const a=i.watcher();s=i.effect?()=>i.effect(a):s;const n=e.newObservablesSchedule.map((e=>t(e)));o=()=>{for(const{subscription:{key:e},record:t}of n){const o=t[e]??[];t[e]=o.filter((e=>e!==i))}}}finally{e.activeStakeout=void 0,e.newObservablesSchedule=[],s()}return o}function a(t){return(...i)=>{e.activeAction=t;const o=t(...i);return e.activeAction=void 0,o}}return{observable:o,state:function e(t){for(const[i,o]of Object.entries(t))null===o||"object"!=typeof o||Array.isArray(o)||(t[i]=e(o));return o(t)},track:s,watch:function(e,t){return s({watcher:e,effect:t})},action:a,actions:function e(t){return bi(t,(t=>null!==t&&"object"==typeof t?e(t):"function"==typeof t?a(t):t))},dispose:function(){e.observableRecords=new Map},runInAction:function(t){e.activeAction=t,t(),e.activeAction=void 0}}}var Ma=function(e,t,i,o){if("a"===i&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?o:"a"===i?o.call(e):o?o.value:t.get(e)},Ea=function(e,t,i,o,s){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?s.call(e,i):s?s.value=i:t.set(e,i),i};function Ra(e){return class extends e{connectedCallback(){super.connectedCallback(),this.hasAttribute("initially-hidden")&&this.removeAttribute("initially-hidden")}}}const qa=(e,t)=>"method"===t.kind&&t.descriptor&&!("value"in t.descriptor)?{...t,finisher(i){i.createProperty(t.key,e)}}:{kind:"field",key:Symbol(),placement:"own",descriptor:{},originalKey:t.key,initializer(){"function"==typeof t.initializer&&(this[t.key]=t.initializer.call(this))},finisher(i){i.createProperty(t.key,e)}};function Da(e){return(t,i)=>void 0!==i?((e,t,i)=>{t.constructor.createProperty(i,e)})(e,t,i):qa(e,t)}function ja(e,t){return(({finisher:e,descriptor:t})=>(i,o)=>{var s;if(void 0===o){const o=null!==(s=i.originalKey)&&void 0!==s?s:i.key,a=null!=t?{kind:"method",placement:"prototype",key:o,descriptor:t(i.key)}:{...i,key:o};return null!=e&&(a.finisher=function(t){e(t,o)}),a}{const s=i.constructor;void 0!==t&&Object.defineProperty(i,o,t(o)),null==e||e(s,o)}})({descriptor:i=>{const o={get(){var t,i;return null!==(i=null===(t=this.renderRoot)||void 0===t?void 0:t.querySelector(e))&&void 0!==i?i:null},enumerable:!0,configurable:!0};if(t){const t="symbol"==typeof i?Symbol():"__"+i;o.get=function(){var i,o;return void 0===this[t]&&(this[t]=null!==(o=null===(i=this.renderRoot)||void 0===i?void 0:i.querySelector(e))&&void 0!==o?o:null),this[t]}}return o}})}function La(e){return[e].flat()}const Ua=e=>void 0!==e;function Na(...e){return function(t){var i;return(i=class extends t{}).styles=function(e,t){return[...La(e)??[],...La(t)].flat().filter(Ua)}(t.styles,e),i}}var za=function(e,t,i,o,s){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?s.call(e,i):s?s.value=i:t.set(e,i),i},Va=function(e,t,i,o){if("a"===i&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?o:"a"===i?o.call(e):o?o.value:t.get(e)};function Ba(...e){return function(t){var i,o;return o=class extends t{constructor(){super(...arguments),i.set(this,[])}connectedCallback(){super.connectedCallback();const t=()=>{this.requestUpdate()};za(this,i,e.map((e=>e(t))),"f")}disconnectedCallback(){super.disconnectedCallback();for(const e of Va(this,i,"f"))e();za(this,i,[],"f")}},i=new WeakMap,o}}function Ha(e){return class extends e{connectedCallback(){super.connectedCallback(),this.setAttribute("focusable","")}}}var Fa=function(e,t,i,o){if("a"===i&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?o:"a"===i?o.call(e):o?o.value:t.get(e)},Wa=function(e,t,i,o,s){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?s.call(e,i):s?s.value=i:t.set(e,i),i};function Qa(...e){return function(t){var i,o;return o=class extends t{constructor(){super(...arguments),i.set(this,[])}connectedCallback(){super.connectedCallback();const t=()=>{this.requestUpdate()};Wa(this,i,e.map((e=>e(t))),"f")}disconnectedCallback(){super.disconnectedCallback();for(const e of Fa(this,i,"f"))e();Wa(this,i,[],"f")}},i=new WeakMap,o}}function Ka(e){return function(t){return class extends t{get share(){return e}}}}var Xa=function(e,t,i,o,s){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?s.call(e,i):s?s.value=i:t.set(e,i),i},Ja=function(e,t,i,o){if("a"===i&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?o:"a"===i?o.call(e):o?o.value:t.get(e)};var Ga,Ya,Za=function(e,t,i,o){if("a"===i&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?o:"a"===i?o.call(e):o?o.value:t.get(e)},en=function(e,t,i,o,s){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?s.call(e,i):s?s.value=i:t.set(e,i),i};class tn extends(Ra(Pa)){constructor(){super(...arguments),Ga.set(this,[]),Ya.set(this,(()=>{}))}init(){}firstUpdated(e){super.firstUpdated(e),this.init()}addSubscription(e){Za(this,Ga,"f").push(e)}subscribe(){const e=Za(this,Ga,"f").map((e=>e()));return()=>e.forEach((e=>e()))}connectedCallback(){super.connectedCallback(),en(this,Ya,this.subscribe(),"f")}disconnectedCallback(){super.disconnectedCallback(),Za(this,Ya,"f").call(this),en(this,Ya,(()=>{}),"f")}render(){throw new Error("component render method not implemented")}}Ga=new WeakMap,Ya=new WeakMap;class on extends tn{constructor(){if(super(),void 0===this.share)throw new Error("component requires share")}}class sn extends(function(e){var t,i;return i=class extends e{constructor(){super(...arguments),this.auto=Ta(),t.set(this,[]),this.subscribeAutotrack=e=>{Ma(this,t,"f").push(e({watcher:()=>this.render(),effect:()=>this.requestUpdate()}))}}render(){}firstUpdated(e){this.subscribeAutotrack(this.auto.track)}dispose(){for(const e of Ma(this,t,"f"))e();Ea(this,t,[],"f"),this.auto.dispose()}},t=new WeakMap,i}(Ra(Pa))){init(){}firstUpdated(e){this.init(),super.firstUpdated(e)}}class an extends sn{constructor(){if(super(),void 0===this.share)throw new Error("component requires share")}}var nn=Ts`

* {
	margin: 0;
	padding: 0;
	box-sizing: border-box;
}

*:focus {
	outline: var(--focus-outline, 3px solid cyan);
}

`,rn=Ts`

:host {
	display: inline-block;
	position: relative;
	width: 6em;
}

:host::before {
	opacity: 0;
	content: "copied!";
	display: block;
	position: absolute;
	top: -0.5em;
	right: -0.5em;
	background: #0a0c;
	padding: 0 0.5em;
	border-radius: 1em;
	pointer-events: none;
	z-index: 1;
}

:host(:not([copied]))::before {
	transition: opacity 500ms ease;
}

:host([copied])::before {
	opacity: 1;
}

button {
	font: inherit;
	color: inherit;
	background: transparent;
	width: 100%;
}

.container {
	position: relative;
	display: flex;
	flex-direction: row;
	user-select: none;
	cursor: pointer;
	border: none;
}

.content {
	display: flex;
	justify-content: row;
}

.label::after {
	content: ":";
	margin-right: 0.2em;
}

.id {
	opacity: 0.75;
	overflow: hidden;
	text-overflow: ellipsis;
	white-space: nowrap;
}

.copy svg {
	width: 1em;
	height: 1em;
}

.copy {
	opacity: 0.4;
	transition: opacity 100ms linear;
}

.container:hover .copy {
	opacity: 0.9;
}

.container:active .copy {
	opacity: 1;
}

`,ln=na`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg>`,cn=function(e,t,i,o){var s,a=arguments.length,n=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(n=(a<3?s(n):a>3?s(t,i,n):s(t,i))||n);return a>3&&n&&Object.defineProperty(t,i,n),n};let dn=class extends sn{constructor(){super(...arguments),this.copied=!1}async copy(){try{await navigator.clipboard.writeText(this.id);const e=document.activeElement;e&&e.blur(),this.copyTimeout&&clearTimeout(this.copyTimeout),this.copied=!0,this.copyTimeout=setTimeout((()=>{this.copied=!1,this.copyTimeout=void 0}),1e3)}catch(e){console.error("failed to copy")}}render(){return aa`
			<button class=container @click=${this.copy}>
				<div class=id>${this.id}</div>
				<div class=copy>
					${ln}
				</div>
			</button>
		`}};cn([Da()],dn.prototype,"id",void 0),cn([Da({type:Boolean,reflect:!0})],dn.prototype,"copied",void 0),dn=cn([Ha,Na(rn)],dn);var pn=Ts`

svg, span {
	vertical-align: middle;
}

svg {
	width: 1.2em;
	height: 1.2em;
}

slot[name=loading] svg {
	animation:
		spin 10s linear infinite,
		fade 500ms ease infinite alternate;
}

slot[name=error] * {
	color: var(--loading-error-color, red);
}

@keyframes spin {
	from { transform: rotate(0deg); }
	to { transform: rotate(360deg); }
}

@keyframes fade {
	from { opacity: 1.0; }
	to { opacity: 0.5; }
}

`,un=na`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 20 20"><g fill="none"><path d="M10 7a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0v-4A.5.5 0 0 1 10 7z" fill="#626262"/><path d="M10 14.5a.75.75 0 1 0 0-1.5a.75.75 0 0 0 0 1.5z" fill="#626262"/><path d="M8.686 2.852a1.5 1.5 0 0 1 2.628 0l6.56 11.925A1.5 1.5 0 0 1 16.558 17H3.44a1.5 1.5 0 0 1-1.314-2.223L8.686 2.852zm1.752.482a.5.5 0 0 0-.876 0L3.003 15.26a.5.5 0 0 0 .438.741H16.56a.5.5 0 0 0 .438-.74L10.438 3.333z" fill="currentColor"/></g></svg>`,hn=na`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-loader"><line x1="12" y1="2" x2="12" y2="6"></line><line x1="12" y1="18" x2="12" y2="22"></line><line x1="4.93" y1="4.93" x2="7.76" y2="7.76"></line><line x1="16.24" y1="16.24" x2="19.07" y2="19.07"></line><line x1="2" y1="12" x2="6" y2="12"></line><line x1="18" y1="12" x2="22" y2="12"></line><line x1="4.93" y1="19.07" x2="7.76" y2="16.24"></line><line x1="16.24" y1="7.76" x2="19.07" y2="4.93"></line></svg>`,mn=function(e,t,i,o){var s,a=arguments.length,n=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(n=(a<3?s(n):a>3?s(t,i,n):s(t,i))||n);return a>3&&n&&Object.defineProperty(t,i,n),n};let fn=class extends sn{constructor(){super(...arguments),this.mode="none",this._op=We.none(),this.errorIcon=un,this.loadingIcon=hn,this["loading-message"]="loading...",this["error-message"]="error"}get op(){return this._op}set op(e){const t=this._op;this._op=e,this.mode=We.mode(e),this.requestUpdate("op",t)}render(){return We.select(this.op,{none:()=>aa`
				<slot name=none></slot>
			`,loading:()=>aa`
				<slot name=loading>
					${this.loadingIcon}
					<span>${this["loading-message"]}</span>
				</slot>
			`,error:e=>aa`
				<slot name=error>
					${this.errorIcon}
					<span>${e??this.fallbackErrorMessage}</span>
				</slot>
			`,ready:()=>aa`
				<slot></slot>
			`})}};mn([Da({type:String,reflect:!0})],fn.prototype,"mode",void 0),mn([Da({type:Object})],fn.prototype,"op",null),mn([Da()],fn.prototype,"errorIcon",void 0),mn([Da()],fn.prototype,"loadingIcon",void 0),mn([Da({type:String})],fn.prototype,"loading-message",void 0),mn([Da({type:String})],fn.prototype,"error-message",void 0),fn=mn([Na(pn)],fn);var gn=Ts`

:host {
	display: inline-block;
	width: var(--avatar-size, 3em);
	height: var(--avatar-size, 3em);
	border-radius: var(--avatar-border-radius, 0.3em);
	overflow: hidden;
	user-select: none;
}

.avatar {
	display: block;
	width: 100%;
	height: 100%;
	color: var(--xio-avatar-color, #444);
	background: var(--xio-avatar-background, #888);
}

.avatar[data-logged-in] {
	color: #fff;
}

svg, img {
	pointer-events: none;
	display: block;
	width: 100%;
	height: 100%;
	object-fit: cover;
}

`,bn=na`<svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill="currentColor" fill-rule="evenodd" d="M12 14.002a.998.998 0 0 1-.998.998H1.001A1 1 0 0 1 0 13.999V13c0-2.633 4-4 4-4s.229-.409 0-1c-.841-.62-.944-1.59-1-4 .173-2.413 1.867-3 3-3s2.827.586 3 3c-.056 2.41-.159 3.38-1 4-.229.59 0 1 0 1s4 1.367 4 4v1.002z"/></svg>`;function vn(e,t,i){return e<t?t:e>i?i:e}function wn(e,t,i){return`hsl(${e%360}, ${vn(t,0,100)}%, ${vn(i,0,100)}%)`}var yn=function(e,t,i,o){var s,a=arguments.length,n=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(n=(a<3?s(n):a>3?s(t,i,n):s(t,i))||n);return a>3&&n&&Object.defineProperty(t,i,n),n};let xn=class extends tn{renderBlankAvatar(e){return aa`
			<div class=avatar>
				${bn}
			</div>
		`}renderSimpleAvatar({value:e}){const{color1:t,color2:i,color3:o}=function(e){const t=Math.ceil(360*e),i=(t-30)%360,o=(t+30)%360;return{color1:wn(t,100,90),color2:wn(i,50,60),color3:wn(o,50,40)}}(e);return aa`
			<div class=avatar style=${`color: ${t}; background: linear-gradient(to bottom right, ${i}, ${o});`}>
				${bn}
			</div>
		`}renderImageAvatar({link:e}){return aa`
			<div class=avatar>
				<img src="${e}" alt=""/>
			</div>
		`}render(){const{spec:e={type:"blank"}}=this;switch(e.type){case"blank":return this.renderBlankAvatar(e);case"simple":return this.renderSimpleAvatar(e);case"image":return this.renderImageAvatar(e);default:return aa`avatar missing`}}};yn([Da({type:Object})],xn.prototype,"spec",void 0),xn=yn([Na(gn)],xn);var kn=Ts`

:host {
	display: inline-block;
	--_padding: var(--xio-button-padding, 0.2em 0.5em);
	--_background: var(--xio-button-background, transparent);
	--_border: var(--xio-button-border, 1px solid);
	--_border-radius: var(--xio-button-border-radius, 0);
	--_opacity: var(--xio-button-opacity, 0.7);
	--_hover-opacity: var(--xio-button-hover-opacity, 1);
	--_hover-color: var(--xio-button-hover-color, inherit);
	--_hover-background: var(--xio-button-hover-background, var(--_background));
	--_disabled-opacity: var(--xio-button-disabled-opacity, 0.2);
	--_disabled-border-style: var(--xio-button-disabled-border-style, dashed);
}

button {
	height: 100%;
	cursor: pointer;
	font: inherit;
	color: inherit;
	padding: var(--_padding);
	font-weight: bold;
	background: var(--_background);
	border: var(--_border);
	border-radius: var(--_border-radius);
	opacity: var(--_opacity);
}

button:not([disabled]):hover,
button:not([disabled]):focus {
	opacity: var(--_hover-opacity);
	color: var(--_hover-color);
	background: var(--_hover-background);
}

button[disabled] {
	cursor: default;
	opacity: var(--_disabled-opacity);
	border-style: var(--_disabled-border-style);
}

`;class Sn extends CustomEvent{constructor(e){super("press",{detail:e})}}var In=function(e,t,i,o){var s,a=arguments.length,n=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(n=(a<3?s(n):a>3?s(t,i,n):s(t,i))||n);return a>3&&n&&Object.defineProperty(t,i,n),n};let $n=class extends sn{constructor(){super(...arguments),this.disabled=!1,this.handleClick=()=>{const e=new Sn(this);this.onpress&&this.onpress(e),this.disabled||this.dispatchEvent(e),e.stopPropagation()}}focus(){this.shadowRoot.querySelector("button").focus()}render(){return aa`
			<button
				part=button
				@click=${this.handleClick}
				?disabled=${this.disabled}>
					<slot part=button-slot></slot>
			</button>
		`}};In([Da({type:Boolean,reflect:!0})],$n.prototype,"disabled",void 0),In([Da({type:Function})],$n.prototype,"onpress",void 0),$n=In([Ha,Na(kn)],$n);var Pn=Ts`

.example {
	color: #f90;
}

`,An=function(e,t,i,o){var s,a=arguments.length,n=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(n=(a<3?s(n):a>3?s(t,i,n):s(t,i))||n);return a>3&&n&&Object.defineProperty(t,i,n),n};let _n=class extends sn{render(){return aa`
			<div class=example>
				<p>xio-example</p>
				<slot></slot>
			</div>
		`}};_n=An([Na(Pn)],_n);var On=Ts`

* {box-sizing: border-box;}

:host {
	display: inline-block;
	vertical-align: middle;
	color: white;
}

:host([disabled]) {
	opacity: 0.25;
}

button {
	display: inline-block;
	border: unset;
	color: unset;
	background: unset;
}

button {
	position: relative;
	width: 1.5em;
	height: 1.5em;
	background: #3338;
	box-shadow: inset 1px 2px 3px #000a;
	border-radius: 0.5em;
	border: 1px solid #fff4;
}

button[data-mode="ready"] {
	cursor: pointer;
}

button[data-mode="ready"]:hover,
button[data-mode="ready"]:focus {
	background: #5558;
	border: 1px solid #fff8;
}

button > span {
	display: inline-block;
}

button svg {
	width: 100%;
	height: 100%;
}

button .error {
	display: inline-block;
	position: absolute;
	top: 80%;
	left: 0;
	width: max-content;
	max-width: 16em;
	color: red;
	background: #200a;
	text-shadow: 1px 2px 3px #0008;
	text-align: left;
	padding: 0.2em 0.5em;
	border-radius: 0.5em;
	pointer-events: none;
}

button[data-mode="loading"] svg,
button[data-mode="error"] svg {
	padding: 10%;
}

button[data-mode="error"] svg {
	color: red;
	animation: fade 1s ease infinite alternate;
}

button[data-mode="loading"] svg {
	animation:
		spin 10s linear infinite,
		fade 500ms ease infinite alternate;
}

@keyframes spin {
	from { transform: rotate(0deg); }
	to { transform: rotate(360deg); }
}

@keyframes fade {
	from { opacity: 1.0; }
	to { opacity: 0.5; }
}

`;class Cn extends CustomEvent{constructor(e){super("press",{detail:e})}}var Tn=na`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-check"><polyline points="20 6 9 17 4 12"></polyline></svg>`,Mn=function(e,t,i,o){var s,a=arguments.length,n=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(n=(a<3?s(n):a>3?s(t,i,n):s(t,i))||n);return a>3&&n&&Object.defineProperty(t,i,n),n};let En=class extends sn{constructor(){super(...arguments),this.loading=We.none(),this["initially-checked"]=!1,this["error-message"]="error",this.disabled=!1,this.handleClick=()=>{if(!this.disabled){this.toggle();const e=document.activeElement;e&&e.blur()}}}init(){this.loading=We.ready(this["initially-checked"])}get checked(){return We.value(this.loading)}set checked(e){this.loading=We.ready(e)}async toggle(e=We.value(this.loading),t=!0){const i=!e,o=!this.disabled,s=We.isReady(this.loading);return o&&s?We.operation({setOp:e=>this.loading=e,errorReason:this["error-message"],promise:(async()=>{if(await(this.save??(async()=>{}))(i),t){const e=new Cn(this);this.oncheck&&this.oncheck(e),this.dispatchEvent(e),e.stopPropagation()}return i})()}):i}render(){return aa`
			<button
				data-mode="${We.mode(this.loading)}"
				?data-checked=${We.value(this.loading)}
				@click=${this.handleClick}>
					${We.select(this.loading,{none:()=>null,loading:()=>hn,error:e=>aa`${un}<div class=error>${e}</div>`,ready:e=>e?Tn:null})}
			</button>
		`}};Mn([Da()],En.prototype,"loading",void 0),Mn([Da({type:Boolean})],En.prototype,"initially-checked",void 0),Mn([Da({type:String})],En.prototype,"error-message",void 0),Mn([Da({type:Boolean,reflect:!0})],En.prototype,"disabled",void 0),Mn([Da({type:Function})],En.prototype,"oncheck",void 0),Mn([Da({type:Function})],En.prototype,"save",void 0),En=Mn([Ha,Na(On)],En);var Rn=Ts`

/* * { outline: 1px solid #f002; } */

:host {
	display: block;
	width: 100%;
	max-width: 48rem;
	--height: var(--xio-text-input-height, 5rem);
	--pad: var(--xio-text-input-pad, 0.2em);
	--font: var(--xio-text-input-font, inherit);
	--color: var(--xio-text-input-color, inherit);
	--label-font: var(--xio-text-input-label-font, inherit);
	--label-color: var(--xio-text-input-label-color, inherit);
	--problems-font: var(--xio-text-input-problems-font, inherit);
	--problems-color: var(--xio-text-input-problems-color);
	--background: var(--xio-text-input-background, transparent);
	--valid-color: var(--xio-text-input-valid-color, #00ff8c);
	--invalid-color: var(--xio-text-input-invalid-color, #ff6100);
	--border: var(--xio-text-input-border, 1px solid);
	--border-radius: var(--xio-text-input-border-radius, 0.3em);
}

:host([hidden]) {
	display: none;
}

label {
	font: var(--label-font);
	color: var(--label-color);
}

slot {
	display: block;
	padding: 0 var(--pad);
}

.flexy {
	display: flex;
	flex-direction: row;
	flex-wrap: wrap;
}

.flexy > * {
	flex: 0 0 auto;
}

:host([textarea]) .flexy {
	flex-direction: column;
}

[part="inputbox"] {
	display: block;
	/* max-width: var(--width); */
	position: relative;
	flex: 1 1 auto;
}

:host([textarea]) [part="inputbox"] {
	flex: 1 1 auto;
	/* max-width: unset; */
}

[part="inputbox"] svg {
	position: absolute;
	display: block;
	top: var(--pad);
	right: var(--pad);
	width: 1.2em;
	height: 1.2em;
	pointer-events: none;
}

.container[data-valid] [part="inputbox"] svg {
	color: var(--valid-color);
}

.container:not([data-valid]) [part="inputbox"] svg {
	color: var(--invalid-color);
}

#textinput {
	min-width: 1em;
	width: 100%;
	font: var(--font);
	padding: var(--pad);
	padding-right: calc(1em + calc(2 * var(--pad)));
	margin: 0;
	color: var(--color);
	background: var(--background);
	border: var(--border);
	border-radius: var(--border-radius);
	text-overflow: ellipsis;
}

textarea {
	min-height: var(--height);
}

[part="problems"] {
	display: flex;
	font: var(--problems-font);
	padding: 0 calc(2 * var(--pad));
	flex-direction: column;
	justify-content: flex-start;
	flex: 1 1 auto;
	/* min-width: 12rem; */
	list-style: none;
	color: var(--problems-color, var(--invalid-color));
}

[part="problems"] > li {
	margin-top: 0.2em;
}

`;function qn(e){return e}class Dn extends CustomEvent{constructor(){super("enterpress",{bubbles:!0,composed:!0,detail:void 0})}}class jn extends CustomEvent{constructor(e){super("valuechange",{bubbles:!0,composed:!0,detail:{value:e}})}}var Ln=na`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-check-circle"><path d="M22 11.08V12a10 10 0 11-5.93-9.14"/><path d="M22 4L12 14.01l-3-3"/></svg>`,Un=function(e,t,i,o){var s,a=arguments.length,n=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(n=(a<3?s(n):a>3?s(t,i,n):s(t,i))||n);return a>3&&n&&Object.defineProperty(t,i,n),n};let Nn=class extends tn{constructor(){super(...arguments),this.initial="",this.readonly=!1,this.textarea=!1,this["hide-validation"]=!1,this["show-validation-when-empty"]=!1,this.disabled=!1,this.placeholder="",this.hidden=!1,this.parser=qn,this.problems=[],this.onvaluechange=()=>{},this.onenterpress=()=>{},this.draft="",this.lastDraft="",this.vettedLength=0,this.dispatchValueChange=()=>{const{draft:e,lastDraft:t}=this;e!==t&&(this.vettedLength=e.length,this.dispatchEvent(new jn(this.value))),this.lastDraft=e},this.dispatchValueChangeDebounced=Ke(250,this.dispatchValueChange),this.dispatchEnterPress=()=>{this.dispatchEvent(new Dn)},this.updateDraft=()=>{this.draft=this.input.value},this.handleInputKeyPress=e=>{if("Enter"===e.key){const t=!this.textarea,i=!e.shiftKey;(t||i)&&(this.updateDraft(),this.dispatchValueChange(),this.dispatchEnterPress(),e.preventDefault())}},this.handleInput=()=>{this.updateDraft(),this.dispatchValueChangeDebounced()},this.handleChange=()=>{this.updateDraft(),this.dispatchValueChange()}}get input(){return this.shadowRoot?this.shadowRoot.querySelector("#textinput"):void 0}focus(){this.input&&this.input.focus()}get value(){const{draft:e}=this,t=(this.parser??qn)(e);return this.problems=this.validator?this.validator(t):[],0===this.problems.length?t:void 0}get text(){return this.draft}set text(e){const{input:t}=this;t?(this.input.value=e,this.updateDraft(),this.dispatchValueChange()):this.initial=e}init(){const{initial:e}=this;this.draft=e,this.lastDraft=e,this.text=e,this.addEventListener("valuechange",this.onvaluechange),this.addEventListener("enterpress",this.onenterpress),this.dispatchValueChange()}render(){const{readonly:e,disabled:t,problems:i,vettedLength:o,placeholder:s,textarea:a,validator:n,handleInput:r,handleInputKeyPress:l,handleChange:c}=this,d=0===i.length,p=!this["hide-validation"]&&!e&&n&&(!!this["show-validation-when-empty"]||0!==o);return aa`
			<div class=container ?data-valid=${d}>
				<label for=textinput part=label><slot></slot></label>
				<div class=flexy>
					<div part=inputbox>
						${p?p?d?Ln:un:null:null}
						${a?aa`
							<textarea
								id=textinput
								part=textinput
								?disabled=${t}
								?readonly=${e}
								tabindex=${e?"-1":"0"}
								placeholder=${s}
								@input=${r}
								@keypress=${l}
								@change=${c}
							></textarea>
						`:aa`
							<input
								id=textinput
								type=text
								part=textinput
								?disabled=${t}
								?readonly=${e}
								tabindex=${e?"-1":"0"}
								placeholder=${s}
								@input=${r}
								@keypress=${l}
								@change=${c}
								/>
						`}
					</div>
					<ol part=problems>
						${p&&!d?i.map((e=>aa`
								<li>${e}</li>
							`)):null}
					</ol>
				</div>
			</div>
		`}};Un([Da({type:String,reflect:!0})],Nn.prototype,"initial",void 0),Un([Da({type:Boolean,reflect:!0})],Nn.prototype,"readonly",void 0),Un([Da({type:Boolean,reflect:!0})],Nn.prototype,"textarea",void 0),Un([Da({type:Boolean,reflect:!0})],Nn.prototype,"hide-validation",void 0),Un([Da({type:Boolean,reflect:!0})],Nn.prototype,"show-validation-when-empty",void 0),Un([Da({type:Boolean,reflect:!0})],Nn.prototype,"disabled",void 0),Un([Da({type:String,reflect:!0})],Nn.prototype,"placeholder",void 0),Un([Da({type:Boolean,reflect:!0})],Nn.prototype,"hidden",void 0),Un([Da({type:Function})],Nn.prototype,"parser",void 0),Un([Da({type:Function})],Nn.prototype,"validator",void 0),Un([Da({type:Object})],Nn.prototype,"problems",void 0),Un([Da({type:String})],Nn.prototype,"text",null),Un([Da({type:String})],Nn.prototype,"draft",void 0),Nn=Un([Ha,Na(Rn)],Nn);var zn=Ts`

:host {
	display: inline-block;
	--local-avatar-size: var(--avatar-size, 3em);
}

.container {
	display: flex;
	flex-direction: row;
	flex-wrap: wrap;
}

xio-avatar {
	flex: 0 0 auto;
	margin-right: 0.4em;
	--avatar-size: var(--local-avatar-size);
}

.box {
	display: flex;
	flex-direction: row;
	flex-wrap: wrap;
	flex: 1;
	flex-basis: 8em;
}

[part="nameplate"] {
	flex: 1 1 auto;
	margin-right: 1em;
	margin-bottom: 0.5em;
}

[part="details"] {
	margin-bottom: 0.5em;
}

.buttonbar {
	margin-top: 0.5em;
}

.cardplate > * {
	display: block;
}

.tags {
	list-style: none;
	font-size: 0.6em;
	cursor: default;
}

.tags > li {
	display: inline-block;
	margin: 0 0.1em;
	padding: 0 0.25em;
	border: 1px solid;
	border-radius: 1em;
}

[data-tag=staff] {
	color: var(--cobalt-tagcolor-staff, lime);
}

[data-tag=banned] {
	color: var(--cobalt-tagcolor-banned, red);
}

p[data-field=tagline] {
	opacity: 0.7;
	font-size: 0.7em;
	font-style: italic;
}

xio-text-input > span {
	opacity: 0.4;
	font-size: 0.7rem;
}

xio-text-input + xio-text-input {
	margin-top: 0.1em;
}

[part="details"] {
	font-size: 0.7em;
	list-style: none;
}

[part="details"] > li {
	margin-top: 0.2em;
}

[part="details"] > li > :first-child {
	font-weight: bold;
}

[part="details"] code {
	font-size: 0.6em;
	padding: 0.2em;
	border-radius: 0.3em;
	word-break: break-all;
	background: #0002;
}

.roles {
	font-size: 0.6em;
	list-style: none;
	padding: 0;
	margin-top: 0.3rem;
}

.roles li {
	display: inline-block;
	border: 1px solid;
	border-radius: 1em;
	padding: 0.1em 0.3em;
	line-height: 0.8em;
}

`;function Vn({field:e,initial:t,text:i,input:o}){return o?aa`
			<xio-text-input
				data-field="${e}"
				initial="${t}"
				text="${i}"
				part="xiotextinput"
				exportparts="${"\n\t\t\t\t\tlabel: xiotextinput-label,\n\t\t\t\t\ttextinput: xiotextinput-textinput,\n\t\t\t\t\tproblems: xiotextinput-problems,\n\t\t\t\t"}"
				show-validation-when-empty
				?readonly=${o.readonly}
				?hide-validation=${!o.draftIsChanged}
				.validator=${o.validator}
				@valuechange=${o.onvaluechange}>
					<span>${o.label}</span>
			</xio-text-input>
		`:aa`
			<p part="textfield" data-field="${e}">${t}</p>
		`}function Bn(e){const t=new Date(e),i=e=>e.toString().padStart(2,"0"),o=i(t.getFullYear()),s=i(t.getMonth()+1),a=i(t.getDate()),n=t.getHours();let r=t.getHours();r%=12,r=r||12;const l=i(t.getMinutes()),c=n>=12?"pm":"am",d=-t.getTimezoneOffset(),p=(d/60).toFixed(d%60==0?0:1),u=0===d?"UTC":`UTC${d<0?"":"+"}${p}`,h=`${o}-${s}-${a}`,m=`${r}:${l} ${c}`,f=`${`${Intl.DateTimeFormat().resolvedOptions().timeZone} ${u}`}`;return{date:h,time:m,zone:f,full:`${h} ${m} (${f})`}}function Hn(e){return{tagline:e.tagline,nickname:e.nickname}}function Fn(e,t){return We.isReady(e)?t(We.value(e)):null}function Wn(e,t,i=null){return aa`
		<xio-op .op=${e}>
			${Fn(e,t)}
			${i}
		</xio-op>
	`}var Qn,Kn,Xn=function(e,t,i,o){var s,a=arguments.length,n=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(n=(a<3?s(n):a>3?s(t,i,n):s(t,i))||n);return a>3&&n&&Object.defineProperty(t,i,n),n},Jn=function(e,t,i,o){if("a"===i&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?o:"a"===i?o.call(e):o?o.value:t.get(e)};let Gn=class extends sn{constructor(){super(...arguments),Qn.set(this,this.auto.state({busy:We.ready(void 0)})),Kn.set(this,this.auto.actions({setBusy:e=>{Jn(this,Qn,"f").busy=e}})),this.profileDraft=void 0,this.problems=[],this.handleChange=Ke(200,(()=>{if(!this.user)return;const{profileDraft:e,isChanged:t}=this.generateNewProfileDraftFromInputs();this.profileDraft=t?e:void 0})),this.handleSave=async()=>{const{profileDraft:e}=this;await We.operation({promise:this.saveProfile(e).finally((()=>{this.profileDraft=null})),setOp:e=>Jn(this,Kn,"f").setBusy(e)});const t=(e,t)=>{this.shadowRoot.querySelector(`xio-text-input[data-field="${e}"]`).text=t};t("nickname",e.nickname),t("tagline",e.tagline)}}init(){Jn(this,Kn,"f").setBusy(We.ready(void 0))}get draftIsChanged(){return!!this.profileDraft}get readonly(){return!this.saveProfile}getTextInputField(e){return function(e,t=document){return t.querySelector(e)}(`xio-text-input[data-field="${e}"]`,this.shadowRoot)}generateNewProfileDraftFromInputs(){const{profile:e}=this.user,t=Hn(e),i=this.getTextInputField("nickname");if(!i)return{profileDraft:t,isChanged:!1};const o=this.getTextInputField("tagline");t.nickname=i.value,t.tagline=o.value,this.problems=[...i.problems,...o.problems];return{profileDraft:t,isChanged:!_t(Hn(e),t)}}render(){const{user:e,draftIsChanged:t}=this;if(!e)return null;const i=e.profile.avatar;return Wn(Jn(this,Qn,"f").busy,(()=>aa`
			<div class=container ?data-readonly=${this.readonly}>
				<xio-avatar part=avatar .spec=${i}></xio-avatar>
				<div class=box>
					<div part=nameplate>
						${Vn({field:"nickname",initial:this.profileDraft?this.profileDraft.nickname:e.profile.nickname,text:e.profile.nickname,input:this.readonly?void 0:{label:"nickname",readonly:!1,draftIsChanged:t,validator:co.nickname,onvaluechange:this.handleChange}})}
						${Vn({field:"tagline",initial:this.profileDraft?this.profileDraft.tagline:e.profile.tagline,text:e.profile.tagline,input:this.readonly?void 0:{label:"tagline",readonly:!1,draftIsChanged:t,validator:co.tagline,onvaluechange:this.handleChange}})}
						${function(e){return aa`
		<ul class=roles>
			${e.roles.map((e=>aa`
				<li
					data-role-label="${e.label}"
					data-role-id="${e.roleId}">
						${e.label}
				</li>
			`))}
		</ul>
	`}(e)}
						${this.readonly?null:aa`
							<div class=buttonbar>
								<xio-button
									?disabled=${!this.profileDraft||this.problems.length>0}
									@press=${this.handleSave}>
										<slot name=save-button>save profile</slot>
								</xio-button>
							</div>
						`}
					</div>
					${this["show-details"]?function(e){return aa`
		<ul part=details>
			<li>
				<span>joined:</span>
				<span>${Bn(e.stats.joined).date}</span>
			</li>
			<li>
				<span>user id:</span>
				<span><xio-id id="${e.userId}"></xio-id></span>
			</li>
		</ul>
	`}(e):null}
				</div>
			</div>
		`))}};Qn=new WeakMap,Kn=new WeakMap,Xn([Da({type:Boolean})],Gn.prototype,"show-details",void 0),Xn([Da({type:Object})],Gn.prototype,"user",void 0),Xn([Da({type:Object})],Gn.prototype,"saveProfile",void 0),Xn([Da({type:Object})],Gn.prototype,"profileDraft",void 0),Gn=Xn([Na(zn)],Gn);var Yn=Ts`

:host {
	display: block;
}

.app-list {
	margin-top: 2em;
	margin-bottom: 2em;
}

.app-list > xio-op {
	display: block;
	border: 1px solid #f00;
	margin-top: 0.5em;
	border: 1px solid #fff1;
	border-radius: 0.2em;
}

.app-list > xio-op[mode="loading"] {
	padding: 4em 2em;
}

.app > * + * {
	margin-top: 0.3em;
}

.app + .app {
	margin-top: 1.5em;
}

.app > * {
	padding: 0.4em 1rem;
}

.app-header {
	display: flex;
	flex-direction: row;
	flex-wrap: wrap;
	justify-content: flex-end;
	padding: 0;
	background: #0001;
}

.app-header .title {
	max-width: 100%;
	flex: 1 0 auto;
	padding: 0.3em 1em;
}

.app-header .title h3 {
	font-size: 1.5em;
	font-weight: bold;
}

.app-header .title h3::before {
	content: "🌐";
	color: white;
}

.app-header .stats {
	display: flex;
	flex-direction: row;
	justify-content: center;
	flex-wrap: wrap;
	padding: 0.2em;
}

.app-header .stats [data-stat] {
	display: flex;
	flex-direction: column;
	justify-content: flex-end;
	max-width: 6em;
	text-align: center;
}

.app-header .stats [data-stat] > span {
	padding: 0.1em 0.6em;
}

.app-header .stats [data-stat] > span:nth-child(1) {
	justify-self: flex-start;
}

.app-header .stats [data-stat] > span:nth-child(2) {
	opacity: 0.3;
	font-size: 0.6em;
}

.twoside {
	display: flex;
	flex-direction: row;
	flex-wrap: wrap;
}

.twoside > div {
	max-width: 100%;
	flex: 1 0 16em;
	padding-bottom: 1em;
}

.twoside > div:nth-child(1) {
	padding-right: 1rem;
}

.editside > .buttons {
	display: flex;
	justify-content: center;
	align-items: center;
}

.app-form > * + * {
	margin-top: 0.3em;
}

.app-form xio-button {
	margin-top: 0.6em;
}

.app-options {
	border: 1px solid #fff1;
	padding: 1em;
}

.app-options > * + * {
	margin-top: 3em;
}

code {
	display: inline-block;
	font-size: 0.8em;
	padding: 0.2em;
	border-radius: 0.3em;
	background: #0002;
	overflow-wrap: anywhere;
	word-break: break-all;
}

code.id {
	opacity: 0.7;
	font-size: 0.5em;
}

.codeblock {
	display: block;
}

.htmlcode { color: #fff6; }
.htmlcode [data-syntax=tag] { color: deepskyblue; }
.htmlcode [data-syntax=attr] { color: skyblue; }
.htmlcode [data-syntax=data] { color: #aaffa0; }
.htmlcode [data-syntax=indent] {
	display: block;
	margin-left: 1em;
}

.app-code > * {
	margin-top: 1em;
}

.app-code code {
	display: block;
	font-size: 0.6em;
	padding: 1em;
	margin: 0.5em 0;
}

.delete-app-button {
	display: block;
	text-align: right;
	--xio-button-hover-color: red;
}

${Ts`

.adminmanager .adminassigner {
	display: flex;
	flex-direction: row;
	margin: 0.5em 0;
}

.adminmanager .adminassigner > * {
	display: block;
}

.adminmanager .adminassigner > xio-text-input {
	flex: 1 1 auto;
}

.adminmanager .adminassigner > xio-text-input {
	width: 100%;
	max-width: 100%;
}

.adminmanager .adminassigner > xio-text-input::part(problems) {
	min-width: unset;
}

.adminmanager .adminassigner > xio-button {
	margin-top: 1.1em;
	margin-left: 0.3em;
}

.adminmanager .adminlist ul {
	list-style: none;
	padding: 0 1em;
	border: 1px solid #fff1;
}

.adminmanager .adminlist li {
	display: flex;
	flex-direction: row;
	align-content: center;
	padding: 0.3em 0;
	font-size: 0.8em;
}

.adminmanager .adminlist li + li {
	border-top: 1px solid #fff1;
}

.adminmanager .adminlist li > * {
	display: block;
}

.adminmanager .adminlist li > span {
	flex: 1 1 auto;
	display: flex;
	align-items: center;
	word-break: break-all;
}

.adminmanager .adminlist li > xio-button {
	color: #fff3;
}

`}

.app-list {
	margin-bottom: 5rem;
}

.app-registration {
	max-width: 40em;
	margin-bottom: 5em;
}

`;const Zn=e=>e.split("\n").map((e=>e.trim().toLowerCase())).filter((e=>e.length>0));function er({clearOnSubmit:e,submitButtonText:t,showAdditionalOrigins:i,initialValues:o={home:"",label:"",additionalOrigins:[]},query:s,submit:a,requestUpdate:n}){const r={problems:[],formDisabled:!1,draft:o,get valid(){return!this.formDisabled&&this.draft&&0===this.problems.length}};function l(){return{home:s('.app-form [data-form="home"]'),label:s('.app-form [data-form="label"]'),additionalOrigins:s('.app-form [data-form="additional-origins"]')}}const c=()=>{const{home:e,label:t,additionalOrigins:i}=l();var o;r.draft={home:e.value,label:t.value,additionalOrigins:i.value},r.problems=(o=r.draft,[...Li.label(o.label),...Li.home(o.home),...Li.additionalOrigins(o.additionalOrigins)]),n()};function d(){r.problems=[],r.formDisabled||c()}async function p(){c(),r.formDisabled=!0,n();try{await a(r.draft),e?function(e){const t=l();t.home.text=e.home,t.label.text=e.label,t.additionalOrigins.text=e.additionalOrigins.join("\n")}(o={home:"",label:"",additionalOrigins:[]}):o=r.draft}finally{r.formDisabled=!1,n()}}return{render:function({partNamespace:e}){const{formDisabled:s,draft:a,problems:n}=r,l=!_t(o,a),c=!l||s||n.length>0,u=`\n\t\t\tlabel: xiotextinput-label,\n\t\t\ttextinput: xiotextinput-textinput,\n\t\t\tproblems: xiotextinput-problems,\n\n\t\t\tlabel: ${e}-appform-xiotextinput-label,\n\t\t\ttextinput: ${e}-appform-xiotextinput-textinput,\n\t\t\tproblems: ${e}-appform-xiotextinput-problems,\n\t\t`,h=({hide:t,textarea:i,label:o,dataForm:a,initialText:n,showValidationWhenEmpty:r,parser:c,validator:p})=>aa`
			<xio-text-input
				?textarea=${i}
				part="${e}-appform-xiotextinput"
				exportparts="${u}"
				data-form="${a}"
				initial="${n}"
				?hidden=${t}
				?disabled=${s}
				?hide-validation=${!l}
				?show-validation-when-empty=${r}
				.parser=${c}
				.validator=${p}
				@valuechange=${d}>
					<span part=xio-text-input-label>
						${o}
					</span>
			</xio-text-input>
		`;return aa`
			<div class=app-form>
				<slot name=create-app-heading></slot>

				${h({hide:!1,textarea:!1,dataForm:"label",label:"community name",initialText:o.label,showValidationWhenEmpty:!1,parser:void 0,validator:Li.label})}

				${h({hide:!1,textarea:!1,dataForm:"home",label:'website homepage, like "https://chasemoskal.com/"',initialText:o.home,showValidationWhenEmpty:!1,parser:void 0,validator:Li.home})}

				${h({hide:!i,textarea:!0,dataForm:"additional-origins",label:"(optional) additional domain names",initialText:o.additionalOrigins.join("\n"),showValidationWhenEmpty:!0,parser:Zn,validator:Li.additionalOrigins})}

				<xio-button
					class="create-app-button"
					?disabled=${c}
					@press=${p}>
						${t}
				</xio-button>
			</div>
		`}}}function tr({app:e,appEditService:t,query:i}){const{state:o,actions:s,track:a}=function(){const e=Ta(),t=e.state({admins:We.none(),assignerDraft:{email:void 0}}),i=e.actions({setAdmins(e){t.admins=e},setAssignerDraft(e){t.assignerDraft=e}});return{track:e.track,state:t,actions:i}}(),n=function({app:e,state:t,actions:i,appEditService:o}){const{appId:s}=e,a=(e=Promise.resolve(void 0))=>We.operation({promise:e.then((()=>o.listAdmins({appId:s}))),setOp:e=>i.setAdmins(e)});return{listAdmins:async function(){await a()},assignAdmin:async function(){const{email:e}=t.assignerDraft;i.setAssignerDraft({email:void 0}),await a(o.assignAdmin({appId:s,email:e}))},revokeAdmin:async function(e){await a(o.revokeAdmin({appId:s,userId:e}))}}}({app:e,state:o,actions:s,appEditService:t});function r(e){const t=e.detail.value??void 0;s.setAssignerDraft({email:t})}function l(){const e=i(".adminassigner xio-text-input");n.assignAdmin(),e.text=""}function c(){return aa`
			<div class=adminassigner>
				<xio-text-input
					part=adminmanager-xiotextinput
					exportparts="${"\n\t\t\tlabel: xiotextinput-label,\n\t\t\ttextinput: xiotextinput-textinput,\n\t\t\tproblems: xiotextinput-problems,\n\n\t\t\tlabel: adminmanager-xiotextinput-label,\n\t\t\ttextinput: adminmanager-xiotextinput-textinput,\n\t\t\tproblems: adminmanager-xiotextinput-problems,\n\t\t"}"
					.validator=${no}
					@valuechange=${r}>
						email
				</xio-text-input>
				<xio-button
					?disabled=${!o.assignerDraft.email}
					@press=${l}>
						grant
				</xio-button>
			</div>
		`}return{render:function(){return aa`
			${c()}
			${aa`
			<div class=adminlist>
				${Wn(o.admins,(e=>aa`
					<ul>
						${e.map((({email:e,userId:t})=>aa`
							<li>
								<span>${e}</span>
								<xio-button @press=${()=>n.revokeAdmin(t)}>
									revoke
								</xio-button>
							</li>
						`))}
					</ul>
				`))}
			</div>
		`}
		`},controls:n,track:a}}function ir(e){return{home:e.home,label:e.label,origins:(t=[new URL(e.home).origin,...e.additionalOrigins],[...new Set(t)])};var t}function or(){return function(e){const t=new Map;return function(i){let o;return t.has(i)?o=t.get(i):(o=e(i),t.set(i,o)),o}}}var sr=function(e,t,i,o){var s,a=arguments.length,n=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(n=(a<3?s(n):a>3?s(t,i,n):s(t,i))||n);return a>3&&n&&Object.defineProperty(t,i,n),n};let ar=class extends on{constructor(){super(...arguments),this.appRegistrationForm=er({clearOnSubmit:!0,showAdditionalOrigins:!1,submitButtonText:"create community",requestUpdate:()=>this.requestUpdate(),query:e=>this.shadowRoot.querySelector(".app-registration").querySelector(e),submit:async e=>{const t=ir(e);await this.share.appsModel.registerApp(t)}}),this.getAppState=or()((e=>{const t=this.share.appsModel.getApp(e),{actions:i,getState:o,onStateChange:s}=Ot({state:{editMode:!1},actions:e=>({toggleEditMode(){e.editMode=!e.editMode}})});return s((()=>{this.requestUpdate()})),{toggleEditMode:i.toggleEditMode,get editMode(){return o().editMode},appForm:er({clearOnSubmit:!1,showAdditionalOrigins:!0,submitButtonText:"save changes",initialValues:(a=t,{home:a.home,label:a.label,additionalOrigins:(n=a.home,r=a.origins,r.filter((e=>e.toLowerCase()!==new URL(n.toLowerCase()).origin)).map((e=>e.toLowerCase())))}),requestUpdate:()=>{this.requestUpdate()},query:e=>this.shadowRoot.querySelector(`.app[data-app-id="${t.appId}"] .app-options`).querySelector(e),submit:async e=>{const i=ir(e);await this.share.appsModel.updateApp(t.appId,i)}}),adminManager:(()=>{const e=tr({app:t,appEditService:this.share.appsModel.appEditService,query:e=>this.shadowRoot.querySelector(`.app[data-app-id="${t.appId}"] .adminmanager`).querySelector(e)});return e.track({watcher:()=>{e.render()},effect:()=>this.requestUpdate()}),e.controls.listAdmins(),e})()};var a,n,r})),this.deleteApp=async e=>{await this.share.modals.confirm({title:"are you certain?",body:`you really want to delete your community "${e.label}"?`,yes:{label:"delete whole community",vibe:"negative"},no:{label:"nevermind",vibe:"neutral"},focusNthElement:2})&&await this.share.appsModel.deleteApp(e.appId)}}init(){this.share.appsModel.loadApps()}renderAppRegistration(){return aa`
			<div class=app-registration>
				<slot name="register-app-heading"></slot>
				${this.appRegistrationForm.render({partNamespace:"appregistration"})}
			</div>
		`}renderNoApps(){return aa`
			<slot name=no-apps></slot>
			${this.renderAppRegistration()}
		`}renderAppList(e){return aa`
			<slot></slot>
			<div class=app-list>
				${Object.entries(e).map((([e,t])=>Wn(t,(e=>this.renderApp(e)))))}
			</div>
			${this.renderAppRegistration()}
		`}renderAppBankLinking(e){return null}renderAppCode(e){return aa`
			<div class=app-code>
				<h4>connect your website</h4>
				<p>copy-paste this html into your website's &lt;head&gt; section:</p>
				<code class=htmlcode>
					${function(e){const t=(e,t)=>aa`<span data-syntax=${e}>${t}</span>`,i=e=>t("tag",e),o=e=>t("attr",e),s=e=>t("data",e),a=e=>t("glue",e),n=a('"');return aa`
		${a("<")}${i("script")} ${o("async")} ${o("defer")} ${o("src")}${a("=")}${n}${s("https://xiome.io/xiome.bundle.min.js")}${n}${a(">")}${a("</")}${i("script")}${a(">")}
		<br/>
		${a("<")}${i("xiome-config")} ${o("app")}${a("=")}${n}${s(e)}${n}${a(">")}${a("</")}${i("xiome-config")}${a(">")}
	`}(e)}
				</code>
				<p>then head over to the <a part=link href="./components">components page</a></p>
			</div>
		`}renderApp(e){const t=this.getAppState(e.appId);return aa`
			<div class=app data-app-id=${e.appId}>

				<div class=app-header part=app-header>
					<div class=title>
						<h3>
							<a part=link target=_blank href="${e.home}">
								${e.label}
							</a>
						</h3>
					</div>
					<div class=stats>
						<div data-stat=users>
							<span>${e.stats.users.toLocaleString()}</span>
							<span>users</span>
						</div>
						<div data-stat=monthly-active>
							<span>${e.stats.usersActiveMonthly.toLocaleString()}</span>
							<span>monthly active</span>
						</div>
						<div data-stat=active-last-day>
							<span>${e.stats.usersActiveDaily.toLocaleString()}</span>
							<span>daily active</span>
						</div>
					</div>
				</div>

				<div class=twoside>
					${this.renderAppCode(e.appId)}
					<div class=editside>
						<div class=buttons>
							<xio-button @click=${t.toggleEditMode}>edit community</xio-button>
						</div>
						<div class=app-options ?hidden=${!t.editMode}>
							<div class=app-details>
								${t.appForm.render({partNamespace:"appeditor"})}
							</div>
							<div class=adminmanager>
								<h4>manage admins</h4>
								${t.adminManager.render()}
							</div>
							${this.renderAppBankLinking(e)}
							<div class=finalbox>
								<xio-button
									class=delete-app-button
									@press=${()=>this.deleteApp(e)}>
										delete community
								</xio-button>
							</div>
						</div>
					</div>
				</div>
			</div>
		`}render(){const{appRecords:e}=this.share.appsModel.state;return aa`
			${Wn(e,(e=>Object.values(e).length?this.renderAppList(e):this.renderNoApps()))}
		`}};ar=sr([Na(Yn)],ar);var nr=Ts`

.avatar {
	display: block;
	width: 3em;
	height: 3em;
	padding: 0.2em;
	border-radius: 0.3em;
}

:host([logged-in]) .avatar {
	color: #fff;
}

svg {
	display: block;
	width: 100%;
	height: 100%;
}

`,rr=function(e,t,i,o){var s,a=arguments.length,n=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(n=(a<3?s(n):a>3?s(t,i,n):s(t,i))||n);return a>3&&n&&Object.defineProperty(t,i,n),n};let lr=class extends an{render(){return Wn(this.share.accessModel.getAccessOp(),(e=>aa`
			<xio-avatar
				.spec=${e?.user?.profile.avatar}
				part="xio-avatar"
			></xio-avatar>
		`))}};lr=rr([Na(nr)],lr);var cr=Ts`

xio-profile-card {
	--avatar-size: 7em;
}

`,dr=function(e,t,i,o){var s,a=arguments.length,n=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(n=(a<3?s(n):a>3?s(t,i,n):s(t,i))||n);return a>3&&n&&Object.defineProperty(t,i,n),n};let pr=class extends on{constructor(){super(...arguments),this.saveProfile=async e=>{await this.share.personalModel.saveProfile(e)}}render(){const{accessOp:e}=this.share.personalModel.readable;return Wn(e,(({user:e})=>aa`
			<xio-profile-card
				show-details
				.user=${e}
				.saveProfile=${this.saveProfile}
			></xio-profile-card>
		`))}};pr=dr([Na(cr)],pr);var ur=Ts`

:host {
	display: block;
}

slot {
	display: block;
}

xio-text-input,
xio-button {
	margin-top: 0.2em;
}

xio-text-input > span {
	opacity: 0.4;
	font-size: 0.7em;
}

.buttonbar {
	margin-top: 0.5em;
	vertical-align: middle;
}

slot[name="legal"] {
	display: inline-block;
	margin: 0 1em;
}

small {
	display: block;
	opacity: 0.5;
	font-size: 0.7em;
}

`,hr=function(e,t,i,o){var s,a=arguments.length,n=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(n=(a<3?s(n):a>3?s(t,i,n):s(t,i))||n);return a>3&&n&&Object.defineProperty(t,i,n),n};let mr=class extends on{constructor(){super(...arguments),this["show-logout"]=!1,this.status="loading",this.sentLoading=We.none(),this.emailIsValid=!1}async sendEmail(){const e=this.textInput.value;await We.operation({promise:this.share.accessModel.sendLoginLink(e).then((()=>({email:e}))),setOp:e=>this.sentLoading=e,errorReason:`failed sending email to "${e}"`})}resetSentLoading(){this.sentLoading=We.none(),this.textInput&&(this.textInput.text="")}logout(){this.share.accessModel.logout().then((()=>this.sentLoading=We.none()))}subscribe(){return this.share.accessModel.subscribe((()=>{this.resetSentLoading()}))}renderLoggedIn(e){return aa`
			<slot>
				<p>Welcome ${e.user.profile.nickname}!</p>
			</slot>
			${this["show-logout"]?aa`
					<div part=buttonbar>
						<xio-button class=logout-button @press=${this.logout}>
							Logout
						</xio-button>
					</div>
				`:null}
		`}handleEmailChange(){this.emailIsValid=0===this.textInput.problems.length}renderLegalLink(){return aa`
			<small>
				<p>
					<a
						part=link
						target=_blank
						href="https://xiome.io/legal">
							policies and terms
					</a>
				</p>
			</small>
		`}renderLoggedOut(){const{emailIsValid:e}=this;return aa`
			<xio-op .op=${this.sentLoading}>
				<div slot=none>
					<slot name=logged-out>
						<p>login with your email address</p>
					</slot>
					<xio-text-input
						.validator=${Qt()}
						@valuechange=${this.handleEmailChange}
						@enterpress=${this.sendEmail}>
							<span>your email</span>
					</xio-text-input>
					<div class=buttonbar>
						<slot name=legal>
							${this.renderLegalLink()}
						</slot>
						<xio-button
							?disabled=${!e}
							@press=${this.sendEmail}>
								send login link
						</xio-button>
					</div>
				</div>
				${We.isReady(this.sentLoading)?aa`
						<p>email sent to ${We.value(this.sentLoading).email}</p>
						<p>please wait a few minutes for it to arrive</p>
						<xio-button @press=${this.resetSentLoading}>
							restart
						</xio-button>
					`:null}
			</xio-op>
		`}render(){const e=this.share.accessModel.getAccessOp();return this.status="loading",We.isReady(e)&&(this.status=We.value(e)?.user?"logged-in":"logged-out"),Wn(e,(e=>e?.user?this.renderLoggedIn(e):this.renderLoggedOut()))}};hr([Da({type:Boolean,reflect:!0})],mr.prototype,"show-logout",void 0),hr([Da({type:String,reflect:!0})],mr.prototype,"status",void 0),hr([Da()],mr.prototype,"sentLoading",void 0),hr([ja("xio-text-input")],mr.prototype,"textInput",void 0),hr([Da({type:String})],mr.prototype,"emailIsValid",void 0),mr=hr([Na(ur)],mr);var fr=Ts`

.creator {
	margin: 1em auto;
}

.privilege {
	display: inline-flex;
	flex-direction: row;
	padding: 0.2em 0.5em;
	margin: 0.2em;
	border: 1px solid;
}

.privilege .icon {
	padding-right: 0.5em;
}

.privilege xio-button {
	--xio-button-padding: 0;
	--xio-button-border: none;
}

.privilege[data-hard] {
	opacity: 0.5;
	border: 1px solid dashed;
}

`,gr=na`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 16 16"><g fill="none"><path d="M7 5a4 4 0 0 1 5.445-3.73a.5.5 0 0 1 .173.819L10.708 4L12 5.293l1.91-1.91a.5.5 0 0 1 .82.172a4 4 0 0 1-4.829 5.292L4.897 13.92a1.986 1.986 0 0 1-2.843-2.774l5.051-5.234A4.01 4.01 0 0 1 7 5zm4-3a3 3 0 0 0-2.862 3.903a.5.5 0 0 1-.117.498L2.773 11.84a.986.986 0 0 0 1.41 1.377l5.225-5.293a.5.5 0 0 1 .532-.116a3 3 0 0 0 4.046-3.088l-1.633 1.634a.5.5 0 0 1-.707 0l-2-2a.5.5 0 0 1 0-.707l1.634-1.634A3.045 3.045 0 0 0 11 2z" fill="currentColor"/></g></svg>`,br=na`<svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill="currentColor" fill-rule="evenodd" d="M7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm0 1.3c1.3 0 2.5.44 3.47 1.17l-8 8A5.755 5.755 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zm0 11.41c-1.3 0-2.5-.44-3.47-1.17l8-8c.73.97 1.17 2.17 1.17 3.47 0 3.14-2.56 5.7-5.7 5.7z"/></svg>`;const vr=jt((e=>"string"!=typeof e?["must be a string"]:[]),Ht(1),Ft(32));var wr,yr,xr,kr,Sr,Ir,$r,Pr,Ar=function(e,t,i,o){var s,a=arguments.length,n=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(n=(a<3?s(n):a>3?s(t,i,n):s(t,i))||n);return a>3&&n&&Object.defineProperty(t,i,n),n},_r=function(e,t,i,o,s){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?s.call(e,i):s?s.value=i:t.set(e,i),i},Or=function(e,t,i,o){if("a"===i&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?o:"a"===i?o.call(e):o?o.value:t.get(e)};let Cr=class extends on{constructor(){super(...arguments),wr.add(this),yr.set(this,!1),Ir.set(this,void 0),$r.set(this,(e=>{_r(this,Ir,e.detail.value,"f"),this.requestUpdate()}))}get model(){return this.share.permissionsModel}init(){this.model.initialize()}render(){const{readable:{permissionsDisplay:e}}=this.model,t=this.model.getUserCanCustomizePermissions();return Wn(e,(e=>t?aa`
			<div class=privileges>
				${Or(this,wr,"m",Pr).call(this)}
				${e.privileges.map((e=>function({privilege:{hard:e,label:t,privilegeId:i},onDeleteClick:o}){return aa`
		<div
			class=privilege
			?data-hard=${e}>
				${e?aa`
			<div class="icon system">
				${gr}
			</div>
		`:aa`
			<xio-button
				title="delete privilege"
				class="icon delete"
				@press=${o}>
					${br}
			</xio-button>
		`}
				<span class=text>${t}</span>
		</div>
	`}({privilege:e,onDeleteClick:()=>Or(this,wr,"m",Sr).call(this,e)})))}
			</div>
		`:aa`
			<p>you are not permitted to customize privileges</p>
		`))}};yr=new WeakMap,Ir=new WeakMap,$r=new WeakMap,wr=new WeakSet,xr=function(){this.shadowRoot.querySelector(".creator xio-text-input").text=""},kr=async function(){if(Or(this,yr,"f"))throw new Error("privilege creator is busy");const e=Or(this,Ir,"f");Or(this,wr,"m",xr).call(this),_r(this,yr,!0,"f");try{await this.model.createPrivilege({label:e})}finally{_r(this,yr,!1,"f")}},Sr=async function({privilegeId:e,label:t}){await this.share.modals.confirm({title:aa`delete privilege ${t}?`,body:aa`are you sure you want to delete this privilege?`})&&await this.model.deletePrivilege({privilegeId:e})},Pr=function(){const e=!Or(this,Ir,"f");return aa`
			<div class=creator>
				<xio-text-input
					?disabled=${Or(this,yr,"f")}
					.validator=${vr}
					@valuechange=${Or(this,$r,"f")}
					@enterpress=${Or(this,wr,"m",kr)}>
						privilege label
				</xio-text-input>
				<xio-button
					?disabled=${e}
					@press=${Or(this,wr,"m",kr)}>
						create privilege
				</xio-button>
			</div>
		`},Cr=Ar([Na(fr)],Cr);var Tr=Ts`

* {
	ZZoutline: 1px solid #0f02;
}

:host {
	display: block;
	width: 100%;
}

.container {
	display: flex;
	flex-direction: row;
	flex-wrap: wrap;
	gap: 0.5em;
}

.container > * {
	flex: 3 1 10em;
	display: flex;
	flex-direction: column;
}

.roles {
	flex: 1 3 10em;
}

.roles xio-button[data-hard] {
	opacity: 0.6;
}

.container > * > p {
	padding: 0 0.5em;
}

[part=plate] {
	flex: 1 1 auto;
	padding: 0.5em;
	background: #fff2;
}

[part=plate] xio-button {
	display: inline-block;
	margin: 0.2em 0.1em;
	--xio-button-disabled-opacity: 0.6;
}

[part=plate] xio-button[data-hard] {
	opacity: 0.6;
}

[part=plate] xio-button[data-selected]::part(button) {
	border: 1px solid lime;
	background: yellow;
	color: black;
}

[part=plate] xio-button > div {
	display: flex;
	flex-direction: row;
}

[part=plate] xio-button .icon {
	margin-right: 0.2em;
}

[part=plate] xio-button svg {
	width: 0.8em;
	height: 0.8em;
}

.buttonbar {
	text-align: right;
	background: #0002;
}

.buttonbar [data-button=delete] {
	--xio-button-hover-color: red;
	--xio-button-hover-background: transparent;
}

.buttonbar [data-button=new] {
	--xio-button-hover-color: lime;
	--xio-button-hover-background: transparent;
}

`,Mr=na`<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-lock"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>`,Er=function(e,t,i,o){var s,a=arguments.length,n=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(n=(a<3?s(n):a>3?s(t,i,n):s(t,i))||n);return a>3&&n&&Object.defineProperty(t,i,n),n};let Rr=class extends on{constructor(){super(...arguments),this.clickRole=e=>()=>{this.roleSelected=e},this.clickDeleteRole=async()=>{const{modals:e,permissionsModel:t}=this.share,i=this.roleSelected;await e.confirm({title:"Delete role?",body:`Are you sure you want to permanently delete the role "${i.label}"`,yes:{vibe:"negative",label:"Delete role"},no:{vibe:"neutral",label:"Nevermind"},focusNthElement:2})&&await t.deleteRole({roleId:i.roleId})},this.clickNewRole=async()=>{const{modals:e,permissionsModel:t}=this.share,i=await e.prompt({title:"Create a new role",input:{label:"Role name",validator:ho},yes:{vibe:"positive",label:"Create role"}});i&&await t.createRole({label:i.value})},this.clickAvailablePrivilege=e=>async()=>{const{roleSelected:t}=this;t&&await this.share.permissionsModel.assignPrivilege({privilegeId:e,roleId:t.roleId})},this.clickAssignedPrivilege=e=>async()=>{const{roleSelected:t}=this;t&&await this.share.permissionsModel.unassignPrivilege({privilegeId:e,roleId:t.roleId})}}init(){this.share.permissionsModel.initialize()}getAssignedPrivileges(e){const{roleSelected:t}=this;if(!t)return[];const i=e.rolesHavePrivileges.filter((({roleId:e})=>e===t.roleId)).map((({privilegeId:e})=>e));return e.privileges.filter((({privilegeId:e})=>i.includes(e))).map((i=>{const{active:o,immutable:s}=e.rolesHavePrivileges.find((e=>e.roleId===t.roleId&&e.privilegeId===i.privilegeId));return{...i,active:o,immutable:s}}))}renderPrivilege({privilegeId:e,label:t,hard:i,immutable:o,onPrivilegeClick:s}){return aa`
			<xio-button
				title="${e}"
				?disabled=${o}
				?data-hard=${i}
				?data-soft=${!i}
				?data-immutable=${o}
				@press=${s}>
					<div>
						${i?aa`<div class=icon>${gr}</div>`:null}
						${o?aa`<div class=icon>${Mr}</div>`:null}
						${t}
					</div>
			</xio-button>
		`}renderPermissions(e){const t=this.getAssignedPrivileges(e),i=t.filter((e=>e.active)),o=this.roleSelected?[...e.privileges.filter((e=>!t.find((t=>t.privilegeId===e.privilegeId)))).map((e=>({...e,immutable:!1}))),...t.filter((e=>!e.active))]:[];return aa`
			<div class=container>
				<div class=roles>
					<p>roles</p>
					<div part=plate>
						${e.roles.map((e=>aa`
							<xio-button
								title="${e.roleId}"
								?data-selected=${this.roleSelected&&e.roleId===this.roleSelected.roleId}
								?data-hard=${e.hard}
								?disabled=${this.roleSelected&&e.roleId===this.roleSelected.roleId}
								@click=${this.clickRole(e)}>
								<div>
									${e.hard?aa`<div class=icon>${gr}</div>`:null}
									${e.label}
								</div>
							</xio-button>
						`))}
					</div>
					<div part=plate class=buttonbar>
						${this.roleSelected?aa`
								<xio-button
									data-button=delete
									?disabled=${this.roleSelected.hard}
									@press=${this.clickDeleteRole}>
										delete role
								</xio-button>
							`:null}
						<xio-button data-button=new @press=${this.clickNewRole}>
							new role
						</xio-button>
					</div>
				</div>

				<div class=assigned>
					<p>
						privileges assigned
						${this.roleSelected?` to "${this.roleSelected.label}"`:null}
					</p>
					<div part=plate>
						${i.map((e=>this.renderPrivilege({...e,onPrivilegeClick:this.clickAssignedPrivilege(e.privilegeId)})))}
					</div>
				</div>

				<div class=available>
					<p>privileges available</p>
					<div part=plate>
						${o.map((e=>this.renderPrivilege({...e,onPrivilegeClick:this.clickAvailablePrivilege(e.privilegeId)})))}
					</div>
				</div>
			</div>
		`}render(){const{permissionsModel:e}=this.share,{getUserCanCustomizePermissions:t,readable:i}=e;return t()?Wn(i.permissionsDisplay,this.renderPermissions.bind(this)):aa`
				<p>you are not privileged to customize permissions</p>
			`}};function qr({models:e,modals:t}){const{accessModel:i,appsModel:o,personalModel:s,permissionsModel:a}=e;return{XiomeMyAvatar:Qa(i.subscribe)(Ka({accessModel:i})(lr)),XiomeLoginPanel:Qa(i.subscribe)(Ka({accessModel:i})(mr)),XiomeAppManager:Qa(o.subscribe)(Ka({modals:t,appsModel:o})(ar)),XiomeMyAccount:Qa(s.subscribe)(Ka({personalModel:s})(pr)),XiomePermissions:Qa(a.subscribe)(Ka({modals:t,permissionsModel:a})(Rr)),XiomePrivileges:Qa(a.subscribe)(Ka({modals:t,permissionsModel:a})(Cr))}}Er([Da()],Rr.prototype,"roleSelected",void 0),Rr=Er([Na(Tr)],Rr);var Dr=Ts`

:host {
	display: block;
}

`;function jr({view:e,onDeleteClick:t,getPrivilegeDisplay:i}){return aa`
		<div class="view">
			<div class="view-details">
				<div>
					<h4>hosting provider</h4>
					<p>${e.provider}</p>
				</div>
				<div>
					<h4>content type</h4>
					<p>${e.type}</p>
				</div>
				<div>
					<h4>content id</h4>
					<xio-id id="${e.id}"></xio-id>
				</div>
			</div>
			<h4>privileges with access</h4>
			<ul>
				${e.privileges.map(i).map((e=>e?aa`<li>${e.label}</li>`:null))}
			</ul>
			<div class=buttonbar>
			<xio-button @press=${t}>
				unassign from this display
			</xio-button>
			</div>
		</div>
	`}var Lr=function(e,t,i,o){var s,a=arguments.length,n=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(n=(a<3?s(n):a>3?s(t,i,n):s(t,i))||n);return a>3&&n&&Object.defineProperty(t,i,n),n};let Ur=class extends on{async init(){this.share.contentModel.initializeForModerationData()}render(){const e=this.share.contentModel;return e.allowance.canModerateVideos?Wn(e.state.viewsOp,(t=>aa`
				<slot>
					<h3>all video views</h3>
				</slot>
				${t.length?aa`
					<div class=views>
						${t.map((t=>jr({view:t,onDeleteClick:()=>e.deleteView(t.label),getPrivilegeDisplay:t=>e.getPrivilege(t)})))}
					</div>
				`:aa`
					<slot name=no-views>
						<p>no video views are registered</p>
					</slot>
				`}
			`)):aa`
				<slot name=unprivileged>
					<p>you don't have sufficient privileges to moderate video views</p>
				</slot>
			`}};Ur=Lr([Na(Dr)],Ur);var Nr,zr,Vr,Br,Hr,Fr,Wr,Qr,Kr,Xr,Jr=na`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>`,Gr=Ts`

:host {
	display: block;
	width: 24em;
	max-width: 100%;
	border: 1px solid;
	border-radius: 5px;
	--xiome-video-hosting-warning-color: red;
}

.dacastbox {
	padding: 1em;
}

xio-text-input::part(problems) {
	width: 100%;
}

.buttonbar {
	display: flex;
	flex-direction: row;
	justify-content: flex-end;
}

.buttonbar > * {
	margin: 0.4em 0.2em;
}

.failed {
	color: var(--xiome-video-hosting-warning-color);
	display: flex;
	align-items: center;
	padding: 0.5em 0;
}

.failed svg {
	margin-right: 0.5em;
}

.linked {
	display: flex;
}

.helpbox ul {
	padding-left: 1.5em;
}

.link-time-info {
	display: inline-flex;
	align-items: center;
	padding: 0.5em 0;
}


.unlink-button {
	display: flex;
	justify-content: flex-end;
}

.link-time-info svg {
	width: 6em;
	height: 3em;
}
`,Yr=function(e,t,i,o){var s,a=arguments.length,n=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(n=(a<3?s(n):a>3?s(t,i,n):s(t,i))||n);return a>3&&n&&Object.defineProperty(t,i,n),n},Zr=function(e,t,i,o,s){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?s.call(e,i):s?s.value=i:t.set(e,i),i},el=function(e,t,i,o){if("a"===i&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?o:"a"===i?o.call(e):o?o.value:t.get(e)};let tl=class extends on{constructor(){super(...arguments),Nr.set(this,!1),zr.set(this,!1),Vr.set(this,""),Br.set(this,(({detail:{value:e}})=>{Zr(this,Vr,e,"f"),this.requestUpdate()})),Hr.set(this,(async()=>{const e=el(this,Vr,"f");if(e){Zr(this,zr,!1,"f"),Zr(this,Vr,"","f");const t=await this.share.dacastModel.linkAccount({apiKey:e});Zr(this,zr,!t,"f")}})),Fr.set(this,(async()=>{Zr(this,Vr,"","f"),await this.share.dacastModel.unlinkAccount()})),Wr.set(this,(()=>{Zr(this,Nr,!el(this,Nr,"f"),"f"),this.requestUpdate()})),Qr.set(this,(()=>aa`
			<div class=helpbox>
				<p>how to find your dacast api key:</p>
				<ul>
					<li>create a <a part=link target=_blank href="https://dacast.com/">dacast</a> account</li>
					<li>if you have a trial account, you must email support and ask them to activate your account's "api access"</li>
					<li>generate an api key in your <a part=link target=_blank href="https://app.dacast.com/settings/integrations">dacast integrations settings</a></li>
				</ul>
			</div>
		`)),Kr.set(this,(()=>aa`
			<h2>link your dacast account</h2>
			<xio-text-input
				placeholder="api key"
				.validator=${yo}
				@enterpress=${el(this,Hr,"f")}
				@valuechange=${el(this,Br,"f")}>
			</xio-text-input>
			${el(this,zr,"f")?aa`<div class=failed>${un} <p>dacast rejected the api link</p></div>`:null}
			<div class=buttonbar>
				<xio-button
					class=help-button
					@press=${el(this,Wr,"f")}>
						${el(this,Nr,"f")?"hide help":"show help"}
				</xio-button>
				<xio-button
					class=link-button
					?disabled=${!el(this,Vr,"f")}
					@press=${el(this,Hr,"f")}>
						link
				</xio-button>
			</div>
			${el(this,Nr,"f")?el(this,Qr,"f").call(this):null}
		`)),Xr.set(this,(e=>aa`
			<h2>your dacast account is linked</h2>
			<div class=link-time-info>
				${Jr}
				<p>linked on ${Bn(e.time).full}</p>
			</div>
			<div class=unlink-button>
				<xio-button @press=${el(this,Fr,"f")}>unlink</xio-button>
			</div>
		`))}get state(){return this.share.dacastModel.state}async init(){await this.share.dacastModel.initialize()}render(){return Wn(this.state.accessOp,(e=>aa`
			<div class=dacastbox>
				${e.permit.privileges.includes(nt["moderate videos"])?Wn(this.state.linkedAccountOp,(e=>e?el(this,Xr,"f").call(this,e):el(this,Kr,"f").call(this))):aa`<slot name=forbidden>you don't have permission to edit video hosting settings</slot>`}
			</div>
		`))}};Nr=new WeakMap,zr=new WeakMap,Vr=new WeakMap,Br=new WeakMap,Hr=new WeakMap,Fr=new WeakMap,Wr=new WeakMap,Qr=new WeakMap,Kr=new WeakMap,Xr=new WeakMap,tl=Yr([Na(Gr)],tl);var il=Ts`

:host {
	display: block;
	--_select-bg: var(--xiome-video-display-select-background, #222);
	--xiome-video-display-selected-option-color: cyan;
}

.controls-title,
.view,
.viewcreator {
	max-width: 42rem;
}

[part="iframe"] {
	width: 100%;
	height: 100%;
	border: none;
}

.mock-embed img {
	width: 100%;
}

.buttonbar {
	text-align: right;
}

.controls-title,
.viewcreator,
.view {
	border: 1px solid;
	border-radius: 0.2em;
}

.controls-title {
	padding: 0.1em 0.5em;
}
.controls-title[data-open] {
	border-bottom-left-radius: 0;
	border-bottom-right-radius: 0;
}
.view, .viewcreator {
	border-top: 0;
	border-top-left-radius: 0;
	border-top-right-radius: 0;
}

.controls-title {
	display: flex;
	align-items: center;
}
.controls-title div span {
	display: block;
}
.controls-title span:nth-of-type(2) {
	opacity: 0.8;
	font-size: 0.8em;
	font-weight: normal;
	padding-left: 0.2em;
}

.togglebutton {
	--xio-button-border: 0;
	margin-left: auto;
	transition: transform 300ms ease;
	transform: rotate(0deg);
}
[data-open] .togglebutton {
	transform: rotate(180deg);
}

.view, .viewcreator {
	display: flex;
	flex-direction: column;
	gap: 0.2em;
	padding: 0.5em;
}

.viewcreator .selectionarea {
	display: flex;
	flex-wrap: wrap;
	justify-content: space-between;
	width: 100%;
	gap: 0.5em;
	margin: 0.5em 0;
}

.viewcreator .selectionarea > * {
	flex: 1 1 auto;
}

select {
	color: inherit;
	background: transparent;
	border: 1px solid;
	width: 100%;
}

select[multiple] {
	min-height: 10em;
}

select option {
	padding: 0.1em 0.2em;
	color: inherit;
	background: var(--_select-bg);
}

.create-privileges {
	visibility: hidden;
}

.create-privileges[data-visible] {
	visibility: visible;
}

.create-privileges option[selected] {
	color: var(--xiome-video-display-selected-option-color);
}

::-webkit-scrollbar { width: 5px; }
::-webkit-scrollbar-thumb { background: currentColor; }

::scrollbar { width: 8px; }
::scrollbar-thumb { background: currentColor; }

/* When video is displayed css */

.view-details {
	display: flex;
	flex-wrap: wrap;
	justify-content: space-around;
	gap: 0.8em;
	margin: 0.5em 0;
}

.view-details > * {
	text-align: center;
}

.view ul {
	display: flex;
	justify-content: left;
	text-align: center;
	list-style-type: none;
	flex-wrap: wrap;
}

.view ul li {
	border: 1px solid;
	margin: 0.2em;
	padding: 0.1em 0.4em;
	border-radius: 1em;
}

`;function ol(e,t){const i=document.createElement(e);for(const[e,o]of Object.entries(t))i.setAttribute(e,o);return i}const sl=/"(https:\/\/iframe\.dacast\.com\/(\S+)\/(\S+))"/i;function al(e){const t=e.match(sl);if(!t)throw new Error("failed to parse dacast iframe embed code: make-dacast-iframe likely needs to be updated");const[,,i,o]=t;return`https://iframe.dacast.com/${"playlists"===i?"playlist":i}/${o}`}let nl=0;function rl({isContentSelected:e,isCreateButtonDisabled:t,privilegesOp:i,catalogOp:o,selectedContent:s,queryAll:a,onCatalogSelect:n,onPrivilegesSelect:r,onCreateClick:l,isPrivilegeSelected:c}){const d=e=>{const t=e.target;n(parseInt(t.value))},p=()=>{r(a(".create-privileges select option").filter((e=>e.selected)).map((e=>e.value)))};function u(){const t=We.value(o);return aa`
			<div class=create-content>
				${t.length?aa`
					<h5>Select content for this view</h5>
					<select @change=${d}>
						${e?null:aa`
								<option disabled selected>
									(select video content)
								</option>
							`}
						${t.map((({provider:e,type:t,title:i},o)=>aa`
							<option value=${o} ?selected=${o===s}>
								${`${e} ${t} ${i}`}
							</option>
						`))}
					</select>
				`:aa`
					<p>no available video content (are your video accounts linked?)</p>
				`}
			</div>
		`}function h(){const t=We.value(i);return aa`
			<div class="create-privileges" ?data-visible=${e}>
				<h5>Select which privileges have access</h5>
				<select multiple @change=${p}>
					${t.map((e=>aa`
						<option
							?selected=${c(e.privilegeId)}
							value="${e.privilegeId}">
								${e.label}
						</option>
					`))}
				</select>
			</div>
		`}return Wn(We.combine(o,i),(()=>aa`
		<div class=viewcreator>
			<h4>Assign Video Content</h4>
			<div class=selectionarea>
				${u()}
				${h()}
			</div>
			<div class=buttonbar>
				<xio-button
					class=create-button
					?disabled=${t}
					@press=${l}>
						Assign To This Video
				</xio-button>
			</div>
		</div>
	`))}var ll=na`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 16 16"><g transform="rotate(180 8 8)"><g fill="currentColor"><path fill-rule="evenodd" d="M7.022 1.566a1.13 1.13 0 0 1 1.96 0l6.857 11.667c.457.778-.092 1.767-.98 1.767H1.144c-.889 0-1.437-.99-.98-1.767L7.022 1.566z"/></g></g></svg>`;function cl({queryAll:e,contentModel:t,requestUpdate:i}){const{readable:o,writable:s,subscribe:a}=Ze({open:!1,selectedContent:void 0,selectedPrivileges:[]}),n=()=>{s.open=!s.open};return{render:function(i){const a=t.getView(i);return aa`
			<h3 class=controls-title ?data-open=${o.open}>
				<div>
					<span>video display controls</span>
					<span>label = <em>"${i}"</em></span>
				</div>
				<xio-button
					class=togglebutton
					title="${o.open?"close":"open"} video controls"
					@press=${n}>
						${ll}
				</xio-button>
			</h3>
			${o.open?aa`
				${a?jr({view:a,onDeleteClick:()=>t.deleteView(i),getPrivilegeDisplay:e=>t.getPrivilege(e)}):rl({queryAll:e,catalogOp:t.state.catalogOp,privilegesOp:t.state.privilegesOp,isContentSelected:void 0!==o.selectedContent,selectedContent:o.selectedContent,isCreateButtonDisabled:void 0===o.selectedContent||0===o.selectedPrivileges.length,onCatalogSelect:e=>{s.selectedContent=e,s.selectedPrivileges=[]},isPrivilegeSelected:e=>o.selectedPrivileges.some((t=>t===e)),onPrivilegesSelect:e=>{s.selectedPrivileges=e},onCreateClick:()=>{const{selectedContent:e,selectedPrivileges:a}=o;s.selectedContent=void 0,s.selectedPrivileges=[];const n=t.catalog[e];t.setView({label:i,privileges:a,reference:{id:n.id,type:n.type,provider:n.provider}})}})}
			`:null}
		`},subscribe:()=>a(i)}}var dl,pl,ul,hl,ml,fl=function(e,t,i,o){var s,a=arguments.length,n=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(n=(a<3?s(n):a>3?s(t,i,n):s(t,i))||n);return a>3&&n&&Object.defineProperty(t,i,n),n},gl=function(e,t,i,o){if("a"===i&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?o:"a"===i?o.call(e):o?o.value:t.get(e)};let bl=class extends on{constructor(){super(...arguments),dl.add(this),this.label="default",this["mock-embed"]=!1,this["show-title"]=!1,ul.set(this,function(){const e=new Map;return{obtain(t,i){if("dacast"!==t.provider)throw new Error(`unsupported video provider "${t.provider}"`);let o=e.get(t.id);if(!o){o=ol("div",{"data-id":t.id});const s=i?ol("img",{part:"iframe",alt:"",src:"https://source.unsplash.com/random/480x270?"+nl++}):ol("iframe",{src:al(t.embed),part:"iframe",allowfullscreen:"",webkitallowfullscreen:"",mozallowfullscreen:"",oallowfullscreen:"",msallowfullscreen:"",frameborder:"0",scrolling:"no",allow:"autoplay"});o.appendChild(s),e.set(t.id,o)}return o}}}()),hl.set(this,(()=>{const e=cl({contentModel:gl(this,dl,"a",pl),requestUpdate:()=>this.requestUpdate(),queryAll:e=>Array.from(this.shadowRoot.querySelectorAll(e))});return this.addSubscription(e.subscribe),e})())}async init(){await gl(this,dl,"a",pl).initializeForVideo(this.label)}render(){return Wn(gl(this,dl,"a",pl).state.accessOp,(()=>aa`
			${gl(this,dl,"a",pl).allowance.canModerateVideos?gl(this,hl,"f").render(this.label):null}
			${gl(this,dl,"m",ml).call(this)}
		`))}};ul=new WeakMap,hl=new WeakMap,dl=new WeakSet,pl=function(){return this.share.contentModel},ml=function(){const e=gl(this,dl,"a",pl).getShow(this.label);return e?e.details?aa`
					${this["show-title"]?aa`<h4 part=title>${e.details.title}</h4>`:null}
					${gl(this,ul,"f").obtain(e.details,this["mock-embed"])??"(embed missing)"}
					<slot></slot>
				`:aa`<slot name=unprivileged></slot>`:aa`<slot name=unavailable></slot>`},fl([Da({type:String})],bl.prototype,"label",void 0),fl([Da({type:Boolean,reflect:!0})],bl.prototype,"mock-embed",void 0),fl([Da({type:Boolean,reflect:!0})],bl.prototype,"show-title",void 0),bl=fl([Na(il)],bl);var vl,wl,yl=Ts`

:host {
	display: block;
}

`,xl=function(e,t,i,o){var s,a=arguments.length,n=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(n=(a<3?s(n):a>3?s(t,i,n):s(t,i))||n);return a>3&&n&&Object.defineProperty(t,i,n),n},kl=function(e,t,i,o){if("a"===i&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?o:"a"===i?o.call(e):o?o.value:t.get(e)};let Sl=class extends on{constructor(){super(...arguments),vl.add(this),this.label="default"}init(){kl(this,vl,"a",wl).initializeForVideo(this.label)}render(){const e=kl(this,vl,"a",wl).getShow(this.label),{accessOp:t,showsOp:i}=kl(this,vl,"a",wl).state;return Wn(We.combine(t,i),(()=>e?e.details?aa`<slot></slot>`:aa`<slot name=unprivileged></slot>`:aa`<slot name=unavailable></slot>`))}};function Il({models:e}){const{dacastModel:t,contentModel:i}=e.videoModels;return{XiomeVideoHosting:Qa(t.subscribe)(Ka({dacastModel:t})(tl)),XiomeVideoDisplay:Qa(i.subscribe)(Ka({contentModel:i})(bl)),XiomeVideoViews:Qa(i.subscribe)(Ka({contentModel:i})(Ur)),XiomeVideoCompanion:Qa(i.subscribe)(Ka({contentModel:i})(Sl))}}vl=new WeakSet,wl=function(){return this.share.contentModel},xl([Da({type:String})],Sl.prototype,"label",void 0),Sl=xl([Na(yl)],Sl);var $l=Ts`

:host {
	display: block;
}

`,Pl=function(e,t,i,o){var s,a=arguments.length,n=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(n=(a<3?s(n):a>3?s(t,i,n):s(t,i))||n);return a>3&&n&&Object.defineProperty(t,i,n),n};let Al=class extends on{get state(){return this.share.exampleModel.state}render(){return Wn(this.state.accessOp,(e=>aa`
			<p>Example Component</p>
			${e?.user?aa`<p>Welcome, ${e.user.profile.nickname}</p>`:aa`<p>User is not logged in.</p>`}
		`))}};function _l({models:e,modals:t}){const{exampleModel:i}=e;return{XiomeExample:Qa(i.subscribe)(Ka({modals:t,exampleModel:i})(Al))}}Al=Pl([Na($l)],Al);var Ol=Ts`

/* * {
	outline: 1px solid #f002;
} */

:host {
	display: block;
	max-width: 42em;
	--like-color: var(--xiome-questions-like-color, cyan);
	--report-color: var(--xiome-questions-report-color, #f90);
}

.questions-moderation-panel {
	padding: 1em;
	border: 1px dotted;
	margin-bottom: 1em;
}

.questions-moderation-panel .purge-button {
	--xio-button-hover-color: red;
}

slot[name="empty"] {
	display: block;
	margin-top: 1em;
}

[part="questions-list"] {
	list-style: none;

}

[part="questions-list"] > li {
	margin-top: 2em;
}

${Ts`

${Ts`

[data-vote] {
	display: block;
	border: none;
	font: inherit;
	background: transparent;
	color: inherit;
}

[data-vote] {
	cursor: pointer;
	opacity: 0.6;
	user-select: none;
}

[data-vote="report"] {
	opacity: 0.4;
}

[data-vote]:not([disabled]):hover,
[data-vote]:not([disabled]):focus {
	opacity: 1;
}

[data-vote][disabled] {
	cursor: default;
}

[data-vote="like"][data-active] {
	color: var(--like-color);
}

[data-vote="report"][data-active] {
	color: var(--report-color);
}

[data-vote] > span {
	vertical-align: middle;
}

[data-vote] > span:nth-child(2) {
	font-size: 0.9em;
}

[data-vote] svg {
	width: 1.4em;
	height: 1.4em;
	position: relative;
	top: 0.1em;
}

`}

.post {
	display: grid;
	grid-template-rows: auto;
	grid-template-columns: auto 1fr auto;
	grid-template-areas:
		".... tophat    ...."
		"bar1 bubble    bar2"
		".... buttonbar ....";
}

a {
	opacity: 0.5;
	color: inherit;
	text-decoration: none;
}

a:hover, a:focus {
	opacity: 0.8;
	text-decoration: underline;
}

/*
** normal questions
*/

.post .tophat { grid-area: tophat }
.post .bar1 { grid-area: bar1 }
.post .bar2 { grid-area: bar2 }
.post .bubble { grid-area: bubble }
.post .buttonbar { grid-area: buttonbar }

.post .bar {
	padding: 0.5em;
	padding-top: 0.2em;
	display: flex;
	flex-direction: column;
}

.post .bar > * + * {
	margin-top: 0.1em;
}

.post .bar.bar2 {
	padding-top: 0;
}

.post .metabar {
	font-size: 0.7em;
	padding: 0 1.5em;
	opacity: 0.6;
}

.post .tophat xio-profile-card {
	width: 100%;
}

.post .bubble {
	flex: 1 1 auto;
	/* padding-left: 1em; */
}

.post .bubble xio-text-input {
	--xio-text-input-border-radius: 0 1em 1em 1em;
	--xio-text-input-pad: 0.5em;
}

.post .bubble .textbox p {
	border-radius: 0 1em 1em 1em;
	border: 1px solid;
	padding: 0.5em;
	min-height: 4em;
}

.post [part="bubble"] {
	white-space: pre-wrap;
}

/*
** question editor
*/

.intro {
	margin-bottom: 1em;
}

.intro .heading {
	font-size: 2em;
}

.post.editor .buttonbar {
	text-align: right;
	padding: 0.5em;
}

.post.editor {
	padding-bottom: 2em;
	margin-bottom: 2em;
	border-bottom: 1px dashed;
}

`}

[part="answers-list"] {
	list-style: none;
	margin-left: 3.4em;
	margin-right: 1em;
	margin-bottom: 1em;
}

[part="answers-list"] > li {
	
	margin-top: 1em;
}

@media (max-width: 420px) {
	[part="answers-list"] {
		margin-left: 1em;
		margin-right: 0;
	}
	[part="answers-list"] > li {
		border-left: 1px solid;
	}
}

/*
** question editor
*/

.editor .intro {
	margin-bottom: 1em;
}

.editor .intro .heading {
	font-size: 2em;
}

.editor .buttonbar {
	text-align: right;
	padding: 0.5em;
}

.question-editor {
	padding-bottom: 2em;
	margin-bottom: 2em;
	border-bottom: 1px dashed;
}

/*
** answer editor
*/

.answer-editor {
	border: 1px dashed;
	margin-left: 5em;
	margin-top: 1em;
}

.answer-editor .intro {
	padding: 1em;
}

`;const Cl=1*Re;function Tl(e,t){const i=Ml(e),o=Ml(t);return i>o?-1:o<i?1:0}function Ml({timePosted:e,likes:t,reports:i}){return e+El(t,Cl)-El(i,1728e5)}function El(e,t){return(0===e?0:1+Math.log10(e))*t}function Rl({content:e,editable:t,timePosted:i,handleValueChange:o=(()=>{})}){const{date:s,time:a}=Bn(i);return aa`
		<div class=bubble ?data-editable=${t}>
			<div class=textbox>
				${t?aa`
						<xio-text-input
							exportparts="textinput: bubble"
							textarea
							.validator=${zo}
							@valuechange=${o}
						></xio-text-input>
					`:aa`
						<p part=bubble>${e}</p>
					`}
			</div>
			<div class=metabar>
				<p>${`${s} ${a}`}</p>
			</div>
		</div>
	`}function ql(e){return t=>{t.preventDefault(),e()}}var Dl;!function(e){e[e.Question=0]="Question",e[e.Answer=1]="Answer",e[e.Editor=2]="Editor"}(Dl||(Dl={}));var jl=na`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M6.736 4C4.657 4 2.5 5.88 2.5 8.514c0 3.107 2.324 5.96 4.861 8.12a29.66 29.66 0 0 0 4.566 3.175l.073.041l.073-.04c.271-.153.661-.38 1.13-.674c.94-.588 2.19-1.441 3.436-2.502c2.537-2.16 4.861-5.013 4.861-8.12C21.5 5.88 19.343 4 17.264 4c-2.106 0-3.801 1.389-4.553 3.643a.75.75 0 0 1-1.422 0C10.537 5.389 8.841 4 6.736 4zM12 20.703l.343.667a.75.75 0 0 1-.686 0l.343-.667zM1 8.513C1 5.053 3.829 2.5 6.736 2.5C9.03 2.5 10.881 3.726 12 5.605C13.12 3.726 14.97 2.5 17.264 2.5C20.17 2.5 23 5.052 23 8.514c0 3.818-2.801 7.06-5.389 9.262a31.146 31.146 0 0 1-5.233 3.576l-.025.013l-.007.003l-.002.001l-.344-.666l-.343.667l-.003-.002l-.007-.003l-.025-.013A29.308 29.308 0 0 1 10 20.408a31.147 31.147 0 0 1-3.611-2.632C3.8 15.573 1 12.332 1 8.514z" fill="currentColor"/></svg>`,Ll=na`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M14 20.408c-.492.308-.903.546-1.192.709c-.153.086-.308.17-.463.252h-.002a.75.75 0 0 1-.686 0a16.709 16.709 0 0 1-.465-.252a31.147 31.147 0 0 1-4.803-3.34C3.8 15.572 1 12.331 1 8.513C1 5.052 3.829 2.5 6.736 2.5C9.03 2.5 10.881 3.726 12 5.605C13.12 3.726 14.97 2.5 17.264 2.5C20.17 2.5 23 5.052 23 8.514c0 3.818-2.801 7.06-5.389 9.262A31.146 31.146 0 0 1 14 20.408z" fill="currentColor"/></svg>`;function Ul({title:e,dataVote:t,voteCount:i,voteCasted:o,icon:s,castVote:a}){const n=a?o?()=>a(!1):()=>a(!0):()=>{};return aa`
		<button
			tabindex=0
			data-vote="${t}"
			?data-active=${o}
			?disabled=${!a}
			title="${e}"
			@click=${n}>
				<span>${s}</span>
				<span>${i}</span>
		</button>
	`}function Nl(e){return Ul({dataVote:"like",icon:e.liked?Ll:jl,title:e.liked?"unlike this post":"like this post",voteCount:e.likes,voteCasted:e.liked,castVote:e.castLikeVote?t=>e.castLikeVote(t):void 0})}var zl=na`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 20 20"><g fill="none"><path d="M8.686 2.852L2.127 14.777A1.5 1.5 0 0 0 3.441 17H16.56a1.5 1.5 0 0 0 1.314-2.223L11.314 2.852a1.5 1.5 0 0 0-2.628 0zM10 6.75a.75.75 0 0 1 .75.75v4a.75.75 0 0 1-1.5 0v-4a.75.75 0 0 1 .75-.75zm.75 7a.75.75 0 1 1-1.5 0a.75.75 0 0 1 1.5 0z" fill="currentColor"/></g></svg>`;function Vl(e){return Ul({dataVote:"report",icon:e.reported?zl:un,title:e.reported?"unreport this post":"report this post",voteCount:e.reports,voteCasted:e.reported,castVote:e.castReportVote?t=>e.castReportVote(t):void 0})}function Bl({postOptions:e,bar1:t,bubble:i,bar2:o,buttonBar:s}){return aa`
		<div class=post data-post-id="${e.postId??""}">
			<div class=tophat>
				<xio-profile-card .user=${e.author} show-details></xio-profile-card>
			</div>
			<div class="bar bar1">
				${t}
			</div>
			${i}
			<div class="bar bar2">
				${o}
			</div>
			${s?aa`
					<div class=buttonbar>
						${s}
					</div>
				`:null}
		</div>
	`}function Hl(e){const{author:t,content:i,timePosted:o,...s}=e;switch(s.type){case Dl.Question:{const{liking:t,reporting:a,deletePost:n,toggleAnswerEditor:r}=s;return Bl({postOptions:e,bar1:aa`
					${Nl(t)}
				`,bubble:Rl({content:i,timePosted:o,editable:!1,handleValueChange:void 0}),bar2:aa`
					${Vl(a)}
					${n?aa`<a href="#" @click=${ql(n)}>delete</a>`:null}
					${r?aa`<a href="#" @click=${ql(r)}>answer</a>`:null}
				`,buttonBar:void 0})}case Dl.Answer:{const{liking:t,reporting:a,deletePost:n}=s;return Bl({postOptions:e,bar1:aa`
					${Nl(t)}
				`,bubble:Rl({content:i,timePosted:o,editable:!1,handleValueChange:void 0}),bar2:aa`
					${Vl(a)}
					${n?aa`<a href="#" @click=${ql(n)}>delete</a>`:null}
				`,buttonBar:void 0})}case Dl.Editor:{const{isPostable:t,postButtonText:a,changeDraftContent:n,submitPost:r}=s;return Bl({postOptions:e,bar1:null,bubble:Rl({content:i,timePosted:o,editable:!0,handleValueChange:n}),bar2:null,buttonBar:aa`
					<xio-button
						?disabled=${!t}
						@click=${r}
							>${a}</xio-button>
				`})}}}function Fl({now:e,question:t,modals:i,boardModel:o,answerEditor:s}){const{questionId:a}=t,n=o.getAccess(),r=o.getPermissions(),l=o.getUser(t.authorUserId),c=(()=>{const e=!(!n||!n.user)&&n.user.userId===l.userId;return{canDelete:r["moderate questions"]||e,canAnswer:r["answer questions"],canLike:r["like questions"],canReport:r["report questions"]}})(),d=s.getState(),p=e=>{const t=n?.user?.userId===e.authorUserId;return r["moderate questions"]||t};return aa`
		${Hl({type:Dl.Question,author:l,content:t.content,deletePost:c.canDelete?async()=>{await i.confirm({title:"Delete question?",body:"Are you sure you want to delete this question? This cannot be undone.",yes:{vibe:"negative",label:"Delete question"},no:{vibe:"neutral",label:"Nevermind"},focusNthElement:2})&&await o.archiveQuestion(a,!0)}:void 0,liking:{liked:t.liked,likes:t.likes,castLikeVote:c.canLike?e=>{o.likeQuestion(a,e)}:void 0},postId:t.questionId,reporting:{reported:t.reported,reports:t.reports,castReportVote:c.canReport?async e=>{(!e||await i.confirm({title:"Report question?",body:"Are you sure you want to submit a report against this question?",yes:{vibe:"negative",label:"Submit report"},no:{vibe:"neutral",label:"Nevermind"},focusNthElement:2}))&&await o.reportQuestion(a,e)}:void 0},timePosted:t.timePosted,toggleAnswerEditor:c.canAnswer?s.actions.toggleEditMode:void 0})}
		${d.editMode?function({now:e,boardModel:t,answerEditor:i}){const o=i.getState();return aa`
		<div class="editor answer-editor">
			<div class=intro>
				<p class=heading>Post your answer</p>
			</div>
			${Hl({author:t.getAccess().user,type:Dl.Editor,timePosted:e,postButtonText:"post answer",content:o.draftText,isPostable:o.isPostable,submitPost:i.submitAnswer,changeDraftContent:i.actions.handleValueChange})}
		</div>
	`}({now:e,boardModel:o,answerEditor:s}):null}
		${t.answers.length?aa`
			<ol part=answers-list>
				${t.answers.map((e=>aa`
					<li part=answer data-answer-id="${e.answerId}">
						${function({answer:e,questionId:t,modals:i,boardModel:o,canDeleteAnswer:s}){const a=o.getPermissions(),n=a["like questions"],r=a["report questions"];return Hl({type:Dl.Answer,postId:e.answerId,author:o.getUser(e.authorUserId),content:e.content,timePosted:e.timePosted,liking:{liked:e.liked,likes:e.likes,castLikeVote:n?i=>o.likeAnswer(t,e.answerId,i):void 0},reporting:{reported:e.reported,reports:e.reports,castReportVote:r?async s=>{(!s||await i.confirm({title:"Report answer?",body:"Are you sure you want to submit a report against this answer?",yes:{vibe:"negative",label:"Submit report"},no:{vibe:"neutral",label:"Nevermind"},focusNthElement:2}))&&await o.reportAnswer(t,e.answerId,s)}:void 0},deletePost:s(e)?async()=>{await i.confirm({title:"Delete answer?",body:"Are you sure you want to delete this answer? This cannot be undone.",yes:{vibe:"negative",label:"Delete answer"},no:{vibe:"neutral",label:"Nevermind"},focusNthElement:2})&&await o.archiveAnswer(t,e.answerId,!0)}:void 0})}({answer:e,modals:i,questionId:a,boardModel:o,canDeleteAnswer:p})}
					</li>
				`))}
			</ol>
		`:null}
	`}function Wl(){return Ot({state:{draftText:"",isPostable:!1},actions:e=>({handleValueChange(t){e.draftText=t.detail.value,e.isPostable=!!e.draftText}})})}function Ql({requestUpdate:e,getTextInput:t,getBoardModel:i}){const{actions:o,getState:s,onStateChange:a}=Wl();a(e);return{actions:o,getState:s,getTextInput:t,submitQuestion:async()=>{const{draftText:e}=s();t().text="",await i().postQuestion({content:e})}}}function Kl(e){return function(t){const i=()=>({actions:{...e.actions,...t.actions},getState:()=>({...e.getState(),...t.getState()}),clearStateListeners:()=>{e.clearStateListeners(),t.clearStateListeners()},onStateChange:i=>{const o=[e.onStateChange(i),t.onStateChange(i)];return()=>o.forEach((e=>e()))}});function o(e){return Kl(i())(e)}return o.combine=i,o}}function Xl({requestUpdate:e,getBoardModel:t,getTextInput:i}){const o=or()((o=>{const s=Wl(),a=Ot({state:{editMode:!1},actions:e=>({toggleEditMode(){e.editMode=!e.editMode}})}),n=Kl(s)(a).combine();n.onStateChange(e);return{...n,submitAnswer:async()=>{const{draftText:e}=n.getState();i(o).text="",n.actions.toggleEditMode(),await t().postAnswer(o,{content:e})}}}));return e=>o(e)}var Jl,Gl,Yl,Zl,ec=function(e,t,i,o){var s,a=arguments.length,n=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(n=(a<3?s(n):a>3?s(t,i,n):s(t,i))||n);return a>3&&n&&Object.defineProperty(t,i,n),n},tc=function(e,t,i,o){if("a"===i&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?o:"a"===i?o.call(e):o?o.value:t.get(e)},ic=function(e,t,i,o,s){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?s.call(e,i):s?s.value=i:t.set(e,i),i};let oc=class extends on{};var sc;oc=ec([(sc=1e3,function(e){var t,i;return i=class extends e{constructor(){super(...arguments),t.set(this,void 0)}tick(){}connectedCallback(){super.connectedCallback(),Xa(this,t,setInterval((()=>{this.tick(),this.requestUpdate()}),sc),"f")}disconnectedCallback(){super.disconnectedCallback(),clearInterval(Ja(this,t,"f"))}},t=new WeakMap,i})],oc);let ac=class extends oc{constructor(){super(...arguments),Jl.set(this,void 0),Gl.set(this,Ql({getBoardModel:()=>tc(this,Jl,"f"),requestUpdate:()=>this.requestUpdate(),getTextInput:()=>this.shadowRoot.querySelector(".question-editor xio-text-input")})),Yl.set(this,Xl({getBoardModel:()=>tc(this,Jl,"f"),requestUpdate:()=>this.requestUpdate(),getTextInput:e=>this.shadowRoot.querySelector(`[part="questions-list"] li[data-question-id="${e}"] xio-text-input`)})),Zl.set(this,Date.now()),this.board="default"}tick(){ic(this,Zl,Date.now(),"f")}init(){ic(this,Jl,this.share.questionsModel.makeBoardModel(this.board),"f"),tc(this,Jl,"f").loadQuestions()}renderQuestionsBoard(){const e=tc(this,Zl,"f"),{modals:t}=this.share,i=tc(this,Gl,"f"),{archiveBoard:o}=tc(this,Jl,"f"),s=tc(this,Jl,"f").getAccess(),a=tc(this,Jl,"f").getBoardName(),n=tc(this,Jl,"f").getBoardOp(),r=tc(this,Jl,"f").getPostingOp(),l=tc(this,Jl,"f").getPermissions(),c=function(e,t){const i=[],o=[];for(const s of e)t&&s.authorUserId===t?i.push(s):o.push(s);return[...i.sort(Tl),...o.sort(Tl)]}(tc(this,Jl,"f").getQuestions(),s?.user?.userId);return Wn(n,(()=>aa`

			${l["moderate questions"]?function({modals:e,board:t,archiveBoard:i}){return aa`
		<div class=questions-moderation-panel>
			<h3>moderate questions board "${t}"</h3>
			<xio-button
				class=purge-button
				@press=${async()=>{await e.confirm({title:"Purge questions?",body:`Are you sure you want to delete all the questions on the board "${t}"? This cannot be undone.`,yes:{vibe:"negative",label:"Purge all"},no:{vibe:"neutral",label:"Nevermind"},focusNthElement:2})&&await i()}}>
					Purge all questions
			</xio-button>
		</div>
	`}({modals:t,board:a,archiveBoard:o}):null}

			${l["post questions"]?function({now:e,access:t,postingOp:i,questionEditor:o}){const s=t?.user,a=o.getState();return Wn(i,(()=>aa`
		<div class="editor question-editor" part=question-editor>
			<div class=intro>
				<p class=heading>Post a new question</p>
			</div>
			${Hl({type:Dl.Editor,author:s,content:a.draftText,isPostable:a.isPostable,timePosted:e,postButtonText:"post question",submitPost:o.submitQuestion,changeDraftContent:o.actions.handleValueChange})}
		</div>
	`))}({now:e,access:s,postingOp:r,questionEditor:i}):null}

			${c.length>0?aa`
					<ol part=questions-list>
						${c.map((e=>aa`
							<li data-question-id="${e.questionId}">
								${Fl({question:e,now:tc(this,Zl,"f"),modals:this.share.modals,boardModel:tc(this,Jl,"f"),answerEditor:tc(this,Yl,"f").call(this,e.questionId)})}
							</li>
						`))}
					</ol>
				`:aa`<slot name=empty><p>Be the first to post a question!</p></slot>`}
		`))}render(){return tc(this,Jl,"f")&&tc(this,Jl,"f").getBoardOp()?this.renderQuestionsBoard():null}};function nc({models:e,modals:t}){const{questionsModel:i}=e;return{XiomeQuestions:Ba(i.onStateChange)(Ka({modals:t,questionsModel:i})(ac))}}Jl=new WeakMap,Gl=new WeakMap,Yl=new WeakMap,Zl=new WeakMap,ec([Da({type:String,reflect:!0})],ac.prototype,"board",void 0),ac=ec([Na(Ol)],ac);var rc=Ts`

.container {
	display: block;
	width: 100%;
	max-width: 36em;
	padding: 0.5em !important;
	border: 1px solid;
}

.results {
	margin-top: 0.5em;
}

.userlist {
	list-style: none;
}

.userlist > li {
	display: flex;
	flex-direction: column;
	flex-wrap: wrap;
	background: #0002;
	padding: 0.5em;
	margin-top: 0.5em;
}

.userinfo {
	display: flex;
	flex-direction: row;
}

.userinfo xio-profile-card {
	flex: 1 1 auto;
}

.userinfo .controls {
	margin-left: 1em;
}

.userinfo .controls .edit[data-edit-mode] {
	color: lime;
	--xio-button-hover-color: lime;
}

.editwidget > div {
	margin-top: 1em;
}

.editwidget header + * {
	margin-top: 0.25em;
}

.editwidget header small {
	font-size: inherit;
	opacity: 0.6;
}

.editwidget ul {
	list-style: none;
}

.editwidget .allprivileges li {
	display: inline-block;
	font-size: 0.75em;
	padding: 0.1em 0.3em;
	margin: 0.2em 0.1em;
	border: 1px solid;
	border-radius: 1em;
}

`;function lc(e){return[...e.filter((e=>e.assignable)),...e.filter((e=>!e.assignable))]}function cc(e,t){return aa`
		<xio-button
			?disabled=${!e.assignable}
			title=${e.roleId}
			data-role-id=${e.roleId}
			@press=${()=>t(e)}>
				${e.label}
		</xio-button>
	`}function dc(e){return aa`
		<li
			title="${e.privilegeId}"
			data-privilege-id="${e.privilegeId}">
				${e.label}
		</li>
	`}var pc,uc,hc=function(e,t,i,o){var s,a=arguments.length,n=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(n=(a<3?s(n):a>3?s(t,i,n):s(t,i))||n);return a>3&&n&&Object.defineProperty(t,i,n),n},mc=function(e,t,i,o){if("a"===i&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?o:"a"===i?o.call(e):o?o.value:t.get(e)},fc=function(e,t,i,o,s){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?s.call(e,i):s?s.value=i:t.set(e,i),i};let gc=class extends on{constructor(){super(...arguments),this.userResults=We.ready([]),this.updateLocalUserResultsCache={assignRole:(e,t)=>{if(!We.ready(this.userResults))throw new Error("error updating user cache");const i=We.value(this.userResults);this.userResults=We.ready(i.map((i=>i.user.userId===e?{user:i.user,roleIds:[...i.roleIds,t]}:i)))},revokeRole:(e,t)=>{if(!We.ready(this.userResults))throw new Error("error updating user cache");const i=We.value(this.userResults);this.userResults=We.ready(i.map((i=>i.user.userId===e?{user:i.user,roleIds:i.roleIds.filter((e=>e!==t))}:i)))}},this.userStates=function({getUserResultsOp:e,rerender:t}){const i=new Map;return{cleanupObsoleteStates:function(){const t=[],o=e();if(We.ready(o)){const e=We.value(o);for(const o of i.keys())!e.find((({user:e})=>e.userId===o))&&t.push(o)}for(const e of t)i.delete(e)},obtainStateForUser:function(e){let o=i.get(e);if(!o){const s={editMode:!1,toggleEditMode(){s.editMode=!s.editMode,t()}};o=s,i.set(e,o)}return o}}}({getUserResultsOp:()=>this.userResults,rerender:()=>this.requestUpdate()}),pc.set(this,""),uc.set(this,""),this.commitSearch=async()=>{const e=mc(this,pc,"f")===mc(this,uc,"f");fc(this,uc,mc(this,pc,"f"),"f"),e||(this.userResults=We.ready([]),mc(this,pc,"f")&&await We.operation({setOp:e=>this.userResults=e,promise:this.share.administrativeModel.searchUsers({term:mc(this,pc,"f")})})),this.userStates.cleanupObsoleteStates()},this.commitSearchSoon=Ke(1e3,this.commitSearch),this.searchChange=e=>{fc(this,pc,e.detail.value??"","f"),this.commitSearchSoon()},this.enterPress=()=>{this.commitSearch()}}init(){this.share.administrativeModel.initialize()}render(){const{permissionsOp:e}=this.share.administrativeModel.state,t=this.share.administrativeModel.isAllowed("administrate user roles"),i=t=>{const{user:i}=t,o=this.userStates.obtainStateForUser(i.userId);return aa`
				<li>
					<div class=userinfo>
						<xio-profile-card
							.user=${i}
							show-details
						></xio-profile-card>
						<div class=controls>
							<xio-button
								class=edit
								?data-edit-mode=${o.editMode}
								@press=${o.toggleEditMode}>
									${gr}
							</xio-button>
						</div>
					</div>
					${o.editMode?Wn(e,(e=>function({permissions:e,administrativeModel:t,updateLocalUserResultsCache:i,userResult:{user:{userId:o},roleIds:s},blur:a,search:n}){const r=lc(s.map((t=>e.roles.find((e=>e.roleId===t)))).filter((e=>!!e))),l=lc(e.roles.filter((e=>!s.includes(e.roleId))).filter((e=>!!e))),c=e.privileges.filter((t=>{const i=e.rolesHavePrivileges.filter((e=>e.active&&e.privilegeId===t.privilegeId)),o=i.filter((e=>s.includes(e.roleId)));return o.length>0}));async function d(){o===t.getAccess()?.user?.userId&&await t.reauthorize()}async function p({roleId:e}){await t.assignRoleToUser({userId:o,roleId:e,isPublic:!0,timeframeEnd:void 0,timeframeStart:void 0}),i.assignRole(o,e),a(),await d(),await n()}async function u({roleId:e}){await t.revokeRoleFromUser({userId:o,roleId:e}),i.revokeRole(o,e),a(),await d(),await n()}return aa`
		<div class=editwidget>
			<div class=available>
				<header>roles available <small>(click to assign)</small></header>
				<div>
					${l.map((e=>cc(e,p)))}
				</div>
			</div>
			<div class=assigned>
				<header>roles assigned <small>(click to revoke)</small></header>
				<div>
					${r.map((e=>cc(e,u)))}
				</div>
			</div>
			<div class=allprivileges>
				<header>user has these privileges</header>
				<ul>
					${c.map(dc)}
				</ul>
			</div>
		</div>
	`}({userResult:t,permissions:e,administrativeModel:this.share.administrativeModel,updateLocalUserResultsCache:this.updateLocalUserResultsCache,blur:()=>{const e=document.activeElement;e&&e.blur()},search:()=>this.commitSearch()}))):null}
				</li>
			`};return aa`
			<div class=container>

				${t?aa`
					<xio-text-input
						placeholder="search for users"
						.validator=${Go}
						@valuechange=${this.searchChange}
						@enterpress=${this.enterPress}
					></xio-text-input>

					<div class=results>
						${Wn(this.userResults,(e=>e.length>0?aa`
								<ol class=userlist>
									${e.map(i)}
								</ol>
							`:aa`
								<div class=noresults>
									no results
								</div>
							`))}
					</div>
				`:aa`
					<p>you are not permitted to administrate user roles</p>
				`}

			</div>
		`}};function bc({models:e,modals:t}){const{administrativeModel:i}=e;return{XiomeManageUsers:Qa(i.subscribe)(Ka({modals:t,administrativeModel:i})(gc))}}pc=new WeakMap,uc=new WeakMap,hc([Da()],gc.prototype,"userResults",void 0),gc=hc([Na(rc)],gc);var vc=na`
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>`,wc=na`
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>`,yc=na`
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-power"><path d="M18.36 6.64a9 9 0 1 1-12.73 0"></path><line x1="12" y1="2" x2="12" y2="12"></line></svg>`,xc=na`
<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-x"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><line x1="23" y1="9" x2="17" y2="15"></line><line x1="17" y1="9" x2="23" y2="15"></line></svg>`,kc=na`<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x-circle"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>`;var Sc,Ic,$c,Pc,Ac,_c,Oc,Cc,Tc,Mc,Ec,Rc,qc,Dc,jc=Ts`

:host {
	display: block;
	max-width: 56em;
	--xiome-chat-history-height: var(--xiome-chat-history-height, 20em);
}

.modheader {
	display: flex;
	flex-wrap: wrap;
	flex-direction: row;
	align-items: end;
	padding: 0 1em;
}

.modheader > span:nth-child(1) {
	opacity: 0.5;
	padding: 0.2em 0;
}

.modheader > span:nth-child(2) {
	margin-left: auto;
}

xio-button {
	--xio-button-disabled-border-style: none;
}

.modheader xio-button {
	--xio-button-border: none;
}

.modheader xio-button::part(button-slot) {
	display: flex;
	align-items: center;
	gap: 0.5em;
}

.history {
	padding: 1em;
	border: 1px solid;
	border-radius: 0.5em 0.5em 0 0;
	border-bottom: 0;
}

.chatbox xiome-login-panel {
	display: block;
	border: 1px solid currentColor;
	border-radius: 0 0 0.5em 0.5em;
}

.chatbox xiome-login-panel[status="logged-out"] {
	padding: 1em;
}

.chatbox slot[name="offline"],
.chatbox slot[name="muted"] {
	display: block;
	padding: 2em 1em;
	text-align: center;
}

.chatbox slot[name="offline"] {
	border: 1px solid currentColor;
	border-radius: 0.5em;
}

${Ts`

.history ol,
.history slot[name="no-messages"] {
	height: var(--xiome-chat-history-height);
	overflow-y: auto;
	scrollbar-color: #0004 #0002;
	scrollbar-width: thin;
}

.history ol::-webkit-scrollbar {
	width: 0.4em;
}

.history ol::-webkit-scrollbar-thumb {
	border-radius: 1em;
	background: #0004;
}

.history ol::-webkit-scrollbar-thumb:hover {
	background: #0008;
}

.history ol::-webkit-scrollbar-thumb:active {
	background: #000a;
}

.history ol::-webkit-scrollbar-track {
	border-radius: 1em;
	background: #0002;
}

slot[name="no-messages"] {
	opacity: 0.5;
	display: flex;
	justify-content: center;
	align-items: center;
	text-align: center;
}

.history li + li {
	margin-top: 0.75em;
}

.history li > header {
	display: flex;
	flex-direction: row;
	align-items: center;
	gap: 0.5em;
}

.history li .moderation {
	opacity: 0.5;
}

.history li > header > span {
	display: flex;
	align-items: center;
}

.history li > header > span > xio-button {
	--xio-button-border: none;
	--xio-button-padding: 0 0.3em;
}

.history li .nickname {
	font-size: 1em;
	opacity: var(--xio-chat-nickname-opacity, 0.5);
	color: var(--xio-chat-nickname-color, currentColor);
}

.history li .userid {
	font-size: 1em;
	opacity: var(--xio-chat-userid-opacity, 0.5);
	color: var(--xio-chat-userid-color, currentColor);
}

.history li .content {
	font-size: 1.3em;
	word-break: break-word;
}

.history li .time {
	opacity: 0.3;
	font-size: 1rem;
}

`}

.authorship {
	display: flex;
	align-items: stretch;
	Xborder: 1px solid;
}

.authorship xio-text-input {
	border-right: 1px solid;
	--xio-text-input-height: 6em;
	--xio-text-input-label-opacity: 0.5;
	--xio-text-input-border: 0;
	--xio-text-input-pad: 1em;
}

.authorship xio-button {
	height: 6em;
	flex: 1 1 auto;
	--xio-button-border: 0;
	--xio-button-disabled-border-style: none;
}

.authorship xio-button::part(button) {
	width: 100%;
}

.authorship .inputlabel {
	display: block;
	opacity: 0.5;
	padding: 0.2em 0;
	margin-left: 1em;
}

`,Lc=function(e,t,i,o){var s,a=arguments.length,n=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(n=(a<3?s(n):a>3?s(t,i,n):s(t,i))||n);return a>3&&n&&Object.defineProperty(t,i,n),n},Uc=function(e,t,i,o,s){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?s.call(e,i):s?s.value=i:t.set(e,i),i},Nc=function(e,t,i,o){if("a"===i&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?o:"a"===i?o.call(e):o?o.value:t.get(e)};let zc=class extends on{constructor(){super(...arguments),Sc.add(this),this.room="default",$c.set(this,void 0),Pc.set(this,(()=>{})),Ac.set(this,!0),Oc.set(this,(()=>{const e=this.shadowRoot.querySelector(".history ol");e?e.scrollHeight<=e.clientHeight?Uc(this,Ac,!0,"f"):Nc(this,Ac,"f")&&e.scrollTo(0,e.scrollHeight-e.clientHeight):Uc(this,Ac,!0,"f")})),this.draftValid=!1,this.tooSoon=!1,Mc.set(this,Date.now()),Ec.set(this,(()=>{const e=Date.now()-Nc(this,Mc,"f");this.tooSoon=e<3e3})),qc.set(this,(e=>{e.preventDefault();const{tooSoon:t}=this;if(!t){const{value:e}=this.authorshipInput,t={content:e};Uc(this,Mc,Date.now(),"f"),this.authorshipInput.text="",Nc(this,Ec,"f").call(this),Nc(this,$c,"f").post(t)}}))}subscribe(){Nc(this,Sc,"a",Ic).session(this.room).then((({room:e,dispose:t})=>{Uc(this,$c,e,"f"),Uc(this,Pc,t,"f")})).then((()=>this.requestUpdate()));const e=[super.subscribe(),()=>Nc(this,Pc,"f").call(this),Nc(this,Sc,"m",Rc).call(this),Nc(this,Sc,"a",Ic).subscribeToChange(Nc(this,Oc,"f"))];return()=>{for(const t of e)t()}}render(){return Wn(Nc(this,Sc,"a",Ic).state.connectionOp,(()=>aa`
			<div class=chatbox>
				${Nc(this,$c,"f")?aa`
						${Nc(this,Sc,"m",Cc).call(this)}
						${Nc(this,$c,"f")?.status===bt.Online?[Nc(this,Sc,"m",Tc).call(this),Nc(this,Sc,"m",Dc).call(this)]:aa`
								<slot name=offline>
									chat is offline
								</slot>
							`}
					`:null}
			</div>
		`))}};function Vc({models:e,modals:t}){const{chatModel:i}=e;return{XiomeChat:Qa(i.subscribe)(Ka({modals:t,chatModel:i})(zc))}}$c=new WeakMap,Pc=new WeakMap,Ac=new WeakMap,Oc=new WeakMap,Mc=new WeakMap,Ec=new WeakMap,qc=new WeakMap,Sc=new WeakSet,Ic=function(){return this.share.chatModel},_c=function(){const e=this.shadowRoot.querySelector("ol"),{scrollTop:t,scrollHeight:i,clientHeight:o}=e;Uc(this,Ac,i-o-t<50,"f")},Cc=function(){const e=Nc(this,$c,"f").status,t=Nc(this,$c,"f").muted.length;return Nc(this,Sc,"a",Ic).allowance.moderateAllChats?aa`
				<header class=modheader>
					<span>room="${this.room}"</span>
					<span>
						<xio-button
							title="unmute ${t} users"
							?disabled=${0===t}
							@press=${()=>Nc(this,$c,"f").unmuteAll()}>
								${wc} ${t}
						</xio-button>
						<xio-button
							title="clear chat room"
							@press=${()=>Nc(this,$c,"f").clear()}>
								${vc}
						</xio-button>
						<xio-button
							title="set chat ${e===bt.Offline?"online":"offline"}"
							@press=${()=>{Nc(this,$c,"f").setRoomStatus(Nc(this,$c,"f").status===bt.Offline?bt.Online:bt.Offline)}}>
								${yc}
						</xio-button>
					</span>
				</header>
			`:null},Tc=function(){return aa`
			<div class=history>
				${Nc(this,Sc,"a",Ic).allowance.viewAllChats?aa`
						${Nc(this,$c,"f").posts.length?aa`
								<ol @scroll=${Nc(this,Sc,"m",_c)}>
									${Nc(this,$c,"f").posts.map((e=>function({post:e,isModerator:t,mute:i,remove:o,mutedIds:s}){const a=Bn(e.time),n=s.includes(e.userId);return aa`
		<li data-post="${e.postId}">
			<header>
				<span class=nickname>${e.nickname}</span>
				${t?aa`
						<span class=moderation>
							<xio-button
								title="mute user"
								@press=${i}
								?disabled=${n}>
									${xc}
							</xio-button>
							<xio-button
								title="delete post"
								@press=${o}>
									${kc}
							</xio-button>
						</span>
					`:null}
				<xio-id class=userid title="copy user id" id="${e.userId}"></xio-id>
			</header>
			<div>
				<p class=content>
					${e.content}
					<span class=time title="${a.date} ${a.zone}">
						${a.time}
					</span>
				</p>
			</div>
		</li>
	`}({post:e,isModerator:Nc(this,Sc,"a",Ic).allowance.moderateAllChats,mute:()=>Nc(this,$c,"f").mute(e.userId),remove:()=>Nc(this,$c,"f").remove([e.postId]),mutedIds:Nc(this,$c,"f").muted})))}
								</ol>
							`:aa`
								<slot name=no-messages>
									no messages
								</slot>
							`}
					`:aa`
						<slot name=cannot-view>
							you are not privileged to view the chat
						</slot>
					`}
			</div>
		`},Rc=function(){const e=setInterval(Nc(this,Ec,"f"),1e3);return()=>clearInterval(e)},Dc=function(){const e=()=>Nc(this,$c,"f").weAreBanned?aa`<slot name=banned>you are banned</slot>`:Nc(this,$c,"f").weAreMuted?aa`<slot name=muted>you are muted</slot>`:function({sendable:e,onSendClick:t,onEnterPress:i,onValidityChange:o}){return aa`
		<div class=authorship>

			<xio-text-input
				textarea
				.validator=${Gt}
				@valuechange=${function(e){const t=e.detail.value;o(void 0!==t)}}
				@enterpress=${i}>
			</xio-text-input>

			<xio-button
				?disabled=${!e}
				@press=${t}>
					send message
			</xio-button>
		</div>
	`}({sendable:!!this.draftValid&&!this.tooSoon,onSendClick:Nc(this,qc,"f"),onEnterPress:Nc(this,qc,"f"),onValidityChange:e=>this.draftValid=e});return aa`
			<xiome-login-panel>
				${Fn(Nc(this,Sc,"a",Ic).state.accessOp,(()=>aa`
					<slot name=logged-out slot=logged-out>
						login to participate in the chat
					</slot>
					<div class=participation>
						${Nc(this,Sc,"a",Ic).allowance.participateInAllChats?e():aa`
								<slot name=cannot-participate>
									you do not have privilege to participate in the chat
								</slot>
							`}
					</div>
				`))}
			</xiome-login-panel>
		`},Lc([Da({type:String})],zc.prototype,"room",void 0),Lc([Da()],zc.prototype,"draftValid",void 0),Lc([ja(".authorship xio-text-input")],zc.prototype,"authorshipInput",void 0),Lc([Da()],zc.prototype,"tooSoon",void 0),zc=Lc([Na(jc)],zc);var Bc,Hc,Fc,Wc,Qc,Kc,Xc,Jc,Gc,Yc=Ts`

:host {
	display: block;
}

[data-tab] {
	font-weight: normal;
}

[data-tab][data-active='true'] {
	font-weight: bold;
	color: bisque;
}

`,Zc=function(e,t,i,o){var s,a=arguments.length,n=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(n=(a<3?s(n):a>3?s(t,i,n):s(t,i))||n);return a>3&&n&&Object.defineProperty(t,i,n),n},ed=function(e,t,i,o){if("a"===i&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?o:"a"===i?o.call(e):o?o.value:t.get(e)};let td=class extends on{constructor(){super(...arguments),Bc.add(this),Hc.set(this,this.share.notesModel),Fc.set(this,this.share.notesModel.createNotesCacheDetails()),Wc.set(this,ed(this,Fc,"f").cache)}async init(){await ed(this,Hc,"f").initialize()}subscribe(){const e=[super.subscribe(),ed(this,Fc,"f").setup(),ed(this,Wc,"f").subscribe((()=>this.requestUpdate()))];return ed(this,Hc,"f").isLoggedIn&&ed(this,Wc,"f").fetchAppropriateNotes(),()=>e.forEach((e=>e()))}render(){return Wn(ed(this,Hc,"f").state.accessOp,(e=>e?.user?aa`
					${ed(this,Bc,"m",Gc).call(this)}
				`:aa`
					<slot name="logged-out">
						you must be logged in to see your notifications
					</slot>
				`))}};Hc=new WeakMap,Fc=new WeakMap,Wc=new WeakMap,Bc=new WeakSet,Qc=function(){const{old:e}=ed(this,Wc,"f").cacheState,{switchTabNew:t,switchTabOld:i}=ed(this,Wc,"f");return aa`
			<div class=tabs>
				<xio-button
					@press=${t}
					data-tab="new"
					?data-active=${!e}>
						new
				</xio-button>
				<xio-button 
					@press=${i}
					data-tab="old"
					?data-active=${e}>
						old
				</xio-button>
			</div>
		`},Kc=function(){const{old:e,notesOp:t}=ed(this,Wc,"f").cacheState,{markSpecificNoteNew:i,markSpecificNoteOld:o}=ed(this,Wc,"f");return Wn(t,(t=>aa`
			<ol>
				${t.map((t=>aa`
					<li>
						<p>noteId: ${t.noteId}</p>
						<p>noteTitle: ${t.title}</p>
						<p>noteText: ${t.text}</p>
						<p>noteTime: ${t.time}</p>
						<p>noteFrom: ${t.from}</p>
						<p>noteTo: ${t.to}</p>
						<p>noteDetails: ${t.details}</p>
						<p>noteType: ${t.type}</p>
						${e?aa`
							<xio-button @press=${()=>i(t.noteId)}>
								+
							</xio-button>
						`:aa`
							<xio-button @press=${()=>o(t.noteId)}>
								x
							</xio-button>
						`}
					</li>
				`))}
			</ol>
		`))},Xc=function(){const{pageNumber:e}=ed(this,Wc,"f").cacheState,{nextPage:t,previousPage:i,totalPages:o,isNextPageAvailable:s,isPreviousPageAvailable:a}=ed(this,Wc,"f");return aa`
			${s||a?aa`
				<xio-button
					?disabled=${!a}
					@press=${i}>
						previous
				</xio-button>
				<span>
					${e} / ${o}
				</span>
				<xio-button
					?disabled=${!s}
					@press=${t}>
						next
				</xio-button>
				`:null}
		`},Jc=function(){const{old:e}=ed(this,Wc,"f").cacheState,{markAllNotesOld:t}=ed(this,Wc,"f");return aa`
			<div class=buttonbar>
				${e?null:aa`
						<xio-button @press=${t}>
							mark all old
						</xio-button>
					`}
			</div>
		`},Gc=function(){const{old:e,notesOp:t}=ed(this,Wc,"f").cacheState;return aa`
			${0===We.value(t)?.length?aa`
					${ed(this,Bc,"m",Qc).call(this)}
					<slot name="empty">
						you have no ${e?"old":"new"} notifications
					</slot>
				`:aa`
					${ed(this,Bc,"m",Qc).call(this)}
					${ed(this,Bc,"m",Kc).call(this)}
					${ed(this,Bc,"m",Xc).call(this)}
					${ed(this,Bc,"m",Jc).call(this)}
				`}
		`},td=Zc([Na(Yc)],td);var id=na`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-bell"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>`,od=Ts`

:host {
	display: inline-block;
	--xiome-notes-indicator-count-size: 1em;
	--xiome-notes-indicator-color: red;
	--xiome-notes-indicator-bleedout: 0em;
	font-size: var(--xiome-notes-indicator-size, 1em);
	width: var(--xiome-notes-indicator-icon-size, 3em);
	position: relative;
}

:host([no-icon]) .bell {
	display: none;
}

.count {
	display: flex;
	justify-content: center;
	align-items: center;
	vertical-align: top;
	position: absolute;
	height: 1em;
	width: 1em;
	background-color: var(--xiome-notes-indicator-color);
	border-radius: 50%;
	text-align: center;
	right: var(--xiome-notes-indicator-bleedout);
	top: var(--xiome-notes-indicator-bleedout);
	font-weight: bold;
	color: white;
	font-size: var(--xiome-notes-indicator-count-size);
}
`,sd=function(e,t,i,o){var s,a=arguments.length,n=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(n=(a<3?s(n):a>3?s(t,i,n):s(t,i))||n);return a>3&&n&&Object.defineProperty(t,i,n),n};let ad=class extends on{constructor(){super(...arguments),this.noIcon=!1}render(){const e=aa`<span class="bell">${id}</span>`,{stats:t}=this.share.notesModel;return aa`
				${0===t.newCount?aa`${e}`:aa`
					<span class="count">${t.newCount}</span>
					${e}
				`}
			`}};function nd({models:{notesModel:e}}){return{XiomeNotes:Qa(e.stateSubscribe)(Ka({notesModel:e})(td)),XiomeNotesIndicator:Qa(e.stateSubscribe)(Ka({notesModel:e})(ad))}}function rd(e){return((e,t)=>bi(t,(t=>Na(e)(t))))(nn,{XioId:dn,XioOp:fn,XioAvatar:xn,XioButton:$n,XioExample:_n,XioCheckbox:En,XioTextInput:Nn,XioProfileCard:Gn,..._l(e),...qr(e),...nc(e),...bc(e),...Il(e),...Vc(e),...nd(e)})}function ld(e){return async({title:t,input:i,body:o=null,yes:s={label:"okay",vibe:"positive"},no:a={label:"nevermind",vibe:"neutral"},focusNthElement:n=1,blanketClickMeansCancel:r=!0})=>new Promise((l=>{const c=document.createElement("xio-text-input");function d(){return c.value,0!==c.problems.length}function p(e){return{yes:()=>{const t=d()?void 0:{value:c.value};d()||(e.close(),l(t))},no:()=>{e.close(),l(void 0)}}}c.textarea=i.textarea??!1,c.parser=i.parser,c.validator=i.validator,c.textContent=i.label;const{controls:u,modal:h}=e({focusNthElement:n,onBlanketClick:r?e=>{e.close(),l(void 0)}:()=>{},renderContent:e=>{const i=p(e);return aa`
					<div data-confirm>
						${"string"==typeof t?aa`<h2>${t}</h2>`:t}
						${"string"==typeof o?aa`<p>${o}</p>`:o}
						${c}
						<div data-buttons>
							<xio-button
								data-button=yes
								data-vibe=${s.vibe}
								?disabled=${d()}
								@press=${i.yes}>
									${s.label}
							</xio-button>
							<xio-button
								data-button=no
								data-vibe=${a.vibe}
								@press=${i.no}>
									${a.label}
							</xio-button>
						</div>
					</div>
				`}}),m=p(u);c.onvaluechange=()=>u.rerender(),c.onenterpress=()=>m.yes(),h.addEventListener("keyup",(({key:e})=>{"Escape"===e&&m.no()}))}))}sd([Da({attribute:"no-icon"})],ad.prototype,"noIcon",void 0),ad=sd([Na(od)],ad);var cd=Ts`

*:focus {
	outline: var(--focus-outline);
}

[data-modal-system] {
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
	display: block;
}

[data-modal-system] [data-blanket] {
	z-index: 101;
	position: fixed;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	display: block;
	background: #0008;
	backdrop-filter: blur(10px);
}

[data-modal-system] [data-plate] {
	z-index: 102;
	position: absolute;
	top: 0;
	left: 0;
	right: 0;

	width: 96%;
	max-width: 32em;
	min-height: 1em;
	margin: 2em auto;

	background: linear-gradient(to bottom right, #fff, #ccc);
	color: #444;
}

[data-modal-system] [data-content]:focus {
	outline: unset;
}

[data-modal-system] [data-confirm] {
	padding: 1em;
}

[data-modal-system] [data-buttons] {
	margin-top: 1em;
	text-align: right;
}

[data-modal-system] [data-button] {
	--xio-button-hover-color: white;
	--xio-button-hover-background: #666;
}

[data-modal-system] [data-vibe=positive] {
	color: green;
	--xio-button-hover-color: white;
	--xio-button-hover-background: green;
}

[data-modal-system] [data-vibe=negative] {
	color: #a00;
	--xio-button-hover-color: white;
	--xio-button-hover-background: #a00;
}

`;function dd(e){return async({title:t,body:i=null,button:o={label:"ok",vibe:"neutral"},focusNthElement:s=1,blanketClickMeansNo:a=!0})=>{await e({title:t,body:i,blanketClickMeansNo:a,yes:o,no:null})}}function pd(){let e=0;const t=new Map,{rerender:i,element:o}=function(e){const t=document.createElement("style");da(cd,t);const i=document.createElement("div");return i.setAttribute("data-modal-system",""),{element:i,rerender:function(){da(aa`
			${t}
			${e().map((e=>e.render()))}
		`,i)}}}((()=>Array.from(t.values())));function s({focusNthElement:s,renderContent:a,onBlanketClick:n}){const r=e++,l={rerender:i,close:()=>{t.delete(r),i()}},c=window.pageYOffset??document.documentElement.scrollTop??document.body.scrollTop??0,d=()=>n(l);t.set(r,{render:()=>aa`
					<div data-modal="${r}">
						<div data-blanket @click=${d}></div>
						<div data-plate style="top: ${c}px">
							${a(l)}
						</div>
					</div>
				`}),i();const p=o.querySelector(`[data-modal="${r}"]`);return function(e,t){const i='\n\t\t[focusable]:not([disabled])\n\t\t[tabindex]:not([disabled])\n\t\ta[href]:not([disabled])\n\t\tbutton:not([disabled])\n\t\ttextarea:not([disabled])\n\t\tinput[type="text"]:not([disabled])\n\t\tinput[type="radio"]:not([disabled])\n\t\tinput[type="checkbox"]:not([disabled])\n\t\tselect:not([disabled])\n\t'.split("\n").map((e=>e.trim())).filter((e=>e.length)).join(", "),o=Array.from(e.querySelectorAll(i));if(0===o.length)throw new Error("cannot trap focus: no focusable element");const s=o[0],a=o[o.length-1],n=o[t-1];setTimeout((()=>n.focus()),0),e.onkeydown=e=>{"Tab"===e.key&&(e.shiftKey?document.activeElement===s&&(a.focus(),e.preventDefault()):document.activeElement===a&&(s.focus(),e.preventDefault()))}}(p,s),{controls:l,modal:p}}const a=function(e){return async({title:t,body:i=null,yes:o={label:"yes",vibe:"positive"},no:s={label:"no",vibe:"neutral"},focusNthElement:a=1,blanketClickMeansNo:n=!0})=>new Promise((r=>{e({focusNthElement:a,onBlanketClick:n?e=>{e.close(),r(!1)}:()=>{},renderContent:e=>aa`
					<div data-confirm>
						${"string"==typeof t?aa`<h2>${t}</h2>`:t}
						${"string"==typeof i?aa`<p>${i}</p>`:i}
						<div data-buttons>
							<xio-button
								focusable
								data-button=yes
								data-vibe="${o.vibe}"
								@press=${()=>{e.close(),r(!0)}}>
									${o.label}
							</xio-button>
							${s?aa`
								<xio-button
									focusable
									data-button=no
									data-vibe="${s.vibe}"
									@press=${()=>{e.close(),r(!1)}}>
										${s.label}
								</xio-button>
							`:null}
						</div>
					</div>
				`})}))}(s);return{modalsElement:o,modals:{popup:s,confirm:a,alert:dd(a),prompt:ld(s)}}}async function ud({link:e,accessModel:t,onDone:i,onError:o}){const{hash:s}=new URL(e),{login:a}=function(e=location.search){const t={},i=(e=(e=e.startsWith("?")?e.slice(1):e).startsWith("#")?e.slice(1):e).split("&");for(const e of i){const[i,...o]=e.split("="),s=o.join("=");t[decodeURIComponent(i)]=decodeURIComponent(s)}return t}(s);if(a){try{await t.login(a)}catch(e){o(e)}i()}else await t.useExistingLogin()}async function hd(e){const t=await Is(e);t.setMockLatency({min:200,max:800});const i=await async function({appId:e,popups:t,storage:i,authMediator:o,remote:s,chatConnect:a}){const{modals:n,modalsElement:r}=pd(),l=await qt({appId:e,remote:s,popups:t,storage:i,authMediator:o,chatConnect:a}),c=rd({models:l,modals:n});return await ud({accessModel:l.accessModel,link:window.location.toString(),onError:e=>{e instanceof Et?n.alert({title:"expired login link",body:"this login link has expired, please try again"}):n.alert({title:"invalid login link",body:"something is wrong with this login link, please try again"})},onDone:()=>{window.location.hash=""}}),{appId:e,components:c,models:l,modals:n,modalsElement:r}}(t);return Ps({frontend:i,connection:t}),{...t,...i}}function md(){const{attr:e}=function(e){const t=document.querySelector(e);if(!t)throw new Error(`${e} is required`);return{attr:e=>t.getAttribute(e)??void 0}}("xiome-mock"),t=e("mode");return{mode:void 0===t?void 0:"platform"===t?"platform":"app"}}!async function(){const e=await hd(md());document.body.prepend(e.modalsElement),function(e){for(const[t,i]of Object.entries(e))customElements.define(t.replace(/([a-zA-Z])(?=[A-Z])/g,"$1-").toLowerCase(),i)}(e.components),window.xiome=e}()}();